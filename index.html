<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="websiteTitle">Tee & Me - Our Story</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next@23.7.16/dist/umd/i18next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@7.2.0/dist/umd/i18nextBrowserLanguageDetector.min.js"></script>

    <style>
        /* Custom Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdf6f6; 
            color: #333;
            overflow-x: hidden;
        }
        .main-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            width: 100vw;
        }
        .content-area {
            flex-grow: 1;
            width: 100%;
            overflow: hidden;
            position: relative;
        }
        .content-section {
            display: none; 
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto; 
            padding: 1.5rem; /* p-6 */
            animation: fadeIn 0.5s ease-in-out;
        }
        .content-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .nav-button {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-button.active-nav, .nav-button:hover {
            color: #e11d48; /* Rose-500 */
            border-bottom-color: #e11d48;
        }
        .carousel-container {
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding-bottom: 1rem; 
            -webkit-overflow-scrolling: touch; 
        }
        .carousel-item {
            flex: 0 0 auto; 
            width: 300px; 
            margin-right: 1rem;
            background-color: white;
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); /* shadow-md */
            padding: 1rem;
        }
        .carousel-item:last-child {
            margin-right: 0;
        }
        .chart-container {
            position: relative;
            height: 300px; 
            width: 100%;
            max-width: 600px; 
            margin: 1rem auto;
        }
        .carousel-container::-webkit-scrollbar { height: 8px; }
        .carousel-container::-webkit-scrollbar-track { background: #fde4e4; border-radius: 10px; }
        .carousel-container::-webkit-scrollbar-thumb { background: #f43f5e; border-radius: 10px; }
        .carousel-container::-webkit-scrollbar-thumb:hover { background: #e11d48; }
        
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: #fff; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 0.5rem; position: relative; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
        .close-button:hover, .close-button:focus { color: black; text-decoration: none; cursor: pointer; }
        
        .language-switcher button { background-color: #f43f5e; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; margin-left: 0.5rem; transition: background-color 0.3s ease; }
        .language-switcher button:hover { background-color: #e11d48; }
        
        .dashboard-metric-card { background-color: white; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); text-align: center; }
        .dashboard-metric-card h3 { color: #f43f5e; }

        .contribution-table th, .contribution-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb; /* gray-200 */
        }
        .contribution-table th {
            background-color: #fff1f2; /* rose-50 */
            color: #be123c; /* rose-700 */
            font-weight: 600;
        }
        .input-field {
            border: 1px solid #d1d5db; /* gray-300 */
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem; /* rounded-md */
            width: 100%;
            margin-bottom: 0.5rem;
        }
        .action-button {
            background-color: #f43f5e; /* rose-500 */
            color: white;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            transition: background-color 0.3s ease;
        }
        .action-button:hover {
            background-color: #e11d48; /* rose-600 */
        }
        .feedback-item {
            background-color: #fff1f2; /* rose-50 */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #f43f5e; /* rose-500 */
        }
    </style>
</head>
<body>
    <div class="main-container">
        <header class="bg-white shadow-md sticky top-0 z-50">
            <div class="container mx-auto px-6 py-3 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-rose-600" data-i18n="headerTitle">Tee & Me</h1>
                <div class="language-switcher">
                    <button id="lang-en">EN</button>
                    <button id="lang-xh">XH</button>
                </div>
            </div>
        </header>

        <nav class="bg-white shadow-sm">
            <div class="container mx-auto px-6 py-2 flex justify-center space-x-2 sm:space-x-3 md:space-x-4 overflow-x-auto">
                <button data-section="overview" class="nav-button text-gray-700 hover:text-rose-500 py-2 px-2 sm:px-3 text-xs sm:text-sm active-nav" data-i18n="nav.overview">Overview</button>
                <button data-section="timeline" class="nav-button text-gray-700 hover:text-rose-500 py-2 px-2 sm:px-3 text-xs sm:text-sm" data-i18n="nav.timeline">Timeline</button>
                <button data-section="tracking" class="nav-button text-gray-700 hover:text-rose-500 py-2 px-2 sm:px-3 text-xs sm:text-sm" data-i18n="nav.tracking">Tracking</button>
                <button data-section="contributions" class="nav-button text-gray-700 hover:text-rose-500 py-2 px-2 sm:px-3 text-xs sm:text-sm" data-i18n="nav.contributions">Contributions</button>
                <button data-section="reinforcement" class="nav-button text-gray-700 hover:text-rose-500 py-2 px-2 sm:px-3 text-xs sm:text-sm" data-i18n="nav.reinforcement">Reinforcement</button>
                <button data-section="lifesync" class="nav-button text-gray-700 hover:text-rose-500 py-2 px-2 sm:px-3 text-xs sm:text-sm" data-i18n="nav.lifesync">LifeSync</button>
                <button data-section="insights" class="nav-button text-gray-700 hover:text-rose-500 py-2 px-2 sm:px-3 text-xs sm:text-sm" data-i18n="nav.insights">Insights</button>
                <button data-section="funtools" class="nav-button text-gray-700 hover:text-rose-500 py-2 px-2 sm:px-3 text-xs sm:text-sm" data-i18n="nav.funtools">Fun Tools</button>
                <button data-section="feedback" class="nav-button text-gray-700 hover:text-rose-500 py-2 px-2 sm:px-3 text-xs sm:text-sm" data-i18n="nav.feedback">Feedback</button>
            </div>
        </nav>

        <main class="content-area">
            <section id="overview" class="content-section active">
                <h2 class="text-3xl font-semibold mb-6 text-rose-500" data-i18n="overview.title">Our Journey Snapshot</h2>
                <div class="mb-8">
                    <h3 class="text-2xl font-medium mb-4 text-gray-700" data-i18n="overview.dashboardTitle">Relationship Dashboard</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="dashboard-metric-card">
                            <h3 class="text-xl font-semibold mb-2" data-i18n="overview.affectionLevel">Affection Level</h3>
                            <p class="text-3xl font-bold text-gray-800" id="affection-metric">--%</p>
                        </div>
                        <div class="dashboard-metric-card">
                            <h3 class="text-xl font-semibold mb-2" data-i18n="overview.supportScore">Support Score</h3>
                            <p class="text-3xl font-bold text-gray-800" id="support-metric">--%</p>
                        </div>
                         <div class="dashboard-metric-card">
                            <h3 class="text-xl font-semibold mb-2" data-i18n="overview.foodContribution">Food Prep</h3>
                            <p class="text-3xl font-bold text-gray-800" id="food-metric">--%</p>
                        </div>
                        <div class="dashboard-metric-card">
                            <h3 class="text-xl font-semibold mb-2" data-i18n="overview.safetyFeeling">Safety/Security</h3>
                            <p class="text-3xl font-bold text-gray-800" id="safety-metric">--%</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="dashboardChart"></canvas>
                    </div>
                     <div class="mt-4 text-center">
                        <label for="dashboardMetricSelect" class="mr-2 font-medium text-gray-700" data-i18n="overview.selectMetric">Display on graph:</label>
                        <select id="dashboardMetricSelect" class="p-2 border border-gray-300 rounded-md shadow-sm focus:ring-rose-500 focus:border-rose-500">
                            <option value="affection" data-i18n="overview.affectionLevel">Affection Level</option>
                            <option value="support" data-i18n="overview.supportScore">Support Score</option>
                            <option value="communication" data-i18n="overview.commFrequency">Communication Frequency</option>
                            <option value="food" data-i18n="overview.foodContribution">Food Contributions</option>
                            <option value="safety" data-i18n="overview.safetyFeeling">Safety Score</option>
                        </select>
                    </div>
                </div>
                <div class="text-center mb-8 p-6 bg-rose-50 rounded-lg shadow">
                    <h3 class="text-2xl font-medium mb-3 text-rose-700" data-i18n="overview.ourSong">Our Special Song</h3>
                    <a href="https://youtu.be/DOcCQ-kC4iE?si=DrJURhh0p86ce7yt" target="_blank" class="inline-block bg-rose-500 hover:bg-rose-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-300">
                        <i class="fas fa-play mr-2"></i> <span data-i18n="overview.playSong">Play "You're Still The One"</span>
                    </a>
                </div>
            </section>

            <section id="timeline" class="content-section">
                <h2 class="text-3xl font-semibold mb-6 text-rose-500" data-i18n="timeline.title">Our Relationship Timeline</h2>
                <div class="relative">
                    <button id="timeline-scroll-left" class="absolute left-0 top-1/2 transform -translate-y-1/2 z-10 bg-white/70 hover:bg-white p-2 rounded-full shadow-md text-rose-500"><i class="fas fa-chevron-left"></i></button>
                    <div id="timelineCarousel" class="carousel-container"></div>
                    <button id="timeline-scroll-right" class="absolute right-0 top-1/2 transform -translate-y-1/2 z-10 bg-white/70 hover:bg-white p-2 rounded-full shadow-md text-rose-500"><i class="fas fa-chevron-right"></i></button>
                </div>
            </section>

            <section id="tracking" class="content-section">
                <h2 class="text-3xl font-semibold mb-6 text-rose-500" data-i18n="tracking.title">Relationship Tracking</h2>
                <div class="mb-6">
                    <label for="trackingMetricSelect" class="mr-2 font-medium text-gray-700" data-i18n="tracking.selectAspect">Select aspect to track:</label>
                    <select id="trackingMetricSelect" class="p-2 border border-gray-300 rounded-md shadow-sm focus:ring-rose-500 focus:border-rose-500">
                        <option value="affection" data-i18n="tracking.affectionLevel">Affection Level</option>
                        <option value="support" data-i18n="tracking.supportScore">Support Score</option>
                        <option value="communication" data-i18n="tracking.communicationFrequency">Communication Frequency</option>
                        <option value="food" data-i18n="tracking.foodContribution">Food Contributions</option>
                        <option value="safety" data-i18n="tracking.safetyFeeling">Safety Score</option>
                        <option value="feedback_response" data-i18n="tracking.feedbackResponseTime">Feedback Response Time</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="trackingChart"></canvas>
                </div>
            </section>

            <section id="contributions" class="content-section">
                <h2 class="text-3xl font-semibold mb-6 text-rose-500" data-i18n="contributions.title">Individual Contributions</h2>
                <p class="text-gray-600 mb-4" data-i18n="contributions.description">A look at who contributed what in different areas of our life together.</p>
                <div class="mb-6">
                    <label for="contributionFilterWeek" class="mr-2 font-medium text-gray-700" data-i18n="contributions.filterWeek">Filter by Week:</label>
                    <select id="contributionFilterWeek" class="p-2 border border-gray-300 rounded-md shadow-sm focus:ring-rose-500 focus:border-rose-500">
                        </select>
                </div>
                <div class="overflow-x-auto bg-white shadow-md rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200 contribution-table">
                        <thead>
                            <tr>
                                <th data-i18n="contributions.table.parameter">Parameter</th>
                                <th data-i18n="contributions.table.salatiso">Salatiso's Contribution</th>
                                <th data-i18n="contributions.table.tee">Tee's Contribution</th>
                                <th data-i18n="contributions.table.details">Details/Notes</th>
                            </tr>
                        </thead>
                        <tbody id="contributionsTableBody">
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="reinforcement" class="content-section">
                <h2 class="text-3xl font-semibold mb-6 text-rose-500" data-i18n="reinforcement.title">Reinforcement Words & Actions</h2>
                <div class="overflow-x-auto bg-white shadow-md rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200 contribution-table">
                        <thead>
                            <tr>
                                <th data-i18n="reinforcement.table.wordAction">Word/Action</th>
                                <th data-i18n="reinforcement.table.purpose">Purpose</th>
                                <th data-i18n="reinforcement.table.occurred">Occurred (Weeks)</th>
                                <th data-i18n="reinforcement.table.notOccurred">Not Occurred (Weeks)</th>
                            </tr>
                        </thead>
                        <tbody id="reinforcementTableBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="lifesync" class="content-section">
                <h2 class="text-3xl font-semibold mb-6 text-rose-500" data-i18n="lifesync.title">LifeSync Analysis</h2>
                 <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-medium text-gray-700 mb-3" data-i18n="lifesync.reportGen">Generate Relationship Report</h3>
                    <div class="flex items-center space-x-3">
                        <select id="lifesyncPeriodSelect" class="p-2 border border-gray-300 rounded-md shadow-sm focus:ring-rose-500 focus:border-rose-500">
                            <option value="3m" data-i18n="lifesync.last3Months">Last 3 Months</option>
                            <option value="6m" data-i18n="lifesync.last6Months">Last 6 Months</option>
                            <option value="1y" data-i18n="lifesync.lastYear">Last Year</option>
                            <option value="all" data-i18n="lifesync.allTime">All Time</option>
                        </select>
                        <button class="action-button" data-i18n="lifesync.generateButton">Generate Report</button>
                    </div>
                    <p class="mt-4 text-sm text-gray-500" data-i18n="lifesync.reportNote">(Placeholder)</p>
                </div>
            </section>

            <section id="insights" class="content-section">
                <h2 class="text-3xl font-semibold mb-6 text-rose-500" data-i18n="insights.title">Affection & Intimacy Insights</h2>
                <div class="relative">
                     <button id="insights-scroll-left" class="absolute left-0 top-1/2 transform -translate-y-1/2 z-10 bg-white/70 hover:bg-white p-2 rounded-full shadow-md text-rose-500"><i class="fas fa-chevron-left"></i></button>
                    <div id="insightsCarousel" class="carousel-container"></div>
                     <button id="insights-scroll-right" class="absolute right-0 top-1/2 transform -translate-y-1/2 z-10 bg-white/70 hover:bg-white p-2 rounded-full shadow-md text-rose-500"><i class="fas fa-chevron-right"></i></button>
                </div>
            </section>

            <section id="funtools" class="content-section">
                <h2 class="text-3xl font-semibold mb-6 text-rose-500" data-i18n="funtools.title">Fun Tools & Activities</h2>
                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-medium text-gray-700 mb-3" data-i18n="funtools.astrology.title">Astrology Compatibility</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="salatisoBday" class="block text-sm font-medium text-gray-700" data-i18n="funtools.astrology.salatisoBday">Salatiso's Birthday (YYYY-MM-DD):</label>
                            <input type="date" id="salatisoBday" value="1982-09-16" class="input-field">
                        </div>
                        <div>
                            <label for="teeBday" class="block text-sm font-medium text-gray-700" data-i18n="funtools.astrology.teeBday">Tee's Birthday (YYYY-MM-DD):</label>
                            <input type="date" id="teeBday" value="1990-05-05" class="input-field"> </div>
                    </div>
                    <button id="checkCompatibilityBtn" class="action-button" data-i18n="funtools.astrology.checkButton">Check Compatibility</button>
                    <div id="astrologyResult" class="mt-4 p-4 bg-rose-50 rounded-md text-gray-700"></div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-medium text-gray-700 mb-3" data-i18n="funtools.quizzes.title">Relationship Quizzes</h3>
                    <p class="text-gray-500" data-i18n="funtools.quizzes.placeholder">Quizzes coming soon! Test your knowledge about each other or explore relationship dynamics.</p>
                    </div>
            </section>

            <section id="feedback" class="content-section">
                <h2 class="text-3xl font-semibold mb-6 text-rose-500" data-i18n="feedback.title">Feedback Exchange</h2>
                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-medium text-gray-700 mb-3" data-i18n="feedback.giveFeedback">Give Feedback</h3>
                    <div>
                        <label for="feedbackRecipient" class="block text-sm font-medium text-gray-700" data-i18n="feedback.recipient">Recipient:</label>
                        <select id="feedbackRecipient" class="input-field mb-2">
                            <option value="Tee" data-i18n="feedback.tee">Tee</option>
                            <option value="Salatiso" data-i18n="feedback.salatiso">Salatiso</option>
                        </select>
                    </div>
                    <div>
                        <label for="feedbackMessage" class="block text-sm font-medium text-gray-700" data-i18n="feedback.message">Message:</label>
                        <textarea id="feedbackMessage" rows="3" class="input-field"></textarea>
                    </div>
                    <button id="sendFeedbackBtn" class="action-button mt-2" data-i18n="feedback.sendButton">Send Feedback</button>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-medium text-gray-700 mb-3" data-i18n="feedback.receivedFeedback">Received Feedback / Log</h3>
                    <div id="feedbackLogContainer">
                        </div>
                </div>
            </section>

        </main>

        <footer class="bg-white border-t border-gray-200 mt-auto">
            <div class="container mx-auto px-6 py-4 text-center text-gray-600 text-sm">
                <p>© <span id="currentYear"></span> <span data-i18n="footer.text">Tee & Me. A digital chronicle of our love.</span></p>
            </div>
        </footer>
    </div>

    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeModalButton">×</span>
            <h3 id="modalTitle" class="text-xl font-semibold mb-4 text-rose-600">Details</h3>
            <div id="modalBody" class="text-gray-700">
                <div class="relative">
                    <button id="modal-carousel-prev" class="absolute -left-3 top-1/2 transform -translate-y-1/2 z-20 bg-white/70 hover:bg-white p-1 rounded-full shadow-md text-rose-500 text-xs"><i class="fas fa-chevron-left"></i></button>
                    <div id="modalCarouselContainer" class="carousel-container messages-carousel" style="max-height: 300px; overflow-y:auto;"></div>
                    <button id="modal-carousel-next" class="absolute -right-3 top-1/2 transform -translate-y-1/2 z-20 bg-white/70 hover:bg-white p-1 rounded-full shadow-md text-rose-500 text-xs"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- i18next Configuration ---
        const translations = {
            en: {
                translation: {
                    websiteTitle: "Tee & Me - Our Story",
                    headerTitle: "Tee & Me",
                    nav: {
                        overview: "Overview", timeline: "Timeline", tracking: "Tracking",
                        contributions: "Contributions", reinforcement: "Reinforcement",
                        lifesync: "LifeSync", insights: "Insights", funtools: "Fun Tools", feedback: "Feedback"
                    },
                    overview: {
                        title: "Our Journey Snapshot", dashboardTitle: "Relationship Dashboard",
                        affectionLevel: "Affection", supportScore: "Support", sharedInterests: "Shared Interests",
                        commFrequency: "Communication", foodContribution: "Food Prep", safetyFeeling: "Safety/Security",
                        weeklyAverage: "Weekly Avg", basedOnFavors: "Mutual Support", activeShared: "Shared Activities",
                        dailyMessages: "Avg Daily Msgs", selectMetric: "Display:",
                        ourSong: "Our Special Song", playSong: "Play \"You're Still The One\""
                    },
                    timeline: { /* ... existing ... */ week: "Week", seeDetails: "See Details" },
                    tracking: {
                        title: "Relationship Tracking", description: "Visualize aspects over time.",
                        selectAspect: "Track:", affectionLevel: "Affection", supportScore: "Support",
                        communicationFrequency: "Communication", foodContribution: "Food Prep", safetyFeeling: "Safety Score",
                        feedbackResponseTime: "Feedback Response Time"
                    },
                    contributions: {
                        title: "Individual Contributions",
                        description: "Who contributed what in different areas.",
                        filterWeek: "Filter by Week:",
                        table: { parameter: "Parameter", salatiso: "Salatiso's Input", tee: "Tee's Input", details: "Details" },
                        params: { food: "Food Preparation", safety: "Safety & Security", chores: "Household Chores", planning: "Activity Planning" }
                    },
                    reinforcement: { /* ... existing ... */ },
                    lifesync: { /* ... existing ... */ },
                    insights: { /* ... existing ... */ },
                    funtools: {
                        title: "Fun Tools & Activities",
                        astrology: { title: "Astrology Compatibility", salatisoBday: "Salatiso's Birthday (YYYY-MM-DD):", teeBday: "Tee's Birthday (YYYY-MM-DD):", checkButton: "Check Compatibility" },
                        quizzes: { title: "Relationship Quizzes", placeholder: "Quizzes coming soon!" }
                    },
                    feedback: {
                        title: "Feedback Exchange", giveFeedback: "Give Feedback", recipient: "Recipient:",
                        tee: "Tee", salatiso: "Salatiso", message: "Message:", sendButton: "Send Feedback",
                        receivedFeedback: "Received Feedback / Log", feedbackFrom: "Feedback from {sender}",
                        respondedIn: "Responded in: {duration}", pendingResponse: "Pending response", markAsRead: "Mark as Read/Responded"
                    },
                    footer: { text: "Tee & Me. A digital chronicle of our love." },
                    modal: { detailsTitle: "Details for Week {weekNumber}" }
                }
            },
            xh: { // NOTE: Xhosa translations need to be comprehensive for new sections
                translation: {
                    websiteTitle: "Tee & Me - Ibali Lethu", headerTitle: "Tee & Me",
                    nav: {
                        overview: "Isishwankathelo", timeline: "Umzila Wexesha", tracking: "Ukulandelela",
                        contributions: "Igalelo Lomntu", reinforcement: "Ukuqinisa",
                        lifesync: "LifeSync", insights: "Ukuqonda", funtools: "Izixhobo Zolonwabo", feedback: "Impendulo"
                    },
                    overview: {
                        title: "Isishwankathelo Sohambo Lwethu", dashboardTitle: "Ideshibhodi Yobudlelwane",
                        affectionLevel: "Uthando", supportScore: "Inkxaso", sharedInterests: "Ezabelwanayo",
                        commFrequency: "Unxibelelwano", foodContribution: "Ukulung. Ukutya", safetyFeeling: "Ukhuseleko",
                        selectMetric: "Bonisa:",
                        ourSong: "Ingoma Yethu Ekhethekileyo", playSong: "Dlala \"You're Still The One\""
                    },
                    timeline: { /* ... existing ... */ week: "Iveki", seeDetails: "Bona Iinkcukacha" },
                    tracking: {
                        title: "Ukulandelela Ubudlelwane", description: "Bonisa iinkalo ngokuhamba kwexesha.",
                        selectAspect: "Landelela:", affectionLevel: "Uthando", supportScore: "Inkxaso",
                        communicationFrequency: "Unxibelelwano", foodContribution: "Ukulung. Ukutya", safetyFeeling: "Ukhuseleko",
                        feedbackResponseTime: "Ixesha Lokuphendula"
                    },
                    contributions: {
                        title: "Igalelo Lomntu Ngamnye",
                        description: "Ngubani onikele ntoni kwiinkalo ezahlukeneyo.",
                        filterWeek: "Hluza ngeVeki:",
                        table: { parameter: "Inkalo", salatiso: "Igalelo likaSalatiso", tee: "Igalelo likaTee", details: "Iinkcukacha" },
                        params: { food: "Ukulungiselela Ukutya", safety: "Ukhuseleko Nokhuseleko", chores: "Imisebenzi Yasekhaya", planning: "Ukucwangciswa Kwemisebenzi" }
                    },
                     funtools: {
                        title: "Izixhobo Zolonwabo Nemisebenzi",
                        astrology: { title: "Ukuhambelana Kweenkwenkwezi", salatisoBday: "Usuku lokuzalwa lukaSalatiso (YYYY-MM-DD):", teeBday: "Usuku lokuzalwa lukaTee (YYYY-MM-DD):", checkButton: "Jonga Ukuhambelana" },
                        quizzes: { title: "Imibuzo Yobudlelwane", placeholder: "Imibuzo iyeza kungekudala!" }
                    },
                    feedback: {
                        title: "Utshintshiselwano Ngempendulo", giveFeedback: "Nika Impendulo", recipient: "Umamkeli:",
                        tee: "Tee", salatiso: "Salatiso", message: "Umyalezo:", sendButton: "Thumela Impendulo",
                        receivedFeedback: "Impendulo Efunyenweyo / ILogi", feedbackFrom: "Impendulo evela ku {sender}",
                        respondedIn: "Uphendule ngexesha: {duration}", pendingResponse: "Kulindelwe impendulo", markAsRead: "Phawula Njengokufundiweyo/Kuphenduliwe"
                    },
                    footer: { text: "Tee & Me. Isikhumbuzo sothando lwethu sedijithali." },
                    modal: { detailsTitle: "Iinkcukacha zeVeki {weekNumber}" }
                }
            }
        };
        // --- Initialize i18next ---
        i18next.use(i18nextBrowserLanguageDetector).init({
            debug: true, fallbackLng: 'en', resources: translations
        }, (err, t) => { if (err) return console.error(err); updateContentAll(); });

        function updateContentAll() { // Renamed to avoid conflict
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const optionsAttr = el.getAttribute('data-i18n-options');
                let options = {};
                if (optionsAttr) {
                    try { options = JSON.parse(optionsAttr); } catch (e) { console.error("Error parsing i18n options", e); }
                }
                el.innerHTML = i18next.t(key, options);
            });
            // Specific updates for dynamic content after language change
            renderTimeline();
            renderReinforcementTable();
            renderInsightsCarousel();
            renderContributionsTable(document.getElementById('contributionFilterWeek').value || relationshipData.weeks[0]?.weekNumber.toString());
            renderFeedbackLog();
            updateDashboardMetrics(); // Update dashboard text metrics
            updateDashboardChart(document.getElementById('dashboardMetricSelect').value);
            updateTrackingChart(document.getElementById('trackingMetricSelect').value);
        }
        document.getElementById('lang-en').addEventListener('click', () => i18next.changeLanguage('en', updateContentAll));
        document.getElementById('lang-xh').addEventListener('click', () => i18next.changeLanguage('xh', updateContentAll));

        // --- Enhanced Data Structure ---
        const relationshipData = {
            weeks: [
                { 
                    weekNumber: 1, startDate: "2024-05-20", 
                    affection: { salatiso: 7, tee: 8, shared: 7.5 }, 
                    support: { salatiso: 8, tee: 9, shared: 8.5 },
                    communication: { salatiso: 9, tee: 8, shared: 8.5 },
                    food: { salatisoActions: ["Bought groceries"], teeActions: ["Cooked dinner twice"], score: 7 },
                    safety: { salatisoActions: ["Locked doors nightly"], teeActions: ["Checked windows"], score: 9, feeling: "Secure" },
                    summaryKey: "timeline.week1.summary", 
                    events: [/* ... existing events ... */] 
                },
                // ... more weeks with detailed contributions
            ],
            reinforcementWords: [ /* ... existing ... */ ],
            insightsData: [ /* ... existing ... */ ],
            feedbackLog: [
                { id: 1, sender: "Salatiso", recipient: "Tee", messageKey: "feedback.sampleMsg1", timestamp: new Date(2024, 5, 1, 10, 0, 0).toISOString(), response: null, responseTimestamp: null },
                { id: 2, sender: "Tee", recipient: "Salatiso", messageKey: "feedback.sampleMsg2", timestamp: new Date(2024, 5, 2, 14, 0, 0).toISOString(), response: "Thanks for sharing, let's discuss.", responseTimestamp: new Date(2024, 5, 2, 18, 30, 0).toISOString() }
            ],
            // Add translation keys for sample feedback messages
        };
        // Add sample feedback message translations
        translations.en.translation.feedback.sampleMsg1 = "Just wanted to say I appreciate when you make coffee in the morning!";
        translations.xh.translation.feedback.sampleMsg1 = "Bendingafuna ukuthi enkosi xa usenza ikofu ekuseni!";
        translations.en.translation.feedback.sampleMsg2 = "I felt a bit unheard during our chat about weekend plans.";
        translations.xh.translation.feedback.sampleMsg2 = "Ndizive ngathi andiphulaphulwanga kakuhle ngexesha besincokola ngezicwangciso zempelaveki.";


        // --- DOM Elements ---
        const navButtons = document.querySelectorAll('.nav-button');
        const contentSections = document.querySelectorAll('.content-section');
        const timelineCarousel = document.getElementById('timelineCarousel');
        const reinforcementTableBody = document.getElementById('reinforcementTableBody');
        const insightsCarousel = document.getElementById('insightsCarousel');
        const dashboardChartCanvas = document.getElementById('dashboardChart').getContext('2d');
        const trackingChartCanvas = document.getElementById('trackingChart').getContext('2d');
        const dashboardMetricSelect = document.getElementById('dashboardMetricSelect');
        const trackingMetricSelect = document.getElementById('trackingMetricSelect');
        const contributionsTableBody = document.getElementById('contributionsTableBody');
        const contributionFilterWeek = document.getElementById('contributionFilterWeek');
        const salatisoBdayInput = document.getElementById('salatisoBday');
        const teeBdayInput = document.getElementById('teeBday');
        const checkCompatibilityBtn = document.getElementById('checkCompatibilityBtn');
        const astrologyResult = document.getElementById('astrologyResult');
        const feedbackRecipient = document.getElementById('feedbackRecipient');
        const feedbackMessage = document.getElementById('feedbackMessage');
        const sendFeedbackBtn = document.getElementById('sendFeedbackBtn');
        const feedbackLogContainer = document.getElementById('feedbackLogContainer');

        const modal = document.getElementById('detailsModal');
        const closeModalButton = document.getElementById('closeModalButton');
        const modalTitle = document.getElementById('modalTitle');
        const modalCarouselContainer = document.getElementById('modalCarouselContainer');
        let currentModalCarouselIndex = 0;
        let modalCarouselItems = [];
        let dashboardChart, trackingChart;

        // --- Helper Functions ---
        function getOverallWeeklyScore(metric, weekData) {
            if (weekData[metric] && typeof weekData[metric].shared !== 'undefined') return weekData[metric].shared;
            if (weekData[metric] && typeof weekData[metric].score !== 'undefined') return weekData[metric].score;
            if (weekData[metric] && typeof weekData[metric] === 'number') return weekData[metric]; // backward compatibility
            return 0; // Default if structure is different or missing
        }

        function getWeeklyDataForChart(metric) {
            return relationshipData.weeks.map(week => getOverallWeeklyScore(metric, week));
        }
        
        function getWeekLabels() {
            return relationshipData.weeks.map(week => `${i18next.t('timeline.week')} ${week.weekNumber} (${week.startDate})`);
        }

        function populateWeekFilter() {
            contributionFilterWeek.innerHTML = relationshipData.weeks.map(week => 
                `<option value="${week.weekNumber}">${i18next.t('timeline.week')} ${week.weekNumber} (${week.startDate})</option>`
            ).join('');
            if (relationshipData.weeks.length > 0) {
                 contributionFilterWeek.value = relationshipData.weeks[0].weekNumber; // Default to first week
            }
        }

        // --- Render Functions ---
        function renderTimeline() { /* ... (keep existing, ensure it uses i18next.t for summaryKey) ... */
             timelineCarousel.innerHTML = ''; 
            relationshipData.weeks.forEach(week => {
                const item = document.createElement('div');
                item.className = 'carousel-item';
                item.innerHTML = `
                    <h4 class="font-semibold text-lg mb-2 text-rose-600">${i18next.t('timeline.week')} ${week.weekNumber} (${week.startDate})</h4>
                    <p class="text-sm text-gray-600 mb-3">${i18next.t(week.summaryKey) || "Summary not available."}</p>
                    <button class="text-sm bg-rose-500 hover:bg-rose-600 text-white py-1 px-3 rounded-md see-details-btn" data-week="${week.weekNumber}">${i18next.t('timeline.seeDetails')}</button>
                `;
                timelineCarousel.appendChild(item);
            });
            addSeeDetailsListeners();
        }
        function addSeeDetailsListeners() { /* ... (keep existing) ... */
             document.querySelectorAll('.see-details-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const weekNumber = parseInt(this.dataset.week);
                    const weekData = relationshipData.weeks.find(w => w.weekNumber === weekNumber);
                    if (weekData) {
                        modalTitle.textContent = i18next.t('modal.detailsTitle', { weekNumber: weekData.weekNumber });
                        modalCarouselItems = weekData.events || [];
                        currentModalCarouselIndex = 0;
                        renderModalCarousel();
                        modal.style.display = 'block';
                    }
                });
            });
        }
        function renderModalCarousel() { /* ... (keep existing) ... */
            modalCarouselContainer.innerHTML = '';
            if (modalCarouselItems.length === 0) {
                modalCarouselContainer.innerHTML = `<p class="text-gray-500 p-4">No specific events recorded for this week.</p>`;
                document.getElementById('modal-carousel-prev').style.display = 'none';
                document.getElementById('modal-carousel-next').style.display = 'none';
                return;
            }

            document.getElementById('modal-carousel-prev').style.display = modalCarouselItems.length > 1 ? 'block' : 'none';
            document.getElementById('modal-carousel-next').style.display = modalCarouselItems.length > 1 ? 'block' : 'none';

            modalCarouselItems.forEach((event, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'carousel-item modal-carousel-slide p-3'; 
                itemDiv.style.width = 'calc(100% - 20px)'; 
                itemDiv.style.display = index === currentModalCarouselIndex ? 'block' : 'none'; 
                
                let eventText = i18next.t(event.textKey) || event.textKey; 
                let originalMessageHTML = event.originalMessage ? `<p class="mt-2 text-xs text-gray-500 italic">"${event.originalMessage}"</p>` : "";

                itemDiv.innerHTML = `
                    <p class="text-sm font-medium text-gray-800">${eventText}</p>
                    ${event.url ? `<a href="${event.url}" target="_blank" class="text-rose-500 hover:underline text-sm">View Link</a>` : ''}
                    ${originalMessageHTML}
                `;
                modalCarouselContainer.appendChild(itemDiv);
            });
        }


        function renderReinforcementTable() { /* ... (keep existing) ... */
            reinforcementTableBody.innerHTML = '';
            relationshipData.reinforcementWords.forEach(item => {
                const row = reinforcementTableBody.insertRow();
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${i18next.t(item.wordActionKey)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${i18next.t(item.purposeKey)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.occurredWeeks.join(', ')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.notOccurredWeeks.join(', ')}</td>
                `;
            });
        }
        function renderInsightsCarousel() { /* ... (keep existing) ... */
             insightsCarousel.innerHTML = '';
            relationshipData.insightsData.forEach(insight => {
                const item = document.createElement('div');
                item.className = 'carousel-item';
                item.innerHTML = `
                    <h4 class="font-semibold text-lg mb-2 text-rose-600">${i18next.t('timeline.week')} ${insight.weekNumber}</h4>
                    <p class="text-sm text-gray-700 mb-1"><strong>${i18next.t('overview.affectionLevel')}:</strong> ${i18next.t(insight.affectionDetailKey) || "Details not available."}</p>
                    <p class="text-sm text-gray-700"><strong>${i18next.t('insights.title')}:</strong> ${i18next.t(insight.intimacyDetailKey) || "Details not available."}</p>
                `;
                insightsCarousel.appendChild(item);
            });
        }

        function renderContributionsTable(weekNum) {
            contributionsTableBody.innerHTML = '';
            const weekNumber = parseInt(weekNum);
            const weekData = relationshipData.weeks.find(w => w.weekNumber === weekNumber);

            if (!weekData) {
                contributionsTableBody.innerHTML = `<tr><td colspan="4" class="text-center py-4">${i18next.t("contributions.noDataForWeek")}</td></tr>`;
                return;
            }
            
            const parametersToDisplay = ['food', 'safety', 'chores', 'planning']; // Add more as needed

            parametersToDisplay.forEach(paramKey => {
                const paramData = weekData[paramKey];
                if (paramData) {
                    const row = contributionsTableBody.insertRow();
                    row.innerHTML = `
                        <td>${i18next.t(`contributions.params.${paramKey}`)}</td>
                        <td>${(paramData.salatisoActions || []).join(', ') || i18next.t("contributions.noneReported")}</td>
                        <td>${(paramData.teeActions || []).join(', ') || i18next.t("contributions.noneReported")}</td>
                        <td>${paramData.details || paramData.feeling || ''} (Score: ${paramData.score || 'N/A'})</td>
                    `;
                }
            });
            // Add specific affection/support/communication if desired
            const affectionRow = contributionsTableBody.insertRow();
            affectionRow.innerHTML = `
                <td>${i18next.t("overview.affectionLevel")}</td>
                <td>Salatiso: ${weekData.affection?.salatiso || 'N/A'}</td>
                <td>Tee: ${weekData.affection?.tee || 'N/A'}</td>
                <td>Shared: ${weekData.affection?.shared || 'N/A'}</td>
            `;
            // Similar rows for support, communication
        }
        
        function renderFeedbackLog() {
            feedbackLogContainer.innerHTML = '';
            if (relationshipData.feedbackLog.length === 0) {
                feedbackLogContainer.innerHTML = `<p class="text-gray-500">${i18next.t("feedback.noFeedbackYet")}</p>`;
                return;
            }
            relationshipData.feedbackLog.slice().reverse().forEach(item => { // Show newest first
                const div = document.createElement('div');
                div.className = 'feedback-item';
                let responseText = i18next.t("feedback.pendingResponse");
                if (item.responseTimestamp) {
                    const duration = new Date(item.responseTimestamp).getTime() - new Date(item.timestamp).getTime();
                    const hours = Math.floor(duration / (1000 * 60 * 60));
                    const minutes = Math.floor((duration % (1000 * 60 * 60)) / (1000 * 60));
                    responseText = i18next.t("feedback.respondedIn", { duration: `${hours}h ${minutes}m` });
                }

                div.innerHTML = `
                    <p class="font-semibold text-rose-700">${i18next.t("feedback.feedbackFrom", { sender: i18next.t(`feedback.${item.sender.toLowerCase()}`) })} to ${i18next.t(`feedback.${item.recipient.toLowerCase()}`)}</p>
                    <p class="text-sm text-gray-500">${new Date(item.timestamp).toLocaleString()}</p>
                    <p class="my-2">${i18next.t(item.messageKey) || item.message}</p> ${item.response ? `<p class="mt-1 p-2 bg-rose-100 rounded text-sm"><strong>Response:</strong> ${item.response}</p>` : ''}
                    <p class="text-xs mt-2 ${item.responseTimestamp ? 'text-green-600' : 'text-orange-600'}">${responseText}</p>
                    ${!item.responseTimestamp ? `<button class="text-xs action-button mt-1 mark-read-btn" data-id="${item.id}">${i18next.t("feedback.markAsRead")}</button>` : ''}
                `;
                feedbackLogContainer.appendChild(div);
            });

            document.querySelectorAll('.mark-read-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const feedbackId = parseInt(this.dataset.id);
                    const feedbackItem = relationshipData.feedbackLog.find(fb => fb.id === feedbackId);
                    if (feedbackItem && !feedbackItem.responseTimestamp) {
                        feedbackItem.responseTimestamp = new Date().toISOString();
                        feedbackItem.response = "Acknowledged."; // Default acknowledgement
                        renderFeedbackLog(); // Re-render
                        // Potentially update tracking data for response times
                        updateFeedbackResponseTimeData();
                    }
                });
            });
        }
        
        function updateFeedbackResponseTimeData() {
            // This function would calculate average response times and update a data series for the tracking chart
            // For now, it's a placeholder for more complex logic
            console.log("Feedback response times would be updated here.");
            // Example: if trackingChart is active and showing feedback_response, update it
            if (document.getElementById('tracking').classList.contains('active') && trackingMetricSelect.value === 'feedback_response') {
                 updateTrackingChart('feedback_response');
            }
        }


        // --- Charting ---
        const commonChartOptions = { /* ... (keep existing) ... */
             responsive: true, maintainAspectRatio: false,
            scales: { y: { beginAtZero: true, suggestedMax: 10 } },
            plugins: { legend: { labels: { color: '#333' } } },
            interaction: { mode: 'index', intersect: false, },
            elements: { line: { tension: 0.4 }, point: { radius: 4, hoverRadius: 6, backgroundColor: '#f43f5e' } }
        };

        function updateDashboardChart(metricKey = 'affection') {
            const data = {
                labels: getWeekLabels().slice(0, 12),
                datasets: [{
                    label: i18next.t(`overview.${metricKey}Level`) || i18next.t(`overview.${metricKey}Score`) || i18next.t(`overview.${metricKey}Frequency`) || i18next.t(`overview.${metricKey}Contribution`) || i18next.t(`overview.${metricKey}Feeling`),
                    data: getWeeklyDataForChart(metricKey).slice(0, 12),
                    borderColor: '#f43f5e', backgroundColor: 'rgba(244, 63, 94, 0.2)', fill: true,
                }]
            };
            if (dashboardChart) dashboardChart.destroy();
            dashboardChart = new Chart(dashboardChartCanvas, { type: 'line', data, options: commonChartOptions });
        }

        function updateTrackingChart(metricKey = 'affection') {
             let dataSet;
            if (metricKey === 'feedback_response') {
                // Calculate response times (in hours for simplicity)
                const responseTimes = relationshipData.feedbackLog.map(fb => {
                    if (fb.responseTimestamp) {
                        const diffMs = new Date(fb.responseTimestamp) - new Date(fb.timestamp);
                        return Math.max(0, diffMs / (1000 * 60 * 60)); // hours, non-negative
                    }
                    return null; // No response yet
                }).filter(rt => rt !== null);

                dataSet = {
                    label: i18next.t('tracking.feedbackResponseTime'),
                    data: responseTimes, // This will be sparse if few responses
                    borderColor: '#059669', // emerald-600
                    backgroundColor: 'rgba(5, 150, 105, 0.2)',
                    fill: true,
                };
                 // For feedback, labels might be feedback item IDs or dates
                const feedbackLabels = relationshipData.feedbackLog.filter(fb => fb.responseTimestamp).map((fb, idx) => `Feedback ${fb.id}`);
                 data = {
                    labels: feedbackLabels.length > 0 ? feedbackLabels : ["No responses yet"],
                    datasets: [dataSet]
                };

            } else {
                 dataSet = {
                    label: i18next.t(`tracking.${metricKey}Level`) || i18next.t(`tracking.${metricKey}Score`) || i18next.t(`tracking.${metricKey}Frequency`) || i18next.t(`tracking.${metricKey}Contribution`) || i18next.t(`tracking.${metricKey}Feeling`),
                    data: getWeeklyDataForChart(metricKey),
                    borderColor: '#e11d48', backgroundColor: 'rgba(225, 29, 72, 0.2)', fill: true,
                };
                 data = {
                    labels: getWeekLabels(),
                    datasets: [dataSet]
                };
            }
           
            if (trackingChart) trackingChart.destroy();
            trackingChart = new Chart(trackingChartCanvas, { type: 'line', data, options: commonChartOptions });
        }
        
        function updateDashboardMetrics() {
            // Calculate overall averages or latest scores for dashboard cards
            const numWeeks = relationshipData.weeks.length;
            if (numWeeks === 0) return;

            const avgAffection = relationshipData.weeks.reduce((sum, w) => sum + getOverallWeeklyScore('affection', w), 0) / numWeeks;
            const avgSupport = relationshipData.weeks.reduce((sum, w) => sum + getOverallWeeklyScore('support', w), 0) / numWeeks;
            const avgFood = relationshipData.weeks.reduce((sum, w) => sum + getOverallWeeklyScore('food', w), 0) / numWeeks;
            const avgSafety = relationshipData.weeks.reduce((sum, w) => sum + getOverallWeeklyScore('safety', w), 0) / numWeeks;

            document.getElementById('affection-metric').textContent = `${avgAffection.toFixed(1)}/10`;
            document.getElementById('support-metric').textContent = `${avgSupport.toFixed(1)}/10`;
            document.getElementById('food-metric').textContent = `${avgFood.toFixed(1)}/10`;
            document.getElementById('safety-metric').textContent = `${avgSafety.toFixed(1)}/10`;
        }

        // --- Astrology Tool ---
        function getZodiacSign(date) {
            const day = date.getDate();
            const month = date.getMonth() + 1;
            if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) return "Aquarius";
            if ((month == 2 && day >= 19) || (month == 3 && day <= 20)) return "Pisces";
            if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) return "Aries";
            if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) return "Taurus"; // Tee: Early May
            if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) return "Gemini";
            if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) return "Cancer";
            if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) return "Leo";
            if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) return "Virgo"; // Salatiso: Sep 16
            if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) return "Libra";
            if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) return "Scorpio";
            if ((month == 11 && day >= 22) || (month == 12 && day <= 21)) return "Sagittarius";
            if ((month == 12 && day >= 22) || (month == 1 && day <= 19)) return "Capricorn";
            return "Unknown";
        }

        checkCompatibilityBtn.addEventListener('click', () => {
            const salatisoDate = new Date(salatisoBdayInput.value);
            const teeDate = new Date(teeBdayInput.value);

            if (isNaN(salatisoDate) || isNaN(teeDate)) {
                astrologyResult.innerHTML = `<p class="text-red-500">${i18next.t("funtools.astrology.invalidDate") || "Please enter valid dates."}</p>`;
                return;
            }
            
            const salatisoSign = getZodiacSign(salatisoDate);
            const teeSign = getZodiacSign(teeDate);

            let compatibilityText = `${i18next.t("funtools.astrology.salatisoIsA")} ${salatisoSign}. ${i18next.t("funtools.astrology.teeIsA")} ${teeSign}. `;
            // Simple compatibility (can be expanded)
            if ((salatisoSign === "Virgo" && teeSign === "Taurus") || (salatisoSign === "Taurus" && teeSign === "Virgo")) {
                compatibilityText += i18next.t("funtools.astrology.virgoTaurus") || "Virgo and Taurus are earth signs that often form a stable and practical bond. You appreciate each other's diligence and loyalty. Grounded and sensual, you can build a beautiful life together!";
            } else {
                compatibilityText += i18next.t("funtools.astrology.general") || "Every sign combination has its unique strengths and challenges. Focus on communication and understanding!";
            }
            astrologyResult.innerHTML = `<p>${compatibilityText}</p>`;
            updateContentAll(); // To translate new astrology text
        });
         // Add new i18n keys for astrology
        translations.en.translation.funtools.astrology.invalidDate = "Please enter valid dates.";
        translations.en.translation.funtools.astrology.salatisoIsA = "Salatiso is a";
        translations.en.translation.funtools.astrology.teeIsA = "Tee is a";
        translations.en.translation.funtools.astrology.virgoTaurus = "Virgo and Taurus are earth signs that often form a stable and practical bond. You appreciate each other's diligence and loyalty. Grounded and sensual, you can build a beautiful life together!";
        translations.en.translation.funtools.astrology.general = "Every sign combination has its unique strengths and challenges. Focus on communication and understanding!";
        translations.xh.translation.funtools.astrology.invalidDate = "Nceda faka imihla efanelekileyo.";
        translations.xh.translation.funtools.astrology.salatisoIsA = "USalatiso ngu";
        translations.xh.translation.funtools.astrology.teeIsA = "UTee ngu";
        translations.xh.translation.funtools.astrology.virgoTaurus = "IVirgo neTaurus ziimpawu zomhlaba ezihlala zisenza ubuhlobo obuzinzileyo nobusebenzayo. Niyabukana ngokukhuthala nokunyaniseka. Nizinzile kwaye ninothando, ningakha ubomi obuhle kunye!";
        translations.xh.translation.funtools.astrology.general = "Yonke indibanisela yeempawu inamandla ayo awodwa kunye nemingeni. Gxilani kunxibelelwano nokuqondana!";
        translations.en.translation.contributions.noDataForWeek = "No specific contribution data recorded for this week.";
        translations.xh.translation.contributions.noDataForWeek = "Akukho datha yegalelo ethile erekhodiweyo kule veki.";
        translations.en.translation.contributions.noneReported = "None reported";
        translations.xh.translation.contributions.noneReported = "Akukho nto ixeliweyo";
        translations.en.translation.feedback.noFeedbackYet = "No feedback messages yet.";
        translations.xh.translation.feedback.noFeedbackYet = "Akukho miyalezo yempendulo okwangoku.";



        // --- Feedback Tool ---
        sendFeedbackBtn.addEventListener('click', () => {
            const recipient = feedbackRecipient.value;
            const message = feedbackMessage.value.trim();
            const sender = recipient === "Tee" ? "Salatiso" : "Tee"; // Determine sender based on recipient

            if (!message) {
                alert(i18next.t("feedback.messageEmpty") || "Message cannot be empty."); // Simple alert for now
                return;
            }

            const newFeedback = {
                id: relationshipData.feedbackLog.length + 1,
                sender: sender,
                recipient: recipient,
                message: message, // Store raw message, can be keyed for translation if it's predefined
                timestamp: new Date().toISOString(),
                response: null,
                responseTimestamp: null
            };
            relationshipData.feedbackLog.push(newFeedback);
            renderFeedbackLog();
            feedbackMessage.value = ''; // Clear textarea
        });
         translations.en.translation.feedback.messageEmpty = "Message cannot be empty.";
         translations.xh.translation.feedback.messageEmpty = "Umyalezo awunakuba nto.";


        // --- Event Listeners ---
        navButtons.forEach(button => {
            button.addEventListener('click', function() {
                navButtons.forEach(btn => btn.classList.remove('active-nav'));
                this.classList.add('active-nav');
                const targetSection = this.dataset.section;
                contentSections.forEach(section => section.classList.toggle('active', section.id === targetSection));
                
                if (targetSection === 'overview') { updateDashboardMetrics(); updateDashboardChart(dashboardMetricSelect.value); }
                if (targetSection === 'tracking') updateTrackingChart(trackingMetricSelect.value);
                if (targetSection === 'contributions') renderContributionsTable(contributionFilterWeek.value || relationshipData.weeks[0]?.weekNumber.toString());
                if (targetSection === 'feedback') renderFeedbackLog();
            });
        });

        dashboardMetricSelect.addEventListener('change', (e) => updateDashboardChart(e.target.value));
        trackingMetricSelect.addEventListener('change', (e) => updateTrackingChart(e.target.value));
        contributionFilterWeek.addEventListener('change', (e) => renderContributionsTable(e.target.value));
        
        closeModalButton.addEventListener('click', () => modal.style.display = 'none');
        window.addEventListener('click', (event) => { if (event.target == modal) modal.style.display = 'none'; });

        function setupCarouselScroll(carouselId, leftBtnId, rightBtnId) { /* ... (keep existing) ... */
            const carousel = document.getElementById(carouselId);
            const leftBtn = document.getElementById(leftBtnId);
            const rightBtn = document.getElementById(rightBtnId);
            if (!carousel || !leftBtn || !rightBtn) return;
            const scrollAmount = 300;
            leftBtn.addEventListener('click', () => carousel.scrollLeft -= scrollAmount);
            rightBtn.addEventListener('click', () => carousel.scrollLeft += scrollAmount);
        }
        setupCarouselScroll('timelineCarousel', 'timeline-scroll-left', 'timeline-scroll-right');
        setupCarouselScroll('insightsCarousel', 'insights-scroll-left', 'insights-scroll-right');
        document.getElementById('modal-carousel-prev').addEventListener('click', () => {
            currentModalCarouselIndex = (currentModalCarouselIndex - 1 + modalCarouselItems.length) % modalCarouselItems.length;
            renderModalCarousel();
        });
        document.getElementById('modal-carousel-next').addEventListener('click', () => {
            currentModalCarouselIndex = (currentModalCarouselIndex + 1) % modalCarouselItems.length;
            renderModalCarousel();
        });

        // --- Initialization ---
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        i18next.on('initialized', () => {
            populateWeekFilter(); // Populate week filter first
            updateContentAll(); // This will call all render functions
        });
        if (i18next.isInitialized) { // Fallback if event already fired
            populateWeekFilter();
            updateContentAll();
        }

    </script>
</body>
</html>
