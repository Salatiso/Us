<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="siteTitle">Us - Our Story</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/i18next@23.11.5/dist/umd/i18next.min.js"></script>
    <script src="https://unpkg.com/i18next-browser-languagedetector@7.1.0/dist/umd/i18nextBrowserLanguageDetector.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="xh_translations.js" defer></script>

    <style>
        :root {
            --bg-dark-teal: #065F46; /* Deep green for background */
            --bg-content-teal: rgba(38, 166, 154, 0.97); /* Darker teal for content areas */
            --bg-content-teal-opaque: rgb(38, 166, 154); /* Opaque version for modals */
            --bg-card-teal: rgba(167, 243, 208, 0.92); /* Soft green for cards */
            --text-primary-light: #F3F4F6; /* Light gray for text */
            --text-secondary-light: #D1D5DB; /* Softer gray for secondary text */
            --accent-teal-bright: #2DD4BF; /* Main teal/aquamarine accent */
            --accent-teal-dark: #26A69A; /* Darker teal for contrast */
            --accent-green-soft: #A7F3D0; /* Soft green for highlights */
            --border-color-teal: rgba(38, 166, 154, 0.35); /* Border color */
            --border-color-strong: rgba(38, 166, 154, 0.65); /* Stronger border */
            --font-main: 'Poppins', sans-serif;
            --font-heading: 'Ubuntu', sans-serif;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: var(--font-main);
            background-color: var(--bg-dark-teal);
            color: var(--text-primary-light);
        }

        #videoBackground {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            filter: brightness(0.3) contrast(1.1) blur(3px);
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        header#appHeader {
            background-color: rgba(6, 95, 70, 0.9); /* Deep green */
            backdrop-filter: blur(12px);
            padding: 0.5rem 1rem;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            border-bottom: 1px solid var(--border-color-teal);
        }

        header#appHeader .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1920px;
            margin: 0 auto;
        }

        header#appHeader h1 {
            font-family: var(--font-heading);
            color: var(--accent-teal-bright);
            text-shadow: 0 0 7px var(--accent-teal-bright);
            font-size: 1.25rem;
        }

        header#appHeader .controls-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        header#appHeader .language-switcher button,
        #settingsButton {
            background-color: transparent;
            color: var(--text-secondary-light);
            border: 1px solid var(--accent-teal-dark);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            padding: 0.3rem 0.6rem;
            font-size: 0.7rem;
            border-radius: 0.8rem;
        }

        header#appHeader .language-switcher button:hover,
        header#appHeader .language-switcher button.active-lang,
        #settingsButton:hover {
            background-color: var(--accent-teal-bright);
            border-color: var(--accent-teal-bright);
            color: var(--text-primary-light);
        }

        #settingsButton i {
            margin-right: 0.25rem;
        }

        nav#mainNav {
            background-color: rgba(6, 95, 70, 0.92); /* Deep green */
            backdrop-filter: blur(10px);
            padding: 0.3rem 0.5rem;
            position: fixed;
            left: 0;
            width: 100%;
            z-index: 999;
            border-bottom: 1px solid var(--border-color-teal);
        }

        nav#mainNav .nav-tab-container {
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
            max-width: 1920px;
            margin: 0 auto;
        }

        nav#mainNav .nav-tab-container::-webkit-scrollbar {
            display: none;
        }

        nav#mainNav .nav-tab {
            color: var(--text-secondary-light);
            border-bottom: 2px solid transparent;
            transition: color 0.25s, border-bottom-color 0.25s, transform 0.2s;
            white-space: nowrap;
            padding: 0.4rem 0.65rem;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
        }

        nav#mainNav .nav-tab:hover {
            color: var(--text-primary-light);
            border-bottom-color: var(--accent-teal-bright);
            transform: translateY(-1px);
        }

        nav#mainNav .nav-tab.active-nav {
            color: var(--accent-teal-bright);
            border-bottom-color: var(--accent-teal-bright);
            font-weight: 600;
        }

        .content-area-wrapper {
            flex-grow: 1;
            padding: 0.5rem;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .content-area {
            width: 100%;
            height: 100%;
            max-width: 1920px;
            background-color: var(--bg-content-teal);
            border-radius: 0.6rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .content-section {
            display: none;
            flex-direction: column;
            width: 100%;
            height: 100%;
            overflow: hidden;
            animation: fadeIn 0.35s ease-out;
        }

        .content-section.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0.5; }
            to { opacity: 1; }
        }

        .section-header {
            padding: 0.5rem 1rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color-teal);
            flex-shrink: 0;
        }

        .section-header h2 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-teal-bright);
            margin-bottom: 0;
        }

        .sub-nav-tabs {
            display: flex;
            justify-content: center;
            padding: 0.3rem 0;
            background-color: rgba(6, 95, 70, 0.7);
            flex-shrink: 0;
            border-bottom: 1px solid var(--border-color-teal);
        }

        .sub-nav-tabs .sub-nav-tab {
            padding: 0.25rem 0.65rem;
            margin: 0 0.15rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: var(--text-secondary-light);
            font-size: 0.7rem;
            font-weight: 500;
        }

        .sub-nav-tabs .sub-nav-tab:hover {
            color: var(--text-primary-light);
        }

        .sub-nav-tabs .sub-nav-tab.active-sub-nav {
            color: var(--accent-teal-bright);
            border-bottom-color: var(--accent-teal-bright);
        }

        .section-content-wrapper {
            flex-grow: 1;
            overflow-y: auto;
            padding: 0.6rem;
        }

        .sub-content {
            display: none;
        }

        .sub-content.active-sub-content {
            display: block;
            animation: subContentFadeIn 0.25s ease-out;
        }

        @keyframes subContentFadeIn {
            from { opacity: 0.4; }
            to { opacity: 1; }
        }

        #overview .section-content-wrapper {
            display: flex;
            flex-direction: column;
        }

        .overview-main-content {
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 0.6rem;
            overflow-y: auto;
            padding-bottom: 0.4rem;
        }

        .overview-left-column {
            grid-column: span 12;
            lg:grid-col-span-4;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .overview-right-column {
            grid-column: span 12;
            lg:grid-col-span-8;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        /* New Tiles Section */
        #overviewTilesContainer {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            padding: 1rem;
            background-color: rgba(6, 95, 70, 0.7);
            border-radius: 0.5rem;
            height: 100%;
            overflow-y: auto;
        }

        .overview-tile {
            background-color: var(--bg-card-teal);
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 120px;
        }

        .overview-tile:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            background-color: var(--accent-green-soft);
        }

        .overview-tile i {
            font-size: 2rem;
            color: var(--accent-teal-bright);
            margin-bottom: 0.5rem;
        }

        .overview-tile h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary-light);
        }

        .overview-tile p {
            font-size: 0.7rem;
            color: var(--text-secondary-light);
            margin-top: 0.3rem;
        }

        /* Enhanced Timeline */
        #overviewTimelineContainer {
            height: 120px;
            background-color: rgba(6, 95, 70, 0.7);
            border-top: 1px solid var(--border-color-strong);
            padding: 0.5rem;
            overflow-x: auto;
            display: flex;
            flex-shrink: 0;
            margin-top: 0.6rem;
        }

        .timeline-event-card {
            flex: 0 0 140px;
            margin-right: 0.6rem;
            padding: 0.5rem;
            background-color: var(--bg-card-teal);
            border: 1px solid var(--border-color-teal);
            border-radius: 5px;
            color: var(--text-secondary-light);
            font-size: 0.65rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timeline-event-card:hover {
            background-color: var(--accent-green-soft);
            transform: translateY(-3px);
        }

        .timeline-event-card h4 {
            color: var(--accent-teal-bright);
            font-size: 0.75rem;
            margin-bottom: 0.15rem;
            line-height: 1.2;
        }

        .timeline-event-card .date {
            font-size: 0.6rem;
            color: var(--accent-teal-dark);
            margin-bottom: 0.15rem;
        }

        .dashboard-card {
            background-color: var(--bg-card-teal);
            padding: 0.6rem 0.8rem;
            border-radius: 6px;
            border: 1px solid var(--border-color-teal);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.38);
        }

        .dashboard-card h3 {
            color: var(--accent-teal-bright);
            margin-bottom: 0.3rem;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .dashboard-metric-display {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary-light);
        }

        .chart-container {
            min-height: 160px;
            padding: 0.4rem;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(6, 95, 70, 0.7);
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background-color: var(--bg-content-teal-opaque);
            margin: 10% auto;
            padding: 20px;
            border: 1px solid var(--border-color-strong);
            width: 90%;
            max-width: 550px;
            border-radius: 8px;
            text-align: center;
            position: relative;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content h2, .modal-content h3 {
            font-family: var(--font-heading);
            color: var(--accent-teal-bright);
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .modal-content label {
            display: block;
            margin-bottom: 0.3rem;
            text-align: left;
            font-size: 0.8rem;
            color: var(--text-secondary-light);
        }

        .modal-content .input-field {
            margin-bottom: 0.8rem;
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color-teal);
            border-radius: 0.375rem;
            background-color: var(--bg-dark-teal);
            color: var(--text-primary-light);
        }

        .action-button {
            padding: 0.6rem 1.2rem;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            display: inline-block;
            margin-top: 0.5rem;
            border: 1px solid transparent;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.8rem;
            background-color: var(--accent-teal-bright);
            color: var(--text-primary-light);
            border-color: var(--accent-teal-bright);
        }

        .action-button:hover {
            background-color: transparent;
            color: var(--accent-teal-bright);
            box-shadow: 0 0 10px var(--accent-teal-bright);
        }

        .action-button.secondary {
            background-color: var(--accent-teal-dark);
            border-color: var(--accent-teal-dark);
        }

        .action-button.secondary:hover {
            background-color: transparent;
            color: var(--accent-teal-dark);
            box-shadow: 0 0 10px var(--accent-teal-dark);
        }

        .select-field {
            padding: 0.5rem;
            border: 1px solid var(--border-color-teal);
            border-radius: 0.375rem;
            background-color: var(--bg-dark-teal);
            color: var(--text-primary-light);
            font-size: 0.75rem;
        }

        .textarea-field {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color-teal);
            border-radius: 0.375rem;
            background-color: var(--bg-dark-teal);
            color: var(--text-primary-light);
            resize: vertical;
            min-height: 60px;
        }

        /* Floating Animation for Tiles */
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
    </style>
</head>
<body>
    <video id="videoBackground" autoplay loop muted playsinline>
        <source src="assets/videos/background.mp4" type="video/mp4">
    </video>

    <div class="app-container">
        <header id="appHeader">
            <div class="header-content">
                <h1 data-i18n="siteTitle">Us - Our Story</h1>
                <div class="controls-container">
                    <div class="language-switcher">
                        <button id="langEN" data-i18n="langEN" aria-label="Switch to English">EN</button>
                        <button id="langXH" class="ml-1" data-i18n="langXH" aria-label="Switch to isiXhosa">XH</button>
                    </div>
                    <button id="settingsButton" title="Couple Settings" aria-label="Open Settings">
                        <i class="fas fa-cog"></i> <span data-i18n="settingsButton">Settings</span>
                    </button>
                </div>
            </div>
        </header>

        <nav id="mainNav">
            <div class="nav-tab-container">
                <button class="nav-tab active-nav" data-section="overview" data-i18n="navOverview">Overview</button>
                <button class="nav-tab" data-section="analysis" data-i18n="navAnalysis">Analysis Hub</button>
                <button class="nav-tab" data-section="media" data-i18n="navMedia">Media & Travel</button>
                <button class="nav-tab" data-section="connect" data-i18n="navConnect">Connect & Resolve</button>
                <button class="nav-tab" data-section="lifesyncFun" data-i18n="navLifeSync">Fun Zone</button>
            </div>
        </nav>

        <div class="content-area-wrapper" id="contentAreaWrapper">
            <main class="content-area">
                <section id="overview" class="content-section active">
                    <div class="section-header">
                        <h2 data-i18n="overview.title">Our Journey Snapshot</h2>
                    </div>
                    <div class="section-content-wrapper flex flex-col">
                        <div class="overview-main-content flex-grow">
                            <div class="overview-left-column space-y-2.5">
                                <div class="dashboard-card flex-shrink-0">
                                    <h3 data-i18n="overview.dashboardTitle" class="text-center">Key Metrics</h3>
                                    <div class="grid grid-cols-2 gap-2.5">
                                        <div class="dashboard-card p-2">
                                            <h3 data-i18n="overview.affectionLevel" class="text-xs"></h3>
                                            <p id="affection-metric" class="dashboard-metric-display text-base">--</p>
                                        </div>
                                        <div class="dashboard-card p-2">
                                            <h3 data-i18n="overview.supportScore" class="text-xs"></h3>
                                            <p id="support-metric" class="dashboard-metric-display text-base">--</p>
                                        </div>
                                        <div class="dashboard-card p-2">
                                            <h3 data-i18n="overview.foodContribution" class="text-xs"></h3>
                                            <p id="food-metric" class="dashboard-metric-display text-base">--</p>
                                        </div>
                                        <div class="dashboard-card p-2">
                                            <h3 data-i18n="overview.safetyFeeling" class="text-xs"></h3>
                                            <p id="safety-metric" class="dashboard-metric-display text-base">--</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card text-center flex-shrink-0">
                                    <h3 data-i18n="overview.ourSong"></h3>
                                    <p id="specialSongTitle" class="text-xs mb-1">"Thank You Baby! (For Makin' Someday Come So Soon)"</p>
                                    <a href="https://youtu.be/DOcCQ-kC4iE?si=DrJURhh0p86ce7yt" id="ourSongLink" target="_blank" class="action-button text-xs py-0.5 px-2">
                                        <i class="fas fa-headphones-alt mr-1"></i> <span data-i18n="overview.listenToSong">Listen</span>
                                    </a>
                                </div>
                                <div class="dashboard-card flex-grow">
                                    <h3 data-i18n="overview.dashboardTitle">Relationship Trends</h3>
                                    <select id="dashboardMetricSelect" class="select-field w-full py-1 text-xs mb-1.5 bg-[var(--bg-dark-teal)]"></select>
                                    <div class="chart-container relative h-36 md:h-full">
                                        <canvas id="dashboardChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="overview-right-column">
                                <div id="overviewTilesContainer">
                                    <div class="overview-tile animate-float" data-tile="ourSong">
                                        <i class="fas fa-music"></i>
                                        <h4 data-i18n="overview.ourSong">Our Song</h4>
                                        <p data-i18n="overview.ourSongTileDesc">Listen to our special song</p>
                                    </div>
                                    <div class="overview-tile animate-float" data-tile="keyMoments">
                                        <i class="fas fa-heart"></i>
                                        <h4 data-i18n="overview.keyMoments">Key Moments</h4>
                                        <p data-i18n="overview.keyMomentsTileDesc">Memorable milestones</p>
                                    </div>
                                    <div class="overview-tile animate-float" data-tile="sharedInterests">
                                        <i class="fas fa-users"></i>
                                        <h4 data-i18n="overview.sharedInterests">Shared Interests</h4>
                                        <p data-i18n="overview.sharedInterestsTileDesc">What we love together</p>
                                    </div>
                                    <div class="overview-tile animate-float" data-tile="futurePlans">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <h4 data-i18n="overview.futurePlans">Future Plans</h4>
                                        <p data-i18n="overview.futurePlansTileDesc">Our next adventures</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="overviewTimelineContainer" class="flex-shrink-0"></div>
                    </div>
                </section>

                <!-- Remaining sections (analysis, media, connect, lifesyncFun) remain unchanged -->
                <section id="analysis" class="content-section">
                    <div class="section-header">
                        <h2 data-i18n="navAnalysis">Analysis Hub</h2>
                    </div>
                    <div class="sub-nav-tabs">
                        <button class="sub-nav-tab active-sub-nav" data-subtarget="analysis-tracking" data-i18n="tabTracking">Tracking</button>
                        <button class="sub-nav-tab" data-subtarget="analysis-contributions" data-i18n="tabContributions">Contributions</button>
                        <button class="sub-nav-tab" data-subtarget="analysis-reinforcement" data-i18n="tabReinforcement">Reinforcement</button>
                    </div>
                    <div class="section-content-wrapper">
                        <div id="analysis-tracking" class="sub-content active-sub-content">
                            <div class="mb-2 text-center">
                                <label for="trackingMetricSelect" class="mr-1.5 font-medium text-xs" data-i18n="tracking.selectAspect">Track:</label>
                                <select id="trackingMetricSelect" class="select-field w-auto inline-block py-1 text-xs bg-[var(--bg-dark-teal)]"></select>
                            </div>
                            <div class="chart-container h-60 md:h-80">
                                <canvas id="trackingChart"></canvas>
                            </div>
                        </div>
                        <div id="analysis-contributions" class="sub-content">
                            <div class="mb-2 text-center">
                                <label for="contributionFilterWeek" class="mr-1.5 font-medium text-xs" data-i18n="contributions.filterWeek">Week:</label>
                                <select id="contributionFilterWeek" class="select-field w-auto inline-block py-1 text-xs bg-[var(--bg-dark-teal)]"></select>
                            </div>
                            <div class="table-wrapper">
                                <table class="data-table contribution-table">
                                    <thead>
                                        <tr>
                                            <th data-i18n="parameter">Parameter</th>
                                            <th id="contributionsName1Header" data-dynamic-name1>Person 1</th>
                                            <th id="contributionsName2Header" data-dynamic-name2>Person 2</th>
                                            <th data-i18n="notes">Details</th>
                                        </tr>
                                    </thead>
                                    <tbody id="contributionsTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                        <div id="analysis-reinforcement" class="sub-content">
                            <div class="table-wrapper">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th data-i18n="wordAction">Word/Action</th>
                                            <th data-i18n="purpose">Purpose</th>
                                            <th id="reinforcementName1Header" data-dynamic-name1>Person 1 (Wks)</th>
                                            <th id="reinforcementName2Header" data-dynamic-name2>Person 2 (Wks)</th>
                                            <th data-i18n="joint">Joint (Wks)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reinforcementTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="media" class="content-section">
                    <div class="section-header">
                        <h2 data-i18n="navMedia">Media & Travel</h2>
                    </div>
                    <div class="sub-nav-tabs">
                        <button class="sub-nav-tab active-sub-nav" data-subtarget="media-songs" data-i18n="tabSongs">Shared Songs</button>
                        <button class="sub-nav-tab" data-subtarget="media-photos" data-i18n="tabPhotos">Photo Moments</button>
                        <button class="sub-nav-tab" data-subtarget="travel-visited" data-i18n="tabVisited">Visited Places</button>
                        <button class="sub-nav-tab" data-subtarget="travel-desired" data-i18n="tabDream">Dream Trips</button>
                    </div>
                    <div class="section-content-wrapper">
                        <div id="media-songs" class="sub-content active-sub-content">
                            <div id="songListContainer" class="space-y-1.5"></div>
                        </div>
                        <div id="media-photos" class="sub-content">
                            <div id="photoGalleryContainer" class="media-gallery-grid"></div>
                        </div>
                        <div id="travel-visited" class="sub-content">
                            <div id="visitedPlacesContainer" class="space-y-2.5"></div>
                        </div>
                        <div id="travel-desired" class="sub-content">
                            <div id="desiredPlacesContainer" class="space-y-2.5"></div>
                        </div>
                    </div>
                </section>

                <section id="connect" class="content-section">
                    <div class="section-header">
                        <h2 data-i18n="navConnect">Connect & Resolve</h2>
                    </div>
                    <div class="sub-nav-tabs">
                        <button class="sub-nav-tab active-sub-nav" data-subtarget="connect-feedback" data-i18n="tabFeedback">Feedback</button>
                        <button class="sub-nav-tab" data-subtarget="connect-actions" data-i18n="tabActions">Actions</button>
                        <button class="sub-nav-tab" data-subtarget="connect-logs" data-i18n="tabLogs">Logs</button>
                    </div>
                    <div class="section-content-wrapper grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div id="connect-feedback" class="sub-content active-sub-content space-y-3">
                            <div class="dashboard-card">
                                <h3 data-i18n="feedback.giveFeedback">Give Feedback</h3>
                                <form id="feedbackForm" class="space-y-2.5">
                                    <div>
                                        <label for="feedbackSender" class="block text-xs font-medium" data-i18n="feedback.sender">From:</label>
                                        <select id="feedbackSender" class="select-field bg-[var(--bg-dark-teal)]"></select>
                                    </div>
                                    <div>
                                        <label for="feedbackRecipient" class="block text-xs font-medium" data-i18n="feedback.recipient">To:</label>
                                        <select id="feedbackRecipient" class="select-field bg-[var(--bg-dark-teal)]"></select>
                                    </div>
                                    <div>
                                        <label for="feedbackMessage" class="block text-xs font-medium" data-i18n="feedback.message">Message:</label>
                                        <textarea id="feedbackMessage" rows="2" class="textarea-field bg-[var(--bg-dark-teal)]" placeholder="Type feedback..." data-i18n-placeholder="feedbackPlaceholder"></textarea>
                                    </div>
                                    <button type="submit" id="sendFeedbackBtn" class="action-button w-full text-xs py-1.5" data-i18n="sendFeedback">Send</button>
                                </form>
                            </div>
                            <div class="dashboard-card flex-grow flex flex-col">
                                <h3 data-i18n="feedback.receivedFeedback" class="flex-shrink-0">Feedback Log</h3>
                                <div id="feedbackLogContainer" class="flex-grow overflow-y-auto space-y-1.5 text-xs"></div>
                            </div>
                        </div>
                        <div id="connect-actions" class="sub-content space-y-2.5">
                            <div class="relationship-action-form dashboard-card">
                                <h4 data-i18n="relationshipActions.apology.title">Make an Apology</h4>
                                <form id="apologyForm" class="space-y-2">
                                    <select id="apologyFrom" class="select-field text-xs py-1 mb-1 bg-[var(--bg-dark-teal)]"></select>
                                    <textarea id="apologyMessage" class="textarea-field min-h-[35px] text-xs bg-[var(--bg-dark-teal)]" placeholder="Your heartfelt apology..." data-i18n-placeholder="relationshipActions.apology.messagePlaceholder"></textarea>
                                    <button type="submit" id="sendApologyBtn" class="action-button mt-0.5 w-full text-xs py-1" data-i18n="relationshipActions.apology.sendButton">Send Apology</button>
                                </form>
                            </div>
                            <div class="relationship-action-form dashboard-card">
                                <h4 data-i18n="relationshipActions.dissatisfaction.title">Express Dissatisfaction</h4>
                                <form id="dissatisfactionForm" class="space-y-2">
                                    <select id="dissatisfactionFrom" class="select-field text-xs py-1 mb-1 bg-[var(--bg-dark-teal)]"></select>
                                    <textarea id="dissatisfactionMessage" class="textarea-field min-h-[35px] text-xs bg-[var(--bg-dark-teal)]" placeholder="Describe your concern..." data-i18n-placeholder="relationshipActions.dissatisfaction.messagePlaceholder"></textarea>
                                    <button type="submit" id="sendDissatisfactionBtn" class="action-button mt-0.5 w-full text-xs py-1" data-i18n="relationshipActions.dissatisfaction.sendButton">Submit</button>
                                </form>
                            </div>
                            <div class="relationship-action-form dashboard-card">
                                <h4 data-i18n="relationshipActions.dateProposal.title">Book a Date</h4>
                                <form id="dateProposalForm" class="space-y-2">
                                    <select id="dateBooker" class="select-field text-xs py-1 mb-1 bg-[var(--bg-dark-teal)]"></select>
                                    <input id="dateActivity" type="text" class="input-field text-xs bg-[var(--bg-dark-teal)]" placeholder="Activity (e.g., Dinner)" data-i18n-placeholder="relationshipActions.dateProposal.activityPlaceholder">
                                    <input id="dateProposed" type="date" class="input-field text-xs bg-[var(--bg-dark-teal)]">
                                    <textarea id="dateMessage" class="textarea-field min-h-[35px] text-xs bg-[var(--bg-dark-teal)]" placeholder="Additional notes..." data-i18n-placeholder="relationshipActions.dateProposal.messagePlaceholder"></textarea>
                                    <button type="submit" id="bookDateBtn" class="action-button mt-0.5 w-full text-xs py-1" data-i18n="relationshipActions.dateProposal.sendButton">Propose</button>
                                </form>
                            </div>
                            <div class="relationship-action-form dashboard-card">
                                <h4 data-i18n="relationshipActions.terminate.title">Request Termination</h4>
                                <form id="terminationForm" class="space-y-2">
                                    <select id="terminator" class="select-field text-xs py-1 mb-1 bg-[var(--bg-dark-teal)]"></select>
                                    <select id="terminationReason" class="select-field text-xs py-1 mb-1 bg-[var(--bg-dark-teal)]"></select>
                                    <textarea id="terminationOtherReason" class="textarea-field min-h-[35px] text-xs bg-[var(--bg-dark-teal)]" placeholder="Other reason (if applicable)..." data-i18n-placeholder="relationshipActions.terminate.otherReasonPlaceholder"></textarea>
                                    <textarea id="terminationMessage" class="textarea-field min-h-[35px] text-xs bg-[var(--bg-dark-teal)]" placeholder="Your message..." data-i18n-placeholder="relationshipActions.terminate.messagePlaceholder"></textarea>
                                    <button type="submit" id="requestTerminationBtn" class="action-button mt-0.5 w-full text-xs py-1" data-i18n="relationshipActions.terminate.sendButton">Request</button>
                                </form>
                            </div>
                        </div>
                        <div id="connect-logs" class="sub-content dashboard-card md:col-span-2 flex flex-col">
                            <h3 data-i18n="relationshipActions.logTitleShort" class="flex-shrink-0">Action Log</h3>
                            <div id="relationshipActionLogContainer" class="flex-grow overflow-y-auto space-y-1.5 text-xs"></div>
                        </div>
                    </div>
                </section>

                <section id="lifesyncFun" class="content-section">
                    <div class="section-header">
                        <h2 data-i18n="navLifeSync">Fun Zone</h2>
                    </div>
                    <div class="sub-nav-tabs">
                        <button class="sub-nav-tab active-sub-nav" data-subtarget="fun-compatibility" data-i18n="tabCompatibility">Compatibility</button>
                        <button class="sub-nav-tab" data-subtarget="fun-quizzes" data-i18n="tabQuizzes">Quizzes</button>
                        <button class="sub-nav-tab" data-subtarget="lifesync-reports" data-i18n="tabReports">Reports</button>
                    </div>
                    <div class="section-content-wrapper">
                        <div id="fun-compatibility" class="sub-content active-sub-content space-y-3">
                            <div class="dashboard-card">
                                <h3 data-i18n="astrologyTitle">Astrology Check</h3>
                                <div class="grid grid-cols-2 gap-2 mb-1.5">
                                    <div>
                                        <label for="salatisoBirthday" class="block text-xs" id="name1BirthdayLabel" data-dynamic-name1>Name 1 Bday:</label>
                                        <input id="salatisoBirthday" type="date" class="input-field text-xs bg-[var(--bg-dark-teal)]">
                                    </div>
                                    <div>
                                        <label for="teeBirthday" class="block text-xs" id="name2BirthdayLabel" data-dynamic-name2>Name 2 Bday:</label>
                                        <input id="teeBirthday" type="date" class="input-field text-xs bg-[var(--bg-dark-teal)]">
                                    </div>
                                </div>
                                <button id="checkCompatibility" class="action-button secondary text-xs py-1" data-i18n="checkCompatibility">Check</button>
                                <p id="compatibilityResult" class="text-xs mt-1.5 min-h-[18px]"></p>
                            </div>
                            <div class="dashboard-card text-center">
                                <h3 data-i18n="valuesAlignment">Values Alignment</h3>
                                <button class="action-button text-xs py-1 compatibility-test-btn" data-test="values" data-i18n="startTest">Start</button>
                                <p class="text-xs mt-1" data-i18n="comingSoon">Coming Soon!</p>
                            </div>
                        </div>
                        <div id="fun-quizzes" class="sub-content text-center">
                            <p data-i18n="comingSoon">Coming Soon!</p>
                        </div>
                        <div id="lifesync-reports" class="sub-content text-center">
                            <select id="reportPeriod" class="select-field w-auto inline-block py-1 text-sm mr-1.5 bg-[var(--bg-dark-teal)]"></select>
                            <select id="reportMetrics" class="select-field w-auto inline-block py-1 text-sm mr-1.5 bg-[var(--bg-dark-teal)]" multiple></select>
                            <button id="generateReport" class="action-button text-sm py-1" data-i18n="generateReport">Generate</button>
                            <div id="reportPreview" class="mt-3 text-left text-xs"></div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <footer class="py-2 text-center text-xs fixed bottom-0 left-0 w-full bg-[rgba(6,95,70,0.85)] border-t border-[var(--border-color-teal)] text-[var(--text-secondary-light)] backdrop-blur-sm">
            © <span id="currentYear"></span> Salatiso Lonwabo Mdeni - Father, OHS & Risk Expert, Author. All Rights Reserved. | <a href="#" class="hover:text-[var(--text-primary-light)] text-[var(--accent-teal-bright)]">Privacy Policy</a> | <a href="#" class="hover:text-[var(--text-primary-light)] text-[var(--accent-teal-bright)]">Terms of Service</a>
        </footer>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeSettingsModal" aria-label="Close Settings Modal">×</span>
            <h2 data-i18n="settingsModal.title">Couple Setup</h2>
            <div class="space-y-3">
                <div>
                    <label for="name1Input" data-i18n="settingsModal.name1">Your Name:</label>
                    <input type="text" id="name1Input" class="input-field bg-[var(--bg-dark-teal)]" placeholder="Enter first name">
                </div>
                <div>
                    <label for="name2Input" data-i18n="settingsModal.name2">Partner's Name:</label>
                    <input type="text" id="name2Input" class="input-field bg-[var(--bg-dark-teal)]" placeholder="Enter second name">
                </div>
                <button id="saveNamesButton" class="action-button secondary w-full" data-i18n="settingsModal.saveButton">Save Names</button>
            </div>
        </div>
    </div>

    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeDetailsModalBtn" aria-label="Close Details Modal">×</span>
            <h3 id="modalTitle" class="text-lg font-semibold mb-2"></h3>
            <div id="modalBody" class="text-xs max-h-[65vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="alertModal" class="modal">
        <div class="modal-content max-w-sm">
            <span class="close-modal" id="closeAlertModalBtn" aria-label="Close Alert Modal">×</span>
            <h3 id="alertModalTitle" class="text-base font-semibold mb-1.5"></h3>
            <p id="alertModalMessage" class="mb-3 text-xs"></p>
            <button id="alertModalOkBtn" class="action-button py-1 px-3" data-i18n="ok">OK</button>
        </div>
    </div>
    <div id="playlistModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closePlaylistModalBtnPopup" aria-label="Close Playlist Modal">×</span>
            <h3 data-i18n="playlist.title" class="text-lg font-semibold mb-2">Our Playlist</h3>
            <iframe id="playlistFrame" width="100%" height="315" frameborder="0" allow="autoplay; clipboard-write; encrypted-media"></iframe>
            <p class="mt-1.5 text-xs" data-i18n="playlist.note">May open in new tab.</p>
        </div>
    </div>

    <button id="playlistButton" title="Our Playlist" class="text-lg" aria-label="Open Playlist">
        <i class="fas fa-music"></i>
    </button>

    <script>
        // Global State & Config
        console.log("Us - Our Story v1.3 (LifeSync Design - Teal/Green Update)");
        let coupleName1 = "Person 1";
        let coupleName2 = "Person 2";
        let currentMainSection = 'overview';
        let currentSubTargets = {
            overview: null,
            analysis: 'analysis-tracking',
            media: 'media-songs',
            connect: 'connect-feedback',
            lifesyncFun: 'fun-compatibility'
        };
        let dashboardMainChart, analysisTrackingChart;

        const relationshipData = {
            playlistUrl: "https://music.youtube.com/playlist?list=PLXPU1hLJ2t0MZKrDGjGxk7vNlVeh9pX0C&si=ZPqinjcSRBsq8FZZ",
            ourSpecialSongUrl: "https://youtu.be/DOcCQ-kC4iE?si=DrJURhh0p86ce7yt",
            photoFileNames: [
                "assets/photos/photo1.jpg",
                "assets/photos/photo2.jpg",
                "assets/photos/photo3.jpg",
                "assets/photos/photo4.jpg"
            ],
            weeks: [
                {
                    weekNumber: 1,
                    startDate: "2024-05-20",
                    contributions: {
                        affection: { salatiso: { score: 7, actions: ["Hugs"] }, tee: { score: 8, actions: ["Kisses"] }, notesKey: "timeline.week1.affectionNotes" },
                        food: { score: 7, salatiso: { actions: ["Groceries (R300)"] }, tee: { actions: ["Cooked Mon, Wed"] }, notesKey: "timeline.week1.foodNotes" },
                        safety: { score: 9, salatiso: { actions: ["Locked up"] }, tee: { actions: ["Checked stove"] }, notesKey: "timeline.week1.safetyNotes" },
                        finances: { salatiso: { score: 300, category: "Household" }, tee: { score: 50, category: "Household" }, notesKey: "timeline.week1.financeNotes" },
                        support: { salatiso: { score: 6, actions: ["Listening"] }, tee: { score: 7, actions: ["Encouragement"] }, notesKey: "timeline.week1.supportNotes" },
                        communication: { salatiso: { score: 8, actions: ["Daily chats"] }, tee: { score: 8, actions: ["Daily chats"] }, notesKey: "timeline.week1.commNotes" }
                    },
                    summaryKey: "timeline.week1.summary",
                    events: [
                        { type: "event", date: "2024-05-22", headlineKey: "timeline.event1.headline", textKey: "timeline.event1.text", media: { url: "assets/photos/photo1.jpg" }, sharedBy: "Salatiso" },
                        { type: "music", date: "2024-05-23", headlineKey: "timeline.song1.headline", textKey: "timeline.song1.text", media: { url: "https://youtu.be/DOcCQ-kC4iE?si=DrJURhh0p86ce7yt", caption: "Our Song" }, sharedBy: "Salatiso" }
                    ]
                },
                {
                    weekNumber: 47,
                    startDate: "2025-04-08",
                    contributions: {
                        affection: { salatiso: { score: 2, actions: ["Minimal"] }, tee: { score: 3, actions: ["Text"] }, notesKey: "timeline.week47.affectionNotes" },
                        food: { score: 5, salatiso: { actions: ["Takeout"] }, tee: { actions: ["Cooked Tue"] }, notesKey: "timeline.week47.foodNotes" },
                        safety: { score: 6, salatiso: { actions: ["Checked doors"] }, tee: { actions: ["Checked alarms"] }, notesKey: "timeline.week47.safetyNotes" },
                        finances: { salatiso: { score: 8000, category: "Rent" }, tee: { score: 3000, category: "Utilities" }, notesKey: "timeline.week47.financeNotes" },
                        support: { salatiso: { score: 4, actions: ["Discussion"] }, tee: { score: 4, actions: ["Listening"] }, notesKey: "timeline.week47.supportNotes" },
                        communication: { salatiso: { score: 3, actions: ["Limited"] }, tee: { score: 3, actions: ["Limited"] }, notesKey: "timeline.week47.commNotes" }
                    },
                    summaryKey: "timeline.week47.summary",
                    events: [
                        { type: "conflict", date: "2025-04-15", headlineKey: "timeline.conflict1.headline", textKey: "timeline.conflict1.text", sharedBy: "Both" }
                    ]
                }
            ],
            reinforcementWords: [
                { wordActionKey: "reinforcement.words.safe", purposeKey: "reinforcement.purpose.reassurance", occurrences: { salatiso: [1], tee: [1, 2], joint: [] } }
            ],
            feedbackLog: [
                { id: Date.now() + 1, sender: "Salatiso", recipient: "Tee", message: "Appreciated coffee!", timestamp: new Date(2024, 4, 21, 8, 0, 0).toISOString(), response: "You're welcome! ❤️", responseTimestamp: new Date(2024, 4, 21, 9, 30, 0).toISOString() }
            ],
            actionLog: [
                { id: Date.now() + 1, type: "apology", actor: "Salatiso", target: "Tee", message: "Sorry for being late.", timestamp: new Date(2024, 4, 22, 10, 0, 0).toISOString() }
            ],
            travelLog: [
                { id: 1, type: "visited", destinationKey: "travel.dest.durban", dates: "2023-07-10", roles: { salatisoKey: "travel.roles.durban.salatiso", teeKey: "travel.roles.durban.tee" }, highlightsKey: "travel.durban.highlights", photos: ["assets/photos/photo2.jpg"] }
            ],
            desiredTravel: [
                { id: 1, destination: "Cape Town Wine Route", description: "Explore Stellenbosch", priority: "High" }
            ],
            sharedSongs: [
                { titleKey: "overview.songName_shaggy", artist: "Shaggy", sharedBy: "Salatiso", link: "https://youtu.be/DOcCQ-kC4iE?si=DrJURhh0p86ce7yt" }
            ],
            sharedInterests: [
                { name: "Music", description: "We both love listening to R&B and jazz." },
                { name: "Travel", description: "Exploring new cities together is our passion." }
            ],
            futurePlans: [
                { destination: "Cape Town", description: "Wine tasting in Stellenbosch", date: "2025-12" },
                { destination: "Paris", description: "A romantic getaway", date: "2026-03" }
            ]
        };

        // i18next Configuration
        const translations = {
            en: {
                translation: {
                    siteTitle: "Us - Our Story",
                    headerTitle: "Us - Our Story",
                    langEN: "EN",
                    langXH: "XH",
                    navOverview: "Overview",
                    navAnalysis: "Analysis Hub",
                    navMedia: "Media & Travel",
                    navConnect: "Connect & Resolve",
                    navLifeSync: "Fun Zone",
                    overview: {
                        title: "Our Journey Snapshot",
                        dashboardTitle: "Relationship Dashboard",
                        affectionLevel: "Affection",
                        supportScore: "Support",
                        foodContribution: "Food Prep",
                        safetyFeeling: "Safety",
                        ourSong: "Our Song",
                        songName_shaggy: "\"Thank You Baby!\"",
                        listenToSong: "Listen",
                        quickTimeline: "Recent Milestones",
                        ourSongTileDesc: "Listen to our special song",
                        keyMoments: "Key Moments",
                        keyMomentsTileDesc: "Memorable milestones",
                        sharedInterests: "Shared Interests",
                        sharedInterestsTileDesc: "What we love together",
                        futurePlans: "Future Plans",
                        futurePlansTileDesc: "Our next adventures"
                    },
                    tabTracking: "Tracking",
                    tabContributions: "Contributions",
                    tabReinforcement: "Reinforcement",
                    tabSongs: "Shared Songs",
                    tabPhotos: "Photo Moments",
                    tabVisited: "Visited",
                    tabDream: "Dream Trips",
                    tabFeedback: "Feedback",
                    tabActions: "Actions",
                    tabLogs: "Logs",
                    tabCompatibility: "Compatibility",
                    tabQuizzes: "Quizzes",
                    tabReports: "Reports",
                    parameter: "Parameter",
                    notes: "Details",
                    wordAction: "Word/Action",
                    purpose: "Purpose",
                    joint: "Joint",
                    person1NamePlaceholder: "Name 1",
                    person2NamePlaceholder: "Name 2",
                    feedbackPlaceholder: "Type feedback...",
                    sendFeedback: "Send",
                    makeApology: "Make Apology",
                    apologyPlaceholder: "Apology message...",
                    submitApology: "Submit",
                    astrologyTitle: "Astrology Check",
                    checkCompatibility: "Check",
                    valuesAlignment: "Values Alignment",
                    startTest: "Start",
                    comingSoon: "Coming Soon!",
                    last3Months: "Last 3 Months",
                    allTime: "All Time",
                    generateReport: "Generate",
                    ok: "OK",
                    footer: {
                        text: "© 2025 Salatiso Lonwabo Mdeni - Father, OHS & Risk Expert, Author. All Rights Reserved."
                    },
                    settingsButton: "Setup",
                    settingsModal: {
                        title: "Couple Setup",
                        name1: "Your Name:",
                        name2: "Partner's Name:",
                        saveButton: "Save Names",
                        namesSaved: "Names saved!"
                    },
                    timeline: {
                        event1: {
                            headline: "Group Created",
                            text: "The 'Us' WhatsApp group was formed, marking a new chapter."
                        },
                        song1: {
                            headline: "Shared Our Song",
                            text: "Salatiso shared 'Thank You Baby!' as our special song."
                        },
                        conflict1: {
                            headline: "Trip Discussion",
                            text: "A significant disagreement arose concerning travel plans to the Eastern Cape."
                        },
                        week1: {
                            summary: "Initial phase, lots of planning and affectionate communication.",
                            affectionNotes: "Warm initial interactions.",
                            foodNotes: "Shared cooking.",
                            safetyNotes: "Established routines.",
                            financeNotes: "Discussed shared expenses.",
                            supportNotes: "Mutual support.",
                            commNotes: "Good talks."
                        },
                        week47: {
                            summary: "A period of conflict and eventual separation discussions.",
                            affectionNotes: "Reduced affection due to tension.",
                            foodNotes: "Minimal joint effort.",
                            safetyNotes: "Maintained basic checks.",
                            financeNotes: "Continued shared expenses.",
                            supportNotes: "Strained support.",
                            commNotes: "Limited communication."
                        },
                        noEvents: "No timeline events to display yet.",
                        sharedSong: "{{sharer}} shared '{{song}}' by {{artist}}."
                    },
                    insights: {
                        week1: {
                            affection: "Great affection shown.",
                            intimacy: "Opened up emotionally."
                        }
                    },
                    tracking: {
                        selectAspect: "Track:",
                        affectionLevel: "Affection",
                        supportScore: "Support",
                        communicationFrequency: "Communication",
                        foodContribution: "Food Prep",
                        safetyFeeling: "Safety Score",
                        financialTeamwork: "Finances",
                        feedbackResponseTime: "Feedback Response",
                        noResponseData: "No data for this metric."
                    },
                    contributions: {
                        filterWeek: "Week:",
                        table: {
                            parameter: "Parameter",
                            details: "Details"
                        },
                        params: {
                            food: "Food Prep",
                            safety: "Safety & Security",
                            chores: "Household Chores",
                            planning: "Joint Planning",
                            finances: "Financials",
                            affection: "Affection",
                            support: "Support",
                            communication: "Communication"
                        },
                        noDataForWeek: "No contribution data for this week.",
                        noneReported: "N/A"
                    },
                    reinforcement: {
                        table: {
                            wordAction: "Word/Action",
                            purpose: "Purpose",
                            salatisoOccurrences: "Name 1 (Wks)",
                            teeOccurrences: "Name 2 (Wks)",
                            jointOccurrences: "Joint (Wks)"
                        },
                        words: {
                            safe: "'I'm safe'",
                            loveYou: "'I love you'",
                            helpRequest: "Help Request"
                        },
                        purpose: {
                            reassurance: "Reassurance",
                            affection: "Affection",
                            supportSeeking: "Support Seeking"
                        }
                    },
                    mediaGallery: {
                        sharedSongs: "Shared Songs",
                        photoMoments: "Photo Moments",
                        photoNote: "(Placeholder images)",
                        noSongs: "No songs logged yet.",
                        noPhotos: "No photos available."
                    },
                    travel: {
                        visitedTitle: "Places We've Been",
                        desiredTitle: "Our Dream Trips",
                        rolesTitle: "Our Roles",
                        highlightsTitle: "Highlights",
                        noVisited: "No past travels logged.",
                        noDesired: "No dream trips added yet.",
                        dest: {
                            durban: "Durban Beach Escape"
                        },
                        roles: {
                            durban: {
                                salatiso: "Logistics & Fun Planner",
                                tee: "Foodie & Vibe Curator"
                            }
                        },
                        durban: {
                            highlights: "Morning beach walks, seafood, relaxing."
                        }
                    },
                    relationshipActions: {
                        titleShort: "Log Action",
                        logTitleShort: "Action Log",
                        title: "Connect & Resolve Actions",
                        apology: {
                            title: "Make an Apology",
                            from: "From:",
                            messagePlaceholder: "Your heartfelt apology...",
                            sendButton: "Send Apology",
                            success: "Apology sent and logged."
                        },
                        dissatisfaction: {
                            title: "Express Dissatisfaction",
                            from: "From:",
                            messagePlaceholder: "Describe your concern...",
                            sendButton: "Submit",
                            success: "Concern logged."
                        },
                        dateProposal: {
                            title: "Book a Date",
                            from: "From:",
                            activityPlaceholder: "Activity (e.g., Dinner)",
                            proposedDate: "Proposed Date:",
                            messagePlaceholder: "Additional notes...",
                            sendButton: "Propose",
                            success: "Date proposed and logged."
                        },
                        terminate: {
                            title: "Request Termination",
                            from: "From:",
                            reason: "Reason:",
                            otherReasonPlaceholder: "Other reason (if applicable)...",
                            messagePlaceholder: "Your message...",
                            sendButton: "Request",
                            success: "Termination request logged.",
                            reasons: {
                                irreconcilable: "Irreconcilable Differences",
                                communication: "Communication Breakdown",
                                paths: "Different Life Paths",
                                other: "Other"
                            }
                        },
                        noActionsYet: "No actions logged yet.",
                        actionBy: "Action by {{name}}",
                        actionType: "Type: {{type}}",
                        actionDetails: "Details: {{details}}"
                    },
                    funtools: {
                        quizzes: {
                            title: "Fun Quizzes",
                            placeholder: "Relationship quizzes coming soon!"
                        },
                        astrology: {
                            title: "Astrology Compatibility",
                            name1Bday: "Name 1's Bday:",
                            name2Bday: "Name 2's Bday:",
                            checkButton: "Check Compatibility",
                            invalidDate: "Invalid dates provided.",
                            signIsA: "{{name}} is a {{sign}}",
                            virgoTaurus: "Virgo & Taurus: Earthy and stable match!",
                            general: "Explore your unique dynamic!"
                        }
                    },
                    lifesync: {
                        title: "LifeSync Integration",
                        reportGen: "Generate LifeSync Report",
                        last3Months: "Last 3 Months",
                        allTime: "All Time",
                        generateButton: "Generate",
                        reportNote: "LifeSync report generated."
                    },
                    feedback: {
                        title: "Feedback Channel",
                        giveFeedback: "Give Feedback",
                        sender: "From:",
                        recipient: "To:",
                        message: "Message:",
                        sendButton: "Send Feedback",
                        receivedFeedback: "Feedback Log",
                        feedbackFrom: "From {{name}}",
                        noFeedbackYet: "No feedback messages yet.",
                        success: "Feedback sent.",
                        senderRecipientSame: "Sender and recipient cannot be the same.",
                        pendingResponse: "Pending Response"
                    },
                    alert: {
                        defaultTitle: "Notification",
                        actionLogged: "Action Logged",
                        fillAllFields: "Please fill all fields.",
                        messageEmpty: "Message empty."
                    },
                    playlist: {
                        title: "Our Playlist",
                        note: "May open in new tab."
                    }
                }
            },
            xh: {
                translation: typeof xhosaTranslations !== 'undefined' ? xhosaTranslations : {}
            }
        };

        // App Initialization
        function initializeApp() {
            console.log("Us - Our Story App Initializing...");
            loadNames();
            i18next.use(i18nextBrowserLanguageDetector).init({
                debug: false,
                fallbackLng: 'en',
                resources: translations
            }, (err, t) => {
                if (err) {
                    console.error("i18next initialization error:", err);
                    showAlert("Failed to load translations. Using English.", "Error");
                    return;
                }

                updateNavStickiness();
                populateAllSelects();
                setupEventListeners();
                navigateToSection(currentMainSection);
                updateContentAll();

                document.getElementById('currentYear').textContent = new Date().getFullYear();
                document.getElementById('ourSongLink').href = relationshipData.ourSpecialSongUrl;
                document.getElementById('playlistFrame').src = relationshipData.playlistUrl;

                updateDynamicNameDisplays();
                renderOverviewSection();
                console.log("Us - Our Story App Initialized & Ready.");
            });
        }

        function updateNavStickiness() {
            const header = document.getElementById('appHeader');
            const nav = document.getElementById('mainNav');
            const contentWrapper = document.getElementById('contentAreaWrapper');
            if (header && nav && contentWrapper) {
                const headerHeight = header.offsetHeight;
                const navHeight = nav.offsetHeight;
                nav.style.top = `${headerHeight}px`;
                contentWrapper.style.paddingTop = `${headerHeight + navHeight}px`;
            }
        }

        function loadNames() {
            coupleName1 = localStorage.getItem('usWebsiteCoupleName1') || "Person 1";
            coupleName2 = localStorage.getItem('usWebsiteCoupleName2') || "Person 2";
            const name1Input = document.getElementById('name1Input');
            const name2Input = document.getElementById('name2Input');
            if (name1Input) name1Input.value = coupleName1 === "Person 1" ? "" : coupleName1;
            if (name2Input) name2Input.value = coupleName2 === "Person 2" ? "" : coupleName2;
        }

        function saveNames() {
            const newName1 = document.getElementById('name1Input').value.trim();
            const newName2 = document.getElementById('name2Input').value.trim();
            coupleName1 = newName1 || "Person 1";
            coupleName2 = newName2 || "Person 2";
            localStorage.setItem('usWebsiteCoupleName1', coupleName1);
            localStorage.setItem('usWebsiteCoupleName2', coupleName2);
            showAlert(i18next.t('settingsModal.namesSaved'));
            document.getElementById('settingsModal').classList.remove('active');
            updateDynamicNameDisplays();
            renderActiveSectionContent();
        }

        function updateDynamicNameDisplays() {
            document.querySelectorAll('[data-dynamic-name1]').forEach(el => el.textContent = coupleName1);
            document.querySelectorAll('[data-dynamic-name2]').forEach(el => el.textContent = coupleName2);
            updateFeedbackNameOptions();
        }

        function updateFeedbackNameOptions() {
            const nameMap = { "Salatiso": coupleName1, "Tee": coupleName2 };
            ['feedbackSender', 'feedbackRecipient', 'apologyFrom', 'dissatisfactionFrom', 'dateBooker', 'terminator'].forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    Array.from(select.options).forEach(option => {
                        if (nameMap[option.value]) {
                            option.textContent = nameMap[option.value];
                        }
                    });
                }
            });
        }

        function populateSelectWithOptions(selectId, options, isI18n = true, isMultiple = false) {
            const select = document.getElementById(selectId);
            if (!select) return;
            select.innerHTML = '';
            select.multiple = isMultiple;
            Object.entries(options).forEach(([value, label]) => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = isI18n ? i18next.t(label) : label;
                select.appendChild(option);
            });
        }

        function populateAllSelects() {
            const trackingMetrics = {
                affection: "tracking.affectionLevel",
                support: "tracking.supportScore",
                communication: "tracking.communicationFrequency",
                food: "tracking.foodContribution",
                safety: "tracking.safetyFeeling",
                finances: "tracking.financialTeamwork",
                feedbackResponse: "tracking.feedbackResponseTime"
            };
            populateSelectWithOptions('trackingMetricSelect', trackingMetrics);
            populateSelectWithOptions('dashboardMetricSelect', trackingMetrics);

            const weekOptions = relationshipData.weeks.reduce((acc, week) => {
                acc[week.weekNumber] = `Week ${week.weekNumber} (${week.startDate})`;
                return acc;
            }, {});
            populateSelectWithOptions('contributionFilterWeek', weekOptions, false);

            const peopleValues = { "Salatiso": coupleName1, "Tee": coupleName2 };
            ['feedbackSender', 'feedbackRecipient', 'apologyFrom', 'dissatisfactionFrom', 'dateBooker', 'terminator'].forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    select.innerHTML = '';
                    Object.keys(peopleValues).forEach(originalName => {
                        const option = document.createElement('option');
                        option.value = originalName;
                        option.textContent = peopleValues[originalName];
                        select.appendChild(option);
                    });
                }
            });

            const terminationReasons = {
                irreconcilable: "relationshipActions.terminate.reasons.irreconcilable",
                communication: "relationshipActions.terminate.reasons.communication",
                paths: "relationshipActions.terminate.reasons.paths",
                other: "relationshipActions.terminate.reasons.other"
            };
            populateSelectWithOptions('terminationReason', terminationReasons);

            const lifesyncPeriods = {
                last3Months: "lifesync.last3Months",
                allTime: "allTime"
            };
            populateSelectWithOptions('reportPeriod', lifesyncPeriods);

            const reportMetricsOptions = {
                affection: "overview.affectionLevel",
                support: "overview.supportScore",
                food: "overview.foodContribution",
                safety: "overview.safetyFeeling"
            };
            populateSelectWithOptions('reportMetrics', reportMetricsOptions, true, true);
        }

        function renderTimeline() {
            const timelineContainer = document.getElementById('overviewTimelineContainer');
            if (!timelineContainer) {
                console.error("Timeline container not found.");
                return;
            }
            timelineContainer.innerHTML = '';
            const events = relationshipData.weeks.flatMap(week =>
                (week.events || []).map(event => ({
                    ...event,
                    weekNumber: week.weekNumber,
                    summary: i18next.t(week.summaryKey, { defaultValue: `Week ${week.weekNumber}` })
                }))
            ).sort((a, b) => new Date(a.date) - new Date(b.date));

            if (events.length === 0) {
                timelineContainer.innerHTML = `<p class="text-center text-xs text-[var(--text-secondary-light)]">${i18next.t('timeline.noEvents')}</p>`;
                return;
            }

            events.forEach(event => {
                const card = document.createElement('div');
                card.className = 'timeline-event-card';
                const headline = i18next.t(event.headlineKey, {
                    song: i18next.t(event.songTitleKey || event.songTitle || "A Song"),
                    artist: event.artist || "Unknown Artist",
                    sharer: event.sharedBy === "Salatiso" ? coupleName1 : (event.sharedBy === "Tee" ? coupleName2 : event.sharedBy),
                    defaultValue: event.headlineKey || "Event"
                });
                const text = i18next.t(event.textKey, {
                    song: i18next.t(event.songTitleKey || event.songTitle || "A Song"),
                    artist: event.artist || "Unknown Artist",
                    sharer: event.sharedBy === "Salatiso" ? coupleName1 : (event.sharedBy === "Tee" ? coupleName2 : event.sharedBy),
                    defaultValue: event.textKey || "Details for this event."
                });
                card.innerHTML = `
                    <div>
                        <h4>${headline}</h4>
                        <p class="date">${event.date}</p>
                    </div>
                `;
                card.dataset.eventHeadline = headline;
                card.dataset.eventText = text;
                card.dataset.eventMedia = event.media?.url || '';
                timelineContainer.appendChild(card);
            });

            timelineContainer.querySelectorAll('.timeline-event-card').forEach(card => {
                card.addEventListener('click', () => {
                    const modal = document.getElementById('detailsModal');
                    const modalTitle = document.getElementById('modalTitle');
                    const modalBody = document.getElementById('modalBody');
                    if (modal && modalTitle && modalBody) {
                        modalTitle.textContent = card.dataset.eventHeadline;
                        modalBody.innerHTML = `
                            <p>${card.dataset.eventText}</p>
                            ${card.dataset.eventMedia ? `<img src="${card.dataset.eventMedia}" alt="Event media" class="w-full mt-2 rounded" onerror="this.style.display='none';">` : ''}
                        `;
                        modal.classList.add('active');
                    }
                });
            });
        }

        function renderOverviewTiles() {
            const tilesContainer = document.getElementById('overviewTilesContainer');
            if (!tilesContainer) {
                console.error("overviewTilesContainer element not found");
                return;
            }
            tilesContainer.querySelectorAll('.overview-tile').forEach(tile => {
                tile.addEventListener('click', () => {
                    const tileType = tile.dataset.tile;
                    const modal = document.getElementById('detailsModal');
                    const modalTitle = document.getElementById('modalTitle');
                    const modalBody = document.getElementById('modalBody');
                    if (modal && modalTitle && modalBody) {
                        modalTitle.textContent = i18next.t(`overview.${tileType}`);
                        let content = '';
                        switch (tileType) {
                            case 'ourSong':
                                content = `
                                    <p>"Thank You Baby! (For Makin' Someday Come So Soon)" by Shaggy</p>
                                    <a href="${relationshipData.ourSpecialSongUrl}" target="_blank" class="action-button text-xs py-1 px-2 mt-2">
                                        <i class="fas fa-headphones-alt mr-1"></i> ${i18next.t('overview.listenToSong')}
                                    </a>
                                `;
                                break;
                            case 'keyMoments':
                                                                content = relationshipData.weeks.flatMap(week =>
                                    (week.events || []).map(event => {
                                        const headline = i18next.t(event.headlineKey, {
                                            song: i18next.t(event.songTitleKey || event.songTitle || "A Song"),
                                            artist: event.artist || "Unknown Artist",
                                            sharer: event.sharedBy === "Salatiso" ? coupleName1 : (event.sharedBy === "Tee" ? coupleName2 : event.sharedBy),
                                            defaultValue: event.headlineKey || "Event"
                                        });
                                        const text = i18next.t(event.textKey, {
                                            song: i18next.t(event.songTitleKey || event.songTitle || "A Song"),
                                            artist: event.artist || "Unknown Artist",
                                            sharer: event.sharedBy === "Salatiso" ? coupleName1 : (event.sharedBy === "Tee" ? coupleName2 : event.sharedBy),
                                            defaultValue: event.textKey || "Details for this event."
                                        });
                                        return `
                                            <div class="mb-3">
                                                <h4 class="text-sm font-semibold text-[var(--accent-teal-bright)]">${headline}</h4>
                                                <p class="text-xs text-[var(--text-secondary-light)]">${event.date}</p>
                                                <p class="text-xs">${text}</p>
                                                ${event.media?.url ? `<img src="${event.media.url}" alt="Event media" class="w-full mt-2 rounded" onerror="this.style.display='none';">` : ''}
                                            </div>
                                        `;
                                    })
                                ).join('') || `<p class="text-xs">${i18next.t('timeline.noEvents')}</p>`;
                                break;
                            case 'sharedInterests':
                                content = relationshipData.sharedInterests.map(interest => `
                                    <div class="mb-3">
                                        <h4 class="text-sm font-semibold text-[var(--accent-teal-bright)]">${interest.name}</h4>
                                        <p class="text-xs">${interest.description}</p>
                                    </div>
                                `).join('') || `<p class="text-xs">${i18next.t('mediaGallery.noSongs', { defaultValue: 'No shared interests logged yet.' })}</p>`;
                                break;
                            case 'futurePlans':
                                content = relationshipData.futurePlans.map(plan => `
                                    <div class="mb-3">
                                        <h4 class="text-sm font-semibold text-[var(--accent-teal-bright)]">${plan.destination}</h4>
                                        <p class="text-xs">${plan.description}</p>
                                        <p class="text-xs text-[var(--accent-teal-dark)]">${plan.date}</p>
                                    </div>
                                `).join('') || `<p class="text-xs">${i18next.t('travel.noDesired', { defaultValue: 'No future plans added yet.' })}</p>`;
                                break;
                            default:
                                content = `<p class="text-xs">${i18next.t('comingSoon', { defaultValue: 'More details coming soon!' })}</p>`;
                        }
                        modalBody.innerHTML = content;
                        modal.classList.add('active');
                    }
                });
            });
        }

        function navigateToSection(sectionId) {
            currentMainSection = sectionId;
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            const activeSection = document.getElementById(sectionId);
            if (activeSection) {
                activeSection.classList.add('active');
            } else {
                console.warn(`Section with ID '${sectionId}' not found.`);
                return;
            }

            document.querySelectorAll('#mainNav .nav-tab').forEach(btn => {
                btn.classList.toggle('active-nav', btn.dataset.section === sectionId);
            });

            const activeSectionElement = document.getElementById(sectionId);
            const firstSubNavTab = activeSectionElement?.querySelector('.sub-nav-tab');
            if (firstSubNavTab) {
                navigateToSubSection(sectionId, currentSubTargets[sectionId] || firstSubNavTab.dataset.subtarget, true);
            } else {
                renderActiveSectionContent();
            }
        }

        function navigateToSubSection(mainSectionId, subTargetId, isInitialSectionLoad = false) {
            currentSubTargets[mainSectionId] = subTargetId;
            const mainSectionElement = document.getElementById(mainSectionId);
            mainSectionElement?.querySelectorAll('.sub-nav-tab').forEach(tab => tab.classList.toggle('active-sub-nav', tab.dataset.subtarget === subTargetId));
            mainSectionElement?.querySelectorAll('.sub-content').forEach(content => content.classList.toggle('active-sub-content', content.id === subTargetId));

            if (!isInitialSectionLoad) renderActiveSectionContent();
        }

        function handleNavClick(event) {
            const sectionId = event.target.dataset.section;
            if (sectionId) {
                navigateToSection(sectionId);
            }
        }

        function handleSubNavClick(event) {
            const subTargetId = event.target.dataset.subtarget;
            if (subTargetId) {
                navigateToSubSection(currentMainSection, subTargetId);
            }
        }

        function renderActiveSectionContent() {
            console.log(`Rendering main: ${currentMainSection}, sub: ${currentSubTargets[currentMainSection]}`);
            switch (currentMainSection) {
                case 'overview': renderOverviewSection(); break;
                case 'analysis': renderAnalysisHubSection(); break;
                case 'media': renderMediaTravelHubSection(); break;
                case 'connect': renderConnectResolveSection(); break;
                case 'lifesyncFun': renderLifesyncFunSection(); break;
                default: console.warn(`Unknown section: ${currentMainSection}`);
            }
        }

        function renderOverviewSection() {
            updateDashboardMetrics();
            updateDashboardChart();
            renderOverviewTiles();
            renderTimeline();
        }

        function updateDashboardMetrics() {
            const latestWeek = relationshipData.weeks.length > 0 ? relationshipData.weeks[relationshipData.weeks.length - 1] : null;
            const getScore = (metric) => {
                if (latestWeek && latestWeek.contributions && latestWeek.contributions[metric]) {
                    const p1Score = latestWeek.contributions[metric].salatiso?.score || 0;
                    const p2Score = latestWeek.contributions[metric].tee?.score || 0;
                    if (p1Score === 0 && p2Score === 0 && latestWeek.contributions[metric].score !== undefined) {
                        return `${latestWeek.contributions[metric].score}/10`;
                    }
                    return ((p1Score + p2Score) / 2).toFixed(1) + "/10";
                }
                return '--';
            };

            const metrics = ['affection', 'support', 'food', 'safety'];
            metrics.forEach(metric => {
                const element = document.getElementById(`${metric}-metric`);
                if (element) {
                    element.textContent = getScore(metric);
                }
            });
        }

        function updateDashboardChart() {
            const el = document.getElementById('dashboardChart');
            if (!el) {
                console.error("dashboardChart element not found");
                return;
            }
            const ctx = el.getContext('2d');
            const selectedMetric = document.getElementById('dashboardMetricSelect')?.value || 'affection';
            const labels = relationshipData.weeks.map(w => `Wk ${w.weekNumber}`);
            const data1 = relationshipData.weeks.map(w => w.contributions[selectedMetric]?.salatiso?.score || (w.contributions[selectedMetric]?.score / 2) || 0);
            const data2 = relationshipData.weeks.map(w => w.contributions[selectedMetric]?.tee?.score || (w.contributions[selectedMetric]?.score / 2) || 0);
            const metricLabel = i18next.t(`tracking.${selectedMetric}`, { defaultValue: selectedMetric });

            if (dashboardMainChart) dashboardMainChart.destroy();
            dashboardMainChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: `${coupleName1} - ${metricLabel}`,
                            data: data1,
                            borderColor: 'var(--accent-teal-bright)',
                            backgroundColor: 'rgba(45, 212, 191, 0.1)',
                            tension: 0.3,
                            borderWidth: 1.5,
                            pointBackgroundColor: 'var(--accent-teal-bright)',
                            pointRadius: 3,
                            fill: true
                        },
                        {
                            label: `${coupleName2} - ${metricLabel}`,
                            data: data2,
                            borderColor: 'var(--accent-teal-dark)',
                            backgroundColor: 'rgba(38, 166, 154, 0.1)',
                            tension: 0.3,
                            borderWidth: 1.5,
                            pointBackgroundColor: 'var(--accent-teal-dark)',
                            pointRadius: 3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            ticks: { color: 'var(--text-secondary-light)', font: { size: 10 } },
                            grid: { color: 'var(--border-color-teal)' }
                        },
                        x: {
                            ticks: { color: 'var(--text-secondary-light)', font: { size: 10 } },
                            grid: { color: 'var(--border-color-teal)' }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { color: 'var(--text-primary-light)', font: { size: 10 } }
                        }
                    }
                }
            });
        }

        function renderAnalysisHubSection() {
            const activeSub = currentSubTargets.analysis;
            if (activeSub === 'analysis-tracking') {
                updateTrackingChart(document.getElementById('trackingMetricSelect')?.value || 'affection');
            } else if (activeSub === 'analysis-contributions') {
                renderContributionsTable(document.getElementById('contributionFilterWeek')?.value || (relationshipData.weeks.length > 0 ? relationshipData.weeks[0].weekNumber.toString() : '1'));
            } else if (activeSub === 'analysis-reinforcement') {
                renderReinforcementTable();
            }
        }

        function updateTrackingChart(metricKey = 'affection') {
            const el = document.getElementById('trackingChart');
            if (!el) {
                console.error("trackingChart element not found");
                return;
            }
            const ctx = el.getContext('2d');
            const labels = relationshipData.weeks.map(w => `Wk ${w.weekNumber} (${w.startDate})`);
            let data1 = [], data2 = [];
            let metricLabel = i18next.t(`tracking.${metricKey}`);
            relationshipData.weeks.forEach(w => {
                const contrib = w.contributions[metricKey];
                if (contrib) {
                    data1.push(contrib.salatiso?.score || (contrib.score / 2) || 0);
                    data2.push(contrib.tee?.score || (contrib.score / 2) || 0);
                } else {
                    data1.push(0);
                    data2.push(0);
                }
            });

            if (data1.every(val => val === 0) && data2.every(val => val === 0) && metricKey !== 'feedbackResponseTime') {
                metricLabel += ` (${i18next.t('tracking.noResponseData')})`;
            }
            if (analysisTrackingChart) analysisTrackingChart.destroy();
            analysisTrackingChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: `${coupleName1} - ${metricLabel}`,
                            data: data1,
                            backgroundColor: 'rgba(45, 212, 191, 0.3)',
                            borderColor: 'var(--accent-teal-bright)',
                            borderWidth: 1.5,
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: `${coupleName2} - ${metricLabel}`,
                            data: data2,
                            backgroundColor: 'rgba(38, 166, 154, 0.3)',
                            borderColor: 'var(--accent-teal-dark)',
                            borderWidth: 1.5,
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: (metricKey === 'finances' ? undefined : 10),
                            ticks: { color: 'var(--text-secondary-light)' },
                            grid: { color: 'var(--border-color-teal)' }
                        },
                        x: {
                            ticks: { color: 'var(--text-secondary-light)' },
                            grid: { color: 'var(--border-color-teal)' }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { color: 'var(--text-primary-light)' }
                        }
                    }
                }
            });
        }

        function renderContributionsTable(weekNumStr) {
            const tableBody = document.getElementById('contributionsTableBody');
            if (!tableBody) {
                console.error("contributionsTableBody element not found");
                return;
            }
            tableBody.innerHTML = '';

            const weekNumber = parseInt(weekNumStr);
            const weekData = relationshipData.weeks.find(w => w.weekNumber === weekNumber);
            if (!weekData || !weekData.contributions) {
                tableBody.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-xs">${i18next.t('contributions.noDataForWeek')}</td></tr>`;
                return;
            }
            const parameters = i18next.t('contributions.params', { returnObjects: true });
            Object.keys(parameters).forEach(paramKey => {
                const contrib = weekData.contributions[paramKey];
                const tr = tableBody.insertRow();
                tr.className = 'text-xs';
                tr.insertCell().textContent = parameters[paramKey];

                const formatContrib = (personData) => {
                    if (!personData && personData !== 0) return i18next.t('contributions.noneReported');
                    let text = '';
                    if (personData.score !== undefined) text += `${personData.score}`;
                    else if (typeof personData === 'number') text += `${personData}`;
                    if (personData.actions && personData.actions.length > 0) {
                        text += (text ? ' (' : '') + personData.actions.join(', ') + (text ? ')' : '');
                    }
                    return text || (personData === 0 ? '0' : i18next.t('contributions.noneReported'));
                };

                tr.insertCell().textContent = formatContrib(contrib?.salatiso || contrib);
                tr.insertCell().textContent = formatContrib(contrib?.tee || contrib);
                const notesKey = contrib?.notesKey;
                const notesText = notesKey ? i18next.t(notesKey) : (contrib?.notes || '');
                tr.insertCell().textContent = notesText;
            });
        }

        function renderReinforcementTable() {
            const tableBody = document.getElementById('reinforcementTableBody');
            if (!tableBody) {
                console.error("reinforcementTableBody element not found");
                return;
            }
            tableBody.innerHTML = '';
            relationshipData.reinforcementWords.forEach(item => {
                const tr = tableBody.insertRow();
                tr.className = 'text-xs';
                tr.insertCell().textContent = i18next.t(item.wordActionKey);
                tr.insertCell().textContent = i18next.t(item.purposeKey);
                tr.insertCell().textContent = item.occurrences.salatiso.length > 0 ? item.occurrences.salatiso.join(', ') : '0';
                tr.insertCell().textContent = item.occurrences.tee.length > 0 ? item.occurrences.tee.join(', ') : '0';
                tr.insertCell().textContent = item.occurrences.joint.length > 0 ? item.occurrences.joint.join(', ') : '0';
            });
        }

        function renderMediaTravelHubSection() {
            const activeSub = currentSubTargets.media;
            if (activeSub === 'media-songs') renderSongList();
            else if (activeSub === 'media-photos') renderPhotoGallery();
            else if (activeSub === 'travel-visited') renderTravelLog('visitedPlacesContainer', relationshipData.travelLog.filter(t => t.type === 'visited'), 'visited');
            else if (activeSub === 'travel-desired') renderTravelLog('desiredPlacesContainer', relationshipData.desiredTravel, 'desired');
        }

        function renderSongList() {
            const container = document.getElementById('songListContainer');
            if (!container) {
                console.error("songListContainer element not found");
                return;
            }
            container.innerHTML = '';
            if (!relationshipData.sharedSongs || relationshipData.sharedSongs.length === 0) {
                container.innerHTML = `<p class="text-sm text-center text-[var(--text-secondary-light)]">${i18next.t('mediaGallery.noSongs')}</p>`;
                return;
            }
            relationshipData.sharedSongs.forEach(song => {
                const songItem = document.createElement('div');
                songItem.className = 'song-item p-3 rounded-md shadow-sm flex justify-between items-center bg-[var(--bg-card-teal)]';
                const title = song.titleKey ? i18next.t(song.titleKey) : song.title;
                const sharedBy = song.sharedBy === "Salatiso" ? coupleName1 : (song.sharedBy === "Tee" ? coupleName2 : song.sharedBy);
                songItem.innerHTML = `
                    <div class="song-item-info">
                        <h4 class="font-semibold text-sm text-[var(--accent-teal-bright)]">${title}</h4>
                        <p class="text-xs text-[var(--text-secondary-light)]">${i18next.t('mediaGallery.sharedSongs')} by: ${sharedBy} - Artist: ${song.artist}</p>
                    </div>
                    <div class="song-item-actions">
                        <a href="${song.link}" target="_blank" title="${i18next.t('overview.listenToSong')}" class="text-lg text-[var(--accent-teal-bright)]"><i class="fas fa-play-circle"></i></a>
                    </div>`;
                container.appendChild(songItem);
            });
        }

        function renderPhotoGallery() {
            const container = document.getElementById('photoGalleryContainer');
            if (!container) {
                console.error("photoGalleryContainer element not found");
                return;
            }
            container.innerHTML = '';
            if (!relationshipData.photoFileNames || relationshipData.photoFileNames.length === 0) {
                container.innerHTML = `<p class="text-sm text-center text-[var(--text-secondary-light)]">${i18next.t('mediaGallery.noPhotos')}</p>`;
                return;
            }
            relationshipData.photoFileNames.forEach((fileName, index) => {
                const item = document.createElement('div');
                item.className = 'media-gallery-item relative group cursor-pointer aspect-square';
                item.innerHTML = `<img src="${fileName}" alt="${i18next.t('mediaGallery.photoMoments')} ${index + 1}" class="w-full h-full object-cover rounded transition-transform duration-300 group-hover:scale-105" onerror="this.src='assets/photos/fallback.jpg';">`;
                item.addEventListener('click', () => {
                    const modal = document.getElementById('detailsModal');
                    const modalTitle = document.getElementById('modalTitle');
                    const modalBody = document.getElementById('modalBody');
                    if (modal && modalTitle && modalBody) {
                        modalTitle.textContent = i18next.t('mediaGallery.photoMoments');
                        modalBody.innerHTML = `<img src="${fileName}" alt="Photo ${index + 1}" class="w-full rounded">`;
                        modal.classList.add('active');
                    }
                });
                container.appendChild(item);
            });
        }

        function renderTravelLog(containerId, items, type) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`${containerId} element not found`);
                return;
            }
            container.innerHTML = '';
            const noItemsKey = type === 'visited' ? 'travel.noVisited' : 'travel.noDesired';
            if (!items || items.length === 0) {
                container.innerHTML = `<p class="text-sm text-center text-[var(--text-secondary-light)]">${i18next.t(noItemsKey)}</p>`;
                return;
            }
            items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'travel-item p-3 rounded-md shadow-sm bg-[var(--bg-card-teal)]';
                let content = `<h4 class="text-[var(--accent-teal-bright)] text-sm">${item.destinationKey ? i18next.t(item.destinationKey) : item.destination}</h4>`;
                if (type === 'visited') {
                    const role1 = item.roles.salatisoKey ? i18next.t(item.roles.salatisoKey) : 'N/A';
                    const role2 = item.roles.teeKey ? i18next.t(item.roles.teeKey) : 'N/A';
                    content += `
                        <p class="text-xs"><strong>${i18next.t('travel.dates', { defaultValue: 'Dates' })}:</strong> ${item.dates}</p>
                        <p class="text-xs"><strong>${i18next.t('travel.highlightsTitle')}:</strong> ${i18next.t(item.highlightsKey)}</p>
                        <p class="text-xs"><strong>${i18next.t('travel.rolesTitle')}:</strong> ${coupleName1}: ${role1}, ${coupleName2}: ${role2}</p>`;
                    if (item.photos && item.photos.length > 0) {
                        content += `<div class="photos-grid mt-1.5 grid grid-cols-3 gap-1">
                            ${item.photos.map(pUrl => `<img src="${pUrl}" alt="${i18next.t('travel.photo', { defaultValue: 'Travel photo' })}" class="rounded object-cover h-16 w-full" onerror="this.src='assets/photos/fallback.jpg';">`).join('')}
                        </div>`;
                    }
                } else {
                    content += `<p class="text-xs">${item.description}</p><p class="text-xs"><strong>${i18next.t('travel.priority', { defaultValue: 'Priority' })}:</strong> ${item.priority}</p>`;
                }
                itemDiv.innerHTML = content;
                container.appendChild(itemDiv);
            });
        }

        function renderConnectResolveSection() {
            const activeSub = currentSubTargets.connect;
            if (activeSub === 'connect-feedback') renderFeedbackLog();
            else if (activeSub === 'connect-logs') renderRelationshipActionLog();
        }

        function renderFeedbackLog() {
            const container = document.getElementById('feedbackLogContainer');
            if (!container) {
                console.error("feedbackLogContainer element not found");
                return;
            }
            container.innerHTML = '';
            if (relationshipData.feedbackLog.length === 0) {
                container.innerHTML = `<p class="text-center text-xs text-[var(--text-secondary-light)]">${i18next.t('feedback.noFeedbackYet')}</p>`;
                return;
            }
            relationshipData.feedbackLog.slice().reverse().forEach(fb => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'feedback-item p-2.5 border rounded-md';
                itemDiv.style.borderColor = "var(--border-color-teal)";
                itemDiv.style.backgroundColor = "rgba(255,255,255,0.05)";
                const senderName = fb.sender === "Salatiso" ? coupleName1 : (fb.sender === "Tee" ? coupleName2 : fb.sender);
                const recipientName = fb.recipient === "Salatiso" ? coupleName1 : (fb.recipient === "Tee" ? coupleName2 : fb.recipient);
                let responseHtml = `<p class="response-status text-xs mt-1 text-[var(--accent-teal-dark)]">${i18next.t('feedback.pendingResponse')}</p>`;
                if (fb.responseTimestamp) {
                    responseHtml = `<p class="text-xs mt-1 pt-1 border-t border-[var(--border-color-teal)]"><strong>${i18next.t('feedback.responseFrom', { defaultValue: 'Response from' })} ${recipientName}</strong> (${new Date(fb.responseTimestamp).toLocaleString()}):<br>${fb.response}</p>`;
                }
                itemDiv.innerHTML = `
                    <p class="font-medium text-sm">${i18next.t('feedback.feedbackFrom', { name: senderName })} ${i18next.t('feedback.to', { defaultValue: 'to' })} ${recipientName}:</p>
                    <p class="text-sm">${fb.message}</p>
                    <p class="timestamp text-xs mt-1">${i18next.t('feedback.sent', { defaultValue: 'Sent' })}: ${new Date(fb.timestamp).toLocaleString()}</p>
                    ${responseHtml}`;
                container.appendChild(itemDiv);
            });
        }

        function renderRelationshipActionLog() {
            const container = document.getElementById('relationshipActionLogContainer');
            if (!container) {
                console.error("relationshipActionLogContainer element not found");
                return;
            }
            container.innerHTML = '';
            if (relationshipData.actionLog.length === 0) {
                container.innerHTML = `<p class="text-center text-xs text-[var(--text-secondary-light)]">${i18next.t('relationshipActions.noActionsYet')}</p>`;
                return;
            }
            relationshipData.actionLog.slice().reverse().forEach(log => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'action-log-item p-2.5 border rounded-md';
                itemDiv.style.borderColor = "var(--border-color-teal)";
                itemDiv.style.backgroundColor = "rgba(255,255,255,0.05)";
                const actorName = log.actor === "Salatiso" ? coupleName1 : (log.actor === "Tee" ? coupleName2 : log.actor);
                let detailsText = log.message || '';
                if (log.type === "dateProposal" && log.details) {
                    detailsText = `${i18next.t('relationshipActions.dateProposal.activity', { defaultValue: 'Activity' })}: ${log.details.activity}, ${i18next.t('relationshipActions.dateProposal.proposedDate', { defaultValue: 'Proposed' })}: ${log.details.proposedDate}. ${log.message || ''}`;
                } else if (log.type === "termination" && log.details) {
                    detailsText = `${i18next.t('relationshipActions.terminate.reason', { defaultValue: 'Reason' })}: ${i18next.t(log.details.reasonKey)}. ${log.details.otherReason || ''} ${log.message || ''}`;
                } else if (log.type === "dissatisfaction" && log.details) {
                    detailsText = log.message || '';
                }
                itemDiv.innerHTML = `
                    <p class="font-medium text-sm"><strong>${i18next.t(`relationshipActions.${log.type}.title`, { defaultValue: log.type.charAt(0).toUpperCase() + log.type.slice(1) })}</strong></p>
                    <p class="text-xs">${i18next.t('relationshipActions.actionBy', { name: actorName })}</p>
                    ${detailsText ? `<p class="text-sm mt-1">${i18next.t('relationshipActions.actionDetails', { details: detailsText })}</p>` : ''}
                    <p class="timestamp text-xs mt-1">${i18next.t('relationshipActions.logged', { defaultValue: 'Logged' })}: ${new Date(log.timestamp).toLocaleString()}</p>`;
                container.appendChild(itemDiv);
            });
        }

        function renderLifesyncFunSection() {
            const activeSub = currentSubTargets.lifesyncFun;
            if (activeSub === 'lifesync-reports') {
                renderReportPreview();
            }
        }

        function renderReportPreview() {
            const container = document.getElementById('reportPreview');
            if (!container) {
                console.error("reportPreview element not found");
                return;
            }
            const period = document.getElementById('reportPeriod')?.value;
            const metrics = Array.from(document.getElementById('reportMetrics')?.selectedOptions || []).map(opt => opt.value);
            if (!period || metrics.length === 0) {
                container.innerHTML = `<p class="text-xs text-[var(--text-secondary-light)]">${i18next.t('lifesync.selectOptions', { defaultValue: 'Select a period and metrics to generate a report.' })}</p>`;
                return;
            }

            const filteredWeeks = period === 'last3Months'
                ? relationshipData.weeks.filter(w => new Date(w.startDate) >= new Date(Date.now() - 90 * 24 * 60 * 60 * 1000))
                : relationshipData.weeks;

            let reportHtml = `<h4 class="text-sm font-semibold text-[var(--accent-teal-bright)]">${i18next.t('lifesync.reportTitle', { defaultValue: 'Relationship Report' })}</h4>`;
            metrics.forEach(metric => {
                const metricLabel = i18next.t(`overview.${metric}Level`) || i18next.t(`overview.${metric}Score`) || i18next.t(`overview.${metric}Contribution`) || i18next.t(`overview.${metric}Feeling`) || metric;
                const data1 = filteredWeeks.map(w => w.contributions[metric]?.salatiso?.score || (w.contributions[metric]?.score / 2) || 0);
                const data2 = filteredWeeks.map(w => w.contributions[metric]?.tee?.score || (w.contributions[metric]?.score / 2) || 0);
                const avg1 = data1.length > 0 ? (data1.reduce((a, b) => a + b, 0) / data1.length).toFixed(1) : '--';
                const avg2 = data2.length > 0 ? (data2.reduce((a, b) => a + b, 0) / data2.length).toFixed(1) : '--';
                reportHtml += `
                    <p class="mt-2"><strong>${metricLabel}</strong></p>
                    <p class="text-xs">${coupleName1}: ${avg1}/10, ${coupleName2}: ${avg2}/10</p>
                `;
            });
            container.innerHTML = reportHtml;
        }

        function setupEventListeners() {
            document.querySelectorAll('#mainNav .nav-tab').forEach(button => button.addEventListener('click', handleNavClick));
            document.querySelectorAll('.content-section .sub-nav-tab').forEach(tab => tab.addEventListener('click', handleSubNavClick));
            document.getElementById('langEN')?.addEventListener('click', () => i18next.changeLanguage('en', updateContentAllAndTimeline));
            document.getElementById('langXH')?.addEventListener('click', () => i18next.changeLanguage('xh', updateContentAllAndTimeline));

            ['closeDetailsModalBtn', 'closeAlertModalBtn', 'closePlaylistModalBtnPopup', 'closeSettingsModal'].forEach(id => {
                document.getElementById(id)?.addEventListener('click', () => {
                    const modalId = id.replace('close', '').toLowerCase().replace('btnpopup', 'Modal').replace('modalbtn', 'Modal');
                    const modalElement = document.getElementById(modalId);
                    if (modalElement) modalElement.classList.remove('active');
                });
            });

            document.getElementById('alertModalOkBtn')?.addEventListener('click', () => {
                const alertModal = document.getElementById('alertModal');
                if (alertModal) alertModal.classList.remove('active');
            });

            document.getElementById('playlistButton')?.addEventListener('click', () => {
                const playlistModal = document.getElementById('playlistModal');
                if (playlistModal) playlistModal.classList.add('active');
            });

            document.getElementById('settingsButton')?.addEventListener('click', () => {
                const settingsModal = document.getElementById('settingsModal');
                if (settingsModal) settingsModal.classList.add('active');
            });

            document.getElementById('saveNamesButton')?.addEventListener('click', saveNames);

            document.getElementById('dashboardMetricSelect')?.addEventListener('change', updateDashboardChart);
            document.getElementById('trackingMetricSelect')?.addEventListener('change', (e) => {
                if (currentSubTargets.analysis === 'analysis-tracking') updateTrackingChart(e.target.value);
            });
            document.getElementById('contributionFilterWeek')?.addEventListener('change', (e) => {
                if (currentSubTargets.analysis === 'analysis-contributions') renderContributionsTable(e.target.value);
            });

            document.getElementById('feedbackForm')?.addEventListener('submit', handleSendFeedback);
            document.getElementById('apologyForm')?.addEventListener('submit', handleSendApology);
            document.getElementById('dissatisfactionForm')?.addEventListener('submit', handleSendDissatisfaction);
            document.getElementById('dateProposalForm')?.addEventListener('submit', handleDateProposal);
            document.getElementById('terminationForm')?.addEventListener('submit', handleTerminationRequest);

            document.getElementById('checkCompatibility')?.addEventListener('click', handleAstrologyCheck);
            document.querySelectorAll('.compatibility-test-btn').forEach(btn => btn.addEventListener('click', () => showAlert(i18next.t('comingSoon'))));
            document.getElementById('generateReport')?.addEventListener('click', renderReportPreview);

            window.addEventListener('resize', updateNavStickiness);
            window.addEventListener('click', (event) => {
                if (event.target.classList.contains('modal')) {
                    event.target.classList.remove('active');
                }
            });
        }

        function updateContentAllAndTimeline() {
            updateContentAll();
            renderTimeline();
        }

        function handleSendFeedback(e) {
            e.preventDefault();
            const senderValue = document.getElementById('feedbackSender').value;
            const recipientValue = document.getElementById('feedbackRecipient').value;
            const message = document.getElementById('feedbackMessage').value.trim();

            if (!message) {
                showAlert(i18next.t('feedback.messageEmpty'));
                return;
            }
            if (senderValue === recipientValue) {
                showAlert(i18next.t('feedback.senderRecipientSame'));
                return;
            }
            relationshipData.feedbackLog.push({
                id: Date.now(),
                sender: senderValue,
                recipient: recipientValue,
                message,
                timestamp: new Date().toISOString(),
                response: null,
                read: false
            });
            showAlert(i18next.t('feedback.success'));
            document.getElementById('feedbackMessage').value = '';
            if (currentSubTargets.connect === 'connect-feedback') renderFeedbackLog();
        }

        function handleSendApology(e) {
            e.preventDefault();
            const fromValue = document.getElementById('apologyFrom').value;
            const message = document.getElementById('apologyMessage').value.trim();
            if (!message) {
                showAlert(i18next.t('alert.messageEmpty'));
                return;
            }
            const target = fromValue === "Salatiso" ? "Tee" : "Salatiso";
            logRelationshipAction('apology', fromValue, target, message);
            document.getElementById('apologyMessage').value = '';
        }

        function handleSendDissatisfaction(e) {
            e.preventDefault();
            const fromValue = document.getElementById('dissatisfactionFrom').value;
            const message = document.getElementById('dissatisfactionMessage').value.trim();
            if (!message) {
                showAlert(i18next.t('alert.messageEmpty'));
                return;
            }
            const target = fromValue === "Salatiso" ? "Tee" : "Salatiso";
            logRelationshipAction('dissatisfaction', fromValue, target, message);
            document.getElementById('dissatisfactionMessage').value = '';
            showAlert(i18next.t('relationshipActions.dissatisfaction.success'));
        }

        function handleDateProposal(e) {
            e.preventDefault();
            const booker = document.getElementById('dateBooker').value;
            const activity = document.getElementById('dateActivity').value.trim();
            const proposedDate = document.getElementById('dateProposed').value;
            const message = document.getElementById('dateMessage').value.trim();
            if (!activity || !proposedDate) {
                showAlert(i18next.t('alert.fillAllFields'));
                return;
            }
            const target = booker === "Salatiso" ? "Tee" : "Salatiso";
            logRelationshipAction('dateProposal', booker, target, message, { activity, proposedDate });
            document.getElementById('dateActivity').value = '';
            document.getElementById('dateProposed').value = '';
            document.getElementById('dateMessage').value = '';
            showAlert(i18next.t('relationshipActions.dateProposal.success'));
        }

        function handleTerminationRequest(e) {
            e.preventDefault();
            const terminator = document.getElementById('terminator').value;
            const reasonKey = document.getElementById('terminationReason').value;
            const otherReason = document.getElementById('terminationOtherReason').value.trim();
            const message = document.getElementById('terminationMessage').value.trim();
            if (!message) {
                showAlert(i18next.t('alert.messageEmpty'));
                return;
            }
            const target = terminator === "Salatiso" ? "Tee" : "Salatiso";
            logRelationshipAction('termination', terminator, target, message, { reasonKey, otherReason });
            document.getElementById('terminationOtherReason').value = '';
            document.getElementById('terminationMessage').value = '';
            showAlert(i18next.t('relationshipActions.terminate.success'));
        }

        function handleAstrologyCheck() {
            const name1BdayStr = document.getElementById('salatisoBirthday').value;
            const name2BdayStr = document.getElementById('teeBirthday').value;
            const resultDiv = document.getElementById('compatibilityResult');
            if (!resultDiv) {
                console.error("compatibilityResult element not found");
                return;
            }
            if (!name1BdayStr || !name2BdayStr) {
                resultDiv.textContent = i18next.t('funtools.astrology.invalidDate');
                return;
            }
            const sign1 = getZodiacSign(new Date(name1BdayStr));
            const sign2 = getZodiacSign(new Date(name2BdayStr));
            let msg = `${i18next.t('funtools.astrology.signIsA', { name: coupleName1, sign: sign1 })}. ${i18next.t('funtools.astrology.signIsA', { name: coupleName2, sign: sign2 })}. `;
            if ((sign1 === "Virgo" && sign2 === "Taurus") || (sign1 === "Taurus" && sign2 === "Virgo")) {
                msg += i18next.t('funtools.astrology.virgoTaurus');
            } else {
                msg += i18next.t('funtools.astrology.general');
            }
            resultDiv.textContent = msg;
        }

        function updateContentAll() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const optionsAttr = el.getAttribute('data-i18n-options');
                let options = {};
                if (optionsAttr) {
                    try {
                        options = JSON.parse(optionsAttr);
                    } catch (e) {
                        console.warn(`Error parsing i18n options for ${key}:`, e);
                    }
                }

                if (key.includes('person1NamePlaceholder')) options.name1 = coupleName1;
                if (key.includes('person2NamePlaceholder')) options.name2 = coupleName2;
                if (key.includes('{name}')) {
                    if (options.actor) options.name = options.actor === "Salatiso" ? coupleName1 : (options.actor === "Tee" ? coupleName2 : options.actor);
                    else if (options.sender) options.name = options.sender === "Salatiso" ? coupleName1 : (options.sender === "Tee" ? coupleName2 : options.sender);
                }

                const translation = i18next.t(key, options);
                if (el.hasAttribute('data-i18n-placeholder')) {
                    el.placeholder = translation;
                } else if (el.tagName === 'TITLE') {
                    el.textContent = translation;
                } else {
                    el.innerHTML = translation;
                }
            });
            populateAllSelects();
            updateDynamicNameDisplays();
            renderActiveSectionContent();
        }

        function getZodiacSign(date) {
            if (!(date instanceof Date) || isNaN(date)) return "Invalid Date";
            const day = date.getDate();
            const month = date.getMonth() + 1;
            if ((month === 1 && day >= 20) || (month === 2 && day <= 18)) return "Aquarius";
            if ((month === 2 && day >= 19) || (month === 3 && day <= 20)) return "Pisces";
            if ((month === 3 && day >= 21) || (month === 4 && day <= 19)) return "Aries";
            if ((month === 4 && day >= 20) || (month === 5 && day <= 20)) return "Taurus";
            if ((month === 5 && day >= 21) || (month === 6 && day <= 20)) return "Gemini";
            if ((month === 6 && day >= 21) || (month === 7 && day <= 22)) return "Cancer";
            if ((month === 7 && day >= 23) || (month === 8 && day <= 22)) return "Leo";
            if ((month === 8 && day >= 23) || (month === 9 && day <= 22)) return "Virgo";
            if ((month === 9 && day >= 23) || (month === 10 && day <= 22)) return "Libra";
            if ((month === 10 && day >= 23) || (month === 11 && day <= 21)) return "Scorpio";
            if ((month === 11 && day >= 22) || (month === 12 && day <= 21)) return "Sagittarius";
            if ((month === 12 && day >= 22) || (month === 1 && day <= 19)) return "Capricorn";
            return "Unknown";
        }

        function logRelationshipAction(type, actor, target, message, details = {}) {
            const newAction = { id: Date.now(), type, actor, target, message, timestamp: new Date().toISOString(), details };
            relationshipData.actionLog.push(newAction);
            showAlert(i18next.t('alert.actionLogged'));
            if (currentSubTargets.connect === 'connect-logs') renderRelationshipActionLog();
        }

        function showAlert(message, title = i18next.t('alert.defaultTitle')) {
            const modal = document.getElementById('alertModal');
            const titleEl = document.getElementById('alertModalTitle');
            const messageEl = document.getElementById('alertModalMessage');
            if (modal && titleEl && messageEl) {
                titleEl.textContent = title;
                messageEl.textContent = message;
                modal.classList.add('active');
            } else {
                console.warn("Alert modal elements not found");
            }
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
