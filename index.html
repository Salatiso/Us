<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="siteTitle">Tee & Me - Our Story</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- i18next CDNs -->
    <script src="https://unpkg.com/i18next@23.11.5/dist/umd/i18next.min.js"></script>
    <script src="https://unpkg.com/i18next-browser-languagedetector@7.1.0/dist/umd/i18nextBrowserLanguageDetector.min.js"></script>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts (Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- External Translations -->
    <script src="xh_translations.js"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background: #F5F5F5;
        }
        #videoBackground {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0.3;
        }
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 60px;
            height: 100%;
            background: #333333;
            z-index: 20;
        }
        .content-area-wrapper {
            margin-left: 60px;
            height: 100%;
        }
        .content-section {
            height: 100%;
            overflow: hidden;
            display: none;
            background: rgba(255, 255, 255, 0.95);
        }
        .content-section.active {
            display: flex;
        }
        .sub-content {
            overflow-y: auto;
            max-height: calc(100% - 50px);
        }
        .carousel {
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            scrollbar-width: none;
        }
        .carousel::-webkit-scrollbar {
            display: none;
        }
        .carousel-item {
            flex: 0 0 auto;
            margin-right: 1rem;
            position: relative;
        }
        .carousel-item:hover .details-preview {
            display: block;
        }
        .details-preview {
            display: none;
            position: absolute;
            background: #4B9CD3;
            color: white;
            padding: 0.5rem;
            border-radius: 0.25rem;
            z-index: 10;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 30;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }
        .modal.active {
            display: flex;
        }
        #playlistButton {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 40;
            background: #D4A017;
            color: white;
            padding: 0.75rem;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <!-- Video Background -->
    <video id="videoBackground" autoplay loop muted>
        <source src="assets/videos/background.mp4" type="video/mp4">
    </video>

    <!-- Sidebar -->
    <div class="sidebar flex flex-col items-center py-4">
        <button class="nav-tab text-white p-2" data-section="overview"><i class="fas fa-home"></i></button>
        <button class="nav-tab text-white p-2" data-section="analysis"><i class="fas fa-chart-line"></i></button>
        <button class="nav-tab text-white p-2" data-section="media"><i class="fas fa-camera"></i></button>
        <button class="nav-tab text-white p-2" data-section="connect"><i class="fas fa-comments"></i></button>
        <button class="nav-tab text-white p-2" data-section="lifesync"><i class="fas fa-heart"></i></button>
        <button id="langEN" class="text-white p-2" data-i18n="langEN">EN</button>
        <button id="langXH" class="text-white p-2" data-i18n="langXH">XH</button>
    </div>

    <!-- Content Area -->
    <div class="content-area-wrapper">
        <div class="content-area">
            <!-- Overview Section -->
            <section id="overview" class="content-section flex flex-col md:flex-row p-4">
                <div class="w-full md:w-1/2 p-4">
                    <h2 class="text-xl font-bold mb-4" data-i18n="overviewTitle">Our Journey Snapshot</h2>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-blue-100 p-4 rounded">
                            <h3 data-i18n="metricAffection">Affection Level</h3>
                            <p id="metricAffection">N/A</p>
                        </div>
                        <!-- Other metric cards -->
                    </div>
                    <div class="mb-4">
                        <h3 data-i18n="specialSong">Our Special Song</h3>
                        <p>"Thank You Baby! (For Makin' Someday Come So Soon)"</p>
                        <a href="https://youtu.be/DOcCQ-kC4iE?si=DrJURhh0p86ce7yt" target="_blank" class="text-blue-500" data-i18n="listen">Listen</a>
                    </div>
                    <h3 data-i18n="timelineTitle">Quick Timeline</h3>
                    <div id="timelineCarousel" class="carousel relative">
                        <!-- Populated dynamically -->
                    </div>
                </div>
                <div class="w-full md:w-1/2 p-4">
                    <div id="imageCarousel" class="carousel mb-4">
                        <!-- Populated dynamically -->
                    </div>
                    <select id="dashboardMetricSelect" class="mb-2 p-2 border rounded">
                        <!-- Populated dynamically -->
                    </select>
                    <canvas id="dashboardChart"></canvas>
                </div>
            </section>

            <!-- Analysis Hub, Media & Travel, Connect & Resolve, LifeSync & Fun Sections -->
            <!-- Similar structure as original, with enhanced report section -->
            <section id="lifesync" class="content-section flex flex-col p-4">
                <div class="sub-nav-tabs flex mb-4">
                    <button class="sub-nav-tab bg-blue-500 text-white px-4 py-2 rounded" data-subsection="reports" data-i18n="tabReports">LifeSync Reports</button>
                    <!-- Other tabs -->
                </div>
                <div id="reports" class="sub-content hidden">
                    <select id="reportPeriod" class="p-2 border rounded mb-2">
                        <option value="3months" data-i18n="last3Months">Last 3 Months</option>
                        <option value="all" data-i18n="allTime">All Time</option>
                    </select>
                    <select id="reportMetrics" class="p-2 border rounded mb-2" multiple>
                        <option value="affection" data-i18n="metricAffection">Affection Level</option>
                        <option value="support" data-i18n="metricSupport">Support Score</option>
                        <option value="finances" data-i18n="metricFinances">Financial Contributions</option>
                        <option value="conflict" data-i18n="metricConflict">Conflict Frequency</option>
                    </select>
                    <button id="generateReport" class="bg-blue-500 text-white px-4 py-2 rounded" data-i18n="generateReport">Generate Report</button>
                    <div id="reportPreview" class="mt-4"></div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modals -->
    <!-- Similar to original, with enhanced modal carousel -->

    <script>
        const relationshipData = {
            // Extended sample data with financial and conflict metrics
            weeks: [
                {
                    weekNumber: 1,
                    startDate: "2024-05-22",
                    contributions: {
                        affection: { salatiso: { score: 8, actions: ["Hugs"], notes: "" }, tee: { score: 7, actions: ["Kisses"], notes: "" } },
                        support: { salatiso: { score: 9, actions: ["Listening"], notes: "" }, tee: { score: 8, actions: ["Encouragement"], notes: "" } },
                        finances: { salatiso: { score: 10000, actions: ["Paid rent"], notes: "" }, tee: { score: 5000, actions: ["Groceries"], notes: "" } },
                        conflict: { salatiso: { score: 0, actions: [], notes: "" }, tee: { score: 0, actions: [], notes: "" } }
                    },
                    summaryKey: "week1Summary",
                    events: [
                        { type: "music", textKey: "sharedSong", songTitle: "Song 1", songUrl: "https://youtube.com", sharedBy: "Salatiso", originalMessage: "Loved this!", timestamp: "2024-05-22 13:32" }
                    ],
                    sentiment: "positive"
                },
                // Add more weeks with conflict data for April-May 2025
            ],
            // Other data as in original
        };

        // Initialize i18next (same as original)

        function initializeApp() {
            console.log('Initializing app...');
            populateAllSelects();
            setupEventListeners();
            renderOverviewSection();
            navigateToSection('overview');
        }

        function renderOverviewTimelineCarousel() {
            const carousel = document.getElementById('timelineCarousel');
            if (carousel) {
                carousel.innerHTML = relationshipData.weeks.map(week => `
                    <div class="carousel-item bg-blue-100 p-4 rounded w-72">
                        <h4>Week ${week.weekNumber} (${week.startDate})</h4>
                        <p data-i18n="${week.summaryKey}">${i18next.t(week.summaryKey)}</p>
                        <p>Events: ${week.events.length} (${week.sentiment})</p>
                        <div class="details-preview">${week.events.map(e => e.originalMessage).join('<br>')}</div>
                        <button class="details-button bg-blue-500 text-white px-2 py-1 rounded" data-week="${week.weekNumber}" data-i18n="seeDetails">See Details</button>
                    </div>
                `).join('');
            }
        }

        function generateReport() {
            const period = document.getElementById('reportPeriod').value;
            const metrics = Array.from(document.getElementById('reportMetrics').selectedOptions).map(opt => opt.value);
            const preview = document.getElementById('reportPreview');
            let reportHtml = '<h3>LifeSync Relationship Report</h3>';
            reportHtml += `<p>Period: ${period === '3months' ? 'Last 3 Months' : 'All Time'}</p>`;
            metrics.forEach(metric => {
                reportHtml += `<h4>${i18next.t(`metric${metric.charAt(0).toUpperCase() + metric.slice(1)}`)}</h4>`;
                reportHtml += `<canvas id="reportChart_${metric}"></canvas>`;
            });
            preview.innerHTML = reportHtml;
            metrics.forEach(metric => {
                const ctx = document.getElementById(`reportChart_${metric}`)?.getContext('2d');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: relationshipData.weeks.map(week => `Week ${week.weekNumber}`),
                            datasets: [
                                {
                                    label: `Salatiso - ${i18next.t(`metric${metric.charAt(0).toUpperCase() + metric.slice(1)}`)}`,
                                    data: relationshipData.weeks.map(week => week.contributions[metric]?.salatiso?.score || 0),
                                    borderColor: '#4B9CD3',
                                    fill: false
                                },
                                {
                                    label: `Tee - ${i18next.t(`metric${metric.charAt(0).toUpperCase() + metric.slice(1)}`)}`,
                                    data: relationshipData.weeks.map(week => week.contributions[metric]?.tee?.score || 0),
                                    borderColor: '#D4A017',
                                    fill: false
                                }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false }
                    });
                }
            });
        }

        // Other functions (renderOverviewImageCarousel, setupEventListeners, etc.) similar to original, with updated styles
    </script>
</body>
</html>
