<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="websiteTitle">Tee & Me - Our Story</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next@23.7.16/dist/umd/i18next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@7.2.0/dist/umd/i18nextBrowserLanguageDetector.min.js"></script>

    <style>
        /* Custom Styles V7 - Strict no-scroll, functional focus */
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; font-family: 'Inter', sans-serif; color: #374151; background-color: #e5e7eb; /* Light gray fallback */ }
        #videoBackground { position: fixed; right: 0; bottom: 0; min-width: 100%; min-height: 100%; width: auto; height: auto; z-index: -1000; background-size: cover; filter: blur(6px) brightness(0.5); object-fit: cover; }
        .main-container { display: flex; flex-direction: column; height: 100vh; width: 100vw; position: relative; z-index: 1; }
        
        header { background-color: rgba(255, 255, 255, 0.96); backdrop-filter: blur(12px); box-shadow: 0 2px 6px rgba(0,0,0,0.08); position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; }
        nav { background-color: rgba(255, 255, 255, 0.96); backdrop-filter: blur(12px); box-shadow: 0 2px 6px rgba(0,0,0,0.08); position: fixed; /* top will be set by JS */ left: 0; width: 100%; z-index: 999; }
        nav .container { overflow-x: auto; -ms-overflow-style: none; scrollbar-width: none; display: flex; justify-content: center; align-items: center; height: 100%; padding: 0 0.5rem; }
        nav .container::-webkit-scrollbar { display: none; }
        .nav-button { transition: all 0.25s ease; border-bottom: 3px solid transparent; white-space: nowrap; padding: 0.65rem 0.8rem; font-size: 0.875rem; font-weight: 500; cursor: pointer; color: #4b5563; }
        .nav-button.active-nav, .nav-button:hover { color: #a80038; /* Deeper Rose */ border-bottom-color: #a80038; }

        .content-area-wrapper { flex-grow: 1; display: flex; justify-content: center; align-items: center; padding-top: 0; /* JS will set this */ overflow: hidden; width: 100%; }
        .content-area { width: calc(100% - 1rem); max-width: 1700px; height: calc(100% - 1rem); margin: 0.5rem; background-color: rgba(254, 247, 247, 0.96); /* Very light rose, more opaque */ border-radius: 0.875rem; box-shadow: 0 18px 35px rgba(0,0,0,0.22); position: relative; overflow: hidden; display: flex; flex-direction: column; }
        
        .content-section { display: none; width: 100%; height: 100%; overflow: hidden; padding: 1rem 1.25rem; animation: fadeIn 0.45s ease-out; flex-direction: column; }
        .content-section.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0.5; transform: scale(0.99); } to { opacity: 1; transform: scale(1); } }

        .section-header { text-align: center; margin-bottom: 0.6rem; flex-shrink: 0; padding-top: 0.25rem; }
        .section-header h2 { font-size: 1.8rem; sm:font-size: 2rem; font-weight: 700; color: #881337; /* Darkest Rose */ }
        .section-content-wrapper { flex-grow: 1; overflow: hidden; display: flex; flex-direction: column; }
        
        .sub-nav-tabs { display: flex; justify-content: center; margin-bottom: 0.6rem; flex-shrink: 0; border-bottom: 1px solid #e5e7eb; }
        .sub-nav-tab { padding: 0.35rem 0.8rem; margin: 0 0.15rem; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; font-weight: 500; color: #4b5563; font-size: 0.8rem; }
        .sub-nav-tab.active-sub-nav, .sub-nav-tab:hover { color: #881337; border-bottom-color: #881337; }
        
        .sub-content { display: none; flex-grow: 1; overflow-y: auto; padding: 0.5rem; border-radius: 0.25rem; background-color: rgba(255,255,255,0.7); }
        .sub-content.active-sub-content { display: block; }

        .carousel-container { display: flex; overflow-x: auto; scroll-behavior: smooth; padding: 0.25rem 0 0.75rem 0; -webkit-overflow-scrolling: touch; flex-shrink: 0; }
        .carousel-item { flex: 0 0 auto; width: 270px; margin-right: 0.85rem; background-color: #ffffff; border-radius: 0.5rem; box-shadow: 0 2px 6px rgba(0,0,0,0.1); padding: 0.85rem; }
        
        .carousel-navigation-wrapper { position:relative; flex-shrink:0; }
        .carousel-nav-btn { background-color: rgba(255,255,255,0.85); border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.2); cursor: pointer; color: #881337; position: absolute; top: 50%; transform: translateY(-50%); z-index: 10;}
        
        .modal { /* ... existing modal styles ... */ }
        .modal-content { /* ... existing modal styles ... */ max-height: 85vh; }
        
        #playlistButton { /* ... existing playlist button styles ... */ }
        
        .overview-image-carousel .carousel-item { /* ... existing ... */ }
        #overviewImageCarouselContainer { /* ... existing ... */ }
        #overviewImageCarouselContainer img { /* ... existing ... */ }

        .action-button { background-color: #a80038; color: white; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.375rem; transition: background-color 0.2s ease, transform 0.1s ease; box-shadow: 0 2px 4px rgba(168, 0, 56, 0.2); cursor:pointer; }
        .action-button:hover { background-color: #881337; transform: translateY(-1px); }
        .input-field, .textarea-field, .select-field { border: 1px solid #ced4da; padding: 0.5rem 0.75rem; border-radius: 0.375rem; width: 100%; margin-bottom: 0.6rem; background-color: #fefeff; box-shadow: inset 0 1px 2px rgba(0,0,0,0.06); font-size: 0.875rem; }
        .table-wrapper { flex-grow: 1; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem;}
        .chart-container { position: relative; width:100%; height:100%; min-height: 180px; }
        .dashboard-metric-card { background-color: white; padding: 0.75rem; border-radius: 0.5rem; box-shadow: 0 2px 5px rgba(0,0,0,0.06); text-align: center; }
        .dashboard-metric-card h3 { color: #a80038; font-size: 0.85rem; margin-bottom: 0.25rem; font-weight: 500; }
        .dashboard-metric-card p { font-size: 1.5rem; color: #374151; }
        .relationship-action-form { background-color: rgba(255,255,255,0.8); padding: 0.85rem; border-radius: 0.5rem; box-shadow: 0 2px 6px rgba(0,0,0,0.08); margin-bottom: 0.85rem; }
        .relationship-action-form h4 { font-size: 1rem; color: #881337; margin-bottom: 0.6rem; font-weight: 600; }
    </style>
</head>
<body>
    <video autoplay muted loop playsinline id="videoBackground">
        <source src="assets/videos/our_moments_placeholder.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <div class="main-container" id="mainContainer">
        <header id="appHeader">
            <div class="container mx-auto px-4 sm:px-6 py-2 flex justify-between items-center">
                <h1 class="text-lg sm:text-xl font-bold text-rose-800" data-i18n="headerTitle"></h1>
                <div class="language-switcher">
                    <button id="lang-en" class="text-xs action-button !bg-rose-700 !px-2 !py-1 sm:!px-2.5 sm:!py-1.5">EN</button>
                    <button id="lang-xh" class="text-xs action-button !bg-rose-700 !px-2 !py-1 sm:!px-2.5 sm:!py-1.5">XH</button>
                </div>
            </div>
        </header>

        <nav id="appNav">
            <div class="container mx-auto px-1 sm:px-2 py-1.5 flex items-center">
                <button data-section="overview" class="nav-button active-nav" data-i18n="nav.overview"></button>
                <button data-section="analysisHub" class="nav-button" data-i18n="nav.analysisHub"></button>
                <button data-section="mediaTravelHub" class="nav-button" data-i18n="nav.mediaTravelHub"></button>
                <button data-section="connectResolve" class="nav-button" data-i18n="nav.connectResolve"></button>
                <button data-section="lifesyncFun" class="nav-button" data-i18n="nav.lifesyncFun"></button>
            </div>
        </nav>
        
        <div class="content-area-wrapper" id="contentAreaWrapper">
            <main class="content-area">
                <section id="overview" class="content-section active">
                    <div class="section-header"> <h2 data-i18n="overview.title"></h2> </div>
                    <div class="section-content-wrapper grid grid-cols-1 lg:grid-cols-5 gap-2.5 h-full">
                        <div class="lg:col-span-2 space-y-2.5 flex flex-col overflow-hidden p-0.5">
                            <div class="bg-white/85 p-2.5 rounded-lg shadow-md flex-shrink-0">
                                <h3 class="text-md font-semibold mb-1.5 text-center text-gray-700" data-i18n="overview.dashboardTitle"></h3>
                                <div class="grid grid-cols-2 gap-2 mb-1.5">
                                    <div class="dashboard-metric-card"> <h3 data-i18n="overview.affectionLevel"></h3> <p id="affection-metric">--</p> </div>
                                    <div class="dashboard-metric-card"> <h3 data-i18n="overview.supportScore"></h3> <p id="support-metric">--</p> </div>
                                    <div class="dashboard-metric-card"> <h3 data-i18n="overview.foodContribution"></h3> <p id="food-metric">--</p> </div>
                                    <div class="dashboard-metric-card"> <h3 data-i18n="overview.safetyFeeling"></h3> <p id="safety-metric">--</p> </div>
                                </div>
                            </div>
                            <div class="bg-white/85 p-2.5 rounded-lg shadow-md text-center flex-shrink-0">
                                <h3 class="text-md font-semibold mb-1 text-rose-700" data-i18n="overview.ourSong"></h3>
                                <p class="text-gray-600 mb-1 text-xs" id="specialSongTitle" data-i18n="overview.songName_shaggy"></p>
                                <a href="https://youtu.be/DOcCQ-kC4iE?si=DrJURhh0p86ce7yt" target="_blank" class="action-button !text-xs !py-1 !px-2"> <i class="fas fa-headphones-alt mr-1"></i> <span data-i18n="overview.listenToSong"></span> </a>
                            </div>
                             <div class="bg-white/85 p-2.5 rounded-lg shadow-md flex-grow overflow-hidden carousel-navigation-wrapper">
                                <h3 class="text-md font-semibold mb-1 text-center text-gray-700" data-i18n="overview.quickTimeline"></h3>
                                <div id="overviewTimelineCarousel" class="carousel-container h-[calc(100%-2rem)]"></div>
                                <button id="overview-timeline-prev" class="carousel-nav-btn prev !w-7 !h-7"><i class="fas fa-chevron-left text-xs"></i></button>
                                <button id="overview-timeline-next" class="carousel-nav-btn next !w-7 !h-7"><i class="fas fa-chevron-right text-xs"></i></button>
                            </div>
                        </div>
                        <div class="lg:col-span-3 flex flex-col space-y-2.5 overflow-hidden p-0.5">
                            <div id="overviewImageCarouselContainer" class="relative h-2/5 w-full rounded-lg shadow-lg overflow-hidden flex-shrink-0">
                                <div id="overviewImageCarousel" class="carousel-container overview-image-carousel h-full"></div>
                                <button id="overview-img-prev" class="carousel-nav-btn prev"><i class="fas fa-chevron-left"></i></button>
                                <button id="overview-img-next" class="carousel-nav-btn next"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="chart-container flex-grow !max-w-none !h-auto bg-white/85 p-2.5 rounded-lg shadow-md"> <canvas id="dashboardChart"></canvas> </div>
                        </div>
                    </div>
                </section>

                <section id="analysisHub" class="content-section">
                    <div class="section-header"> <h2 data-i18n="nav.analysisHub"></h2> </div>
                    <div class="sub-nav-tabs">
                        <button class="sub-nav-tab active-sub-nav" data-subtarget="analysis-tracking" data-i18n="analysisHub.tracking"></button>
                        <button class="sub-nav-tab" data-subtarget="analysis-contributions" data-i18n="analysisHub.contributions"></button>
                        <button class="sub-nav-tab" data-subtarget="analysis-reinforcement" data-i18n="analysisHub.reinforcement"></button>
                    </div>
                    <div class="section-content-wrapper">
                        <div id="analysis-tracking" class="sub-content active-sub-content flex flex-col items-center">
                            <div class="mb-2 text-center flex-shrink-0"> <label for="trackingMetricSelect" class="mr-1 font-medium text-gray-700 text-xs" data-i18n="tracking.selectAspect"></label> <select id="trackingMetricSelect" class="select-field w-auto inline-block !py-1 !text-xs"></select> </div>
                            <div class="chart-container w-full flex-grow !bg-white/85 !p-2"> <canvas id="trackingChart"></canvas> </div>
                        </div>
                        <div id="analysis-contributions" class="sub-content flex flex-col">
                            <div class="mb-2 text-center flex-shrink-0"> <label for="contributionFilterWeek" class="mr-1 font-medium text-gray-700 text-xs" data-i18n="contributions.filterWeek"></label> <select id="contributionFilterWeek" class="select-field w-auto inline-block !py-1 !text-xs"></select> </div>
                            <div class="table-wrapper bg-white/85 shadow-md rounded-lg flex-grow"> <table class="min-w-full divide-y divide-gray-200 contribution-table text-xs"> <thead class="sticky top-0 bg-rose-50/90 z-10"><tr> <th data-i18n="contributions.table.parameter"></th> <th data-i18n="contributions.table.salatiso"></th> <th data-i18n="contributions.table.tee"></th> <th data-i18n="contributions.table.details"></th> </tr></thead> <tbody id="contributionsTableBody"></tbody> </table> </div>
                        </div>
                        <div id="analysis-reinforcement" class="sub-content flex flex-col">
                            <div class="table-wrapper bg-white/85 shadow-md rounded-lg flex-grow"> <table class="min-w-full divide-y divide-gray-200 contribution-table text-xs"> <thead class="sticky top-0 bg-rose-50/90 z-10"><tr> <th data-i18n="reinforcement.table.wordAction"></th> <th data-i18n="reinforcement.table.purpose"></th> <th data-i18n="reinforcement.table.salatisoOccurrences"></th> <th data-i18n="reinforcement.table.teeOccurrences"></th> <th data-i18n="reinforcement.table.jointOccurrences"></th> </tr></thead> <tbody id="reinforcementTableBody"></tbody> </table> </div>
                        </div>
                    </div>
                </section>

                <section id="mediaTravelHub" class="content-section">
                     <div class="section-header"> <h2 data-i18n="nav.mediaTravelHub"></h2> </div>
                    <div class="sub-nav-tabs">
                        <button class="sub-nav-tab active-sub-nav" data-subtarget="media-songs" data-i18n="mediaGallery.sharedSongs"></button>
                        <button class="sub-nav-tab" data-subtarget="media-photos" data-i18n="mediaGallery.photoMoments"></button>
                        <button class="sub-nav-tab" data-subtarget="travel-visited" data-i18n="travel.visitedTitle"></button>
                        <button class="sub-nav-tab" data-subtarget="travel-desired" data-i18n="travel.desiredTitle"></button>
                    </div>
                    <div class="section-content-wrapper">
                        <div id="media-songs" class="sub-content active-sub-content"> <div id="songListContainer" class="max-h-full overflow-y-auto pr-1 bg-white/85 p-2.5 rounded-lg shadow"></div> </div>
                        <div id="media-photos" class="sub-content"> <p class="text-xs text-gray-500 mb-1.5 text-center" data-i18n="mediaGallery.photoNote"></p> <div id="photoGalleryContainer" class="media-gallery-grid max-h-full overflow-y-auto p-0.5"></div> </div>
                        <div id="travel-visited" class="sub-content"> <div id="visitedPlacesContainer" class="space-y-3 max-h-full overflow-y-auto p-0.5"></div> </div>
                        <div id="travel-desired" class="sub-content"> <div id="desiredPlacesContainer" class="space-y-3 max-h-full overflow-y-auto p-0.5"></div> </div>
                    </div>
                </section>

                <section id="connectResolve" class="content-section">
                    <div class="section-header"> <h2 data-i18n="nav.connectResolve"></h2> </div>
                    <div class="sub-nav-tabs">
                        <button class="sub-nav-tab active-sub-nav" data-subtarget="connect-feedback" data-i18n="feedback.title"></button>
                        <button class="sub-nav-tab" data-subtarget="connect-actions" data-i18n="relationshipActions.titleShort"></button>
                        <button class="sub-nav-tab" data-subtarget="connect-logs" data-i18n="relationshipActions.logTitle"></button>
                    </div>
                    <div class="section-content-wrapper">
                        <div id="connect-feedback" class="sub-content active-sub-content grid grid-cols-1 md:grid-cols-2 gap-3 overflow-y-auto">
                            <div class="bg-white/85 p-3 rounded-lg shadow-md"> <h3 class="text-md font-semibold text-gray-700 mb-2" data-i18n="feedback.giveFeedback"></h3> <div> <label for="feedbackSender" class="block text-xs font-medium text-gray-700" data-i18n="feedback.sender"></label> <select id="feedbackSender" class="select-field !text-xs !py-1"></select> </div> <div> <label for="feedbackRecipient" class="block text-xs font-medium text-gray-700" data-i18n="feedback.recipient"></label> <select id="feedbackRecipient" class="select-field !text-xs !py-1"></select> </div> <div> <label for="feedbackMessage" class="block text-xs font-medium text-gray-700" data-i18n="feedback.message"></label> <textarea id="feedbackMessage" rows="2" class="textarea-field !text-xs"></textarea> </div> <button id="sendFeedbackBtn" class="action-button mt-1 w-full !text-xs !py-1.5" data-i18n="feedback.sendButton"></button> </div>
                            <div class="bg-white/85 p-3 rounded-lg shadow-md flex flex-col"> <h3 class="text-md font-semibold text-gray-700 mb-2 flex-shrink-0" data-i18n="feedback.receivedFeedback"></h3> <div id="feedbackLogContainer" class="flex-grow overflow-y-auto pr-0.5 text-xs"></div> </div>
                        </div>
                        <div id="connect-actions" class="sub-content grid grid-cols-1 md:grid-cols-2 gap-x-3 gap-y-2.5 overflow-y-auto p-1">
                            <div class="relationship-action-form"> <h4 data-i18n="relationshipActions.apology.title"></h4> <select id="apologyFrom" class="select-field !text-xs !py-1 mb-1"></select> <textarea id="apologyMessage" class="textarea-field !min-h-[40px] !text-xs" data-i18n-placeholder="relationshipActions.apology.messagePlaceholder"></textarea> <button id="sendApologyBtn" class="action-button mt-0.5 w-full !text-xs !py-1" data-i18n="relationshipActions.apology.sendButton"></button> </div>
                            <div class="relationship-action-form"> <h4 data-i18n="relationshipActions.dissatisfaction.title"></h4> <select id="dissatisfactionFrom" class="select-field !text-xs !py-1 mb-1"></select> <textarea id="dissatisfactionMessage" class="textarea-field !min-h-[40px] !text-xs" data-i18n-placeholder="relationshipActions.dissatisfaction.messagePlaceholder"></textarea> <button id="sendDissatisfactionBtn" class="action-button mt-0.5 w-full !text-xs !py-1" data-i18n="relationshipActions.dissatisfaction.sendButton"></button> </div>
                            <div class="relationship-action-form"> <h4 data-i18n="relationshipActions.bookDate.title"></h4> <select id="dateBooker" class="select-field !text-xs !py-1 mb-1"></select> <input type="text" id="dateActivity" class="input-field !text-xs" data-i18n-placeholder="relationshipActions.bookDate.activityPlaceholder"> <input type="date" id="dateProposedDate" class="input-field !text-xs"> <button id="proposeDateBtn" class="action-button mt-0.5 w-full !text-xs !py-1" data-i18n="relationshipActions.bookDate.proposeButton"></button> </div>
                            <div class="relationship-action-form border-red-400 border"> <h4 class="!text-red-600" data-i18n="relationshipActions.terminate.title"></h4> <select id="terminator" class="select-field !text-xs !py-1 mb-1"></select> <label for="terminationReason" class="block text-xs font-medium text-gray-700" data-i18n="relationshipActions.terminate.reason"></label> <select id="terminationReason" class="select-field !text-xs !py-1 mb-1"></select> <textarea id="terminationOtherReason" class="textarea-field !min-h-[30px] !text-xs" data-i18n-placeholder="relationshipActions.terminate.otherReasonPlaceholder"></textarea> <button id="initiateTerminationBtn" class="action-button bg-red-600 hover:bg-red-700 mt-0.5 w-full !text-xs !py-1" data-i18n="relationshipActions.terminate.initiateButton"></button> </div>
                        </div>
                         <div id="connect-logs" class="sub-content bg-white/85 p-2.5 rounded-lg shadow-md"> <h3 class="text-md font-semibold text-gray-700 mb-1.5" data-i18n="relationshipActions.logTitleShort"></h3> <div id="relationshipActionLogContainer" class="max-h-full overflow-y-auto pr-0.5 text-xs"></div> </div>
                    </div>
                </section>

                <section id="lifesyncFun" class="content-section">
                    <div class="section-header"> <h2 data-i18n="nav.lifesyncFun"></h2> </div>
                    <div class="sub-nav-tabs">
                        <button class="sub-nav-tab active-sub-nav" data-subtarget="fun-compatibility" data-i18n="lifesyncFun.compatibility"></button>
                        <button class="sub-nav-tab" data-subtarget="fun-quizzes" data-i18n="funtools.quizzes.title"></button>
                        <button class="sub-nav-tab" data-subtarget="lifesync-reports" data-i18n="lifesync.title"></button>
                    </div>
                    <div class="section-content-wrapper">
                        <div id="fun-compatibility" class="sub-content active-sub-content overflow-y-auto p-1.5">
                            <div class="bg-white/85 p-3 rounded-lg shadow-md mb-3">
                                <h3 class="text-md font-semibold text-gray-700 mb-2" data-i18n="funtools.astrology.title"></h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2"> <div><label for="salatisoBday" class="block text-xs font-medium text-gray-700" data-i18n="funtools.astrology.salatisoBday"></label><input type="date" id="salatisoBday" value="1982-09-16" class="input-field !text-xs"></div> <div><label for="teeBday" class="block text-xs font-medium text-gray-700" data-i18n="funtools.astrology.teeBday"></label><input type="date" id="teeBday" value="1990-05-05" class="input-field !text-xs"></div> </div>
                                <button id="checkAstrologyBtn" class="action-button block mx-auto mb-1.5 !text-xs !py-1" data-i18n="funtools.astrology.checkButton"></button>
                                <div id="astrologyResult" class="p-2 bg-rose-50/70 rounded text-gray-700 min-h-[25px] text-xs"></div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <div class="bg-white/85 p-2.5 rounded-lg shadow-md text-center"> <h4 class="text-sm font-semibold text-gray-700 mb-1" data-i18n="compatibilityTests.values.title"></h4> <p class="text-xs text-gray-500 mb-1.5" data-i18n="compatibilityTests.values.description"></p> <button class="action-button secondary-button !text-xs !py-0.5 compatibility-test-btn" data-test="values" data-i18n="compatibilityTests.startTest"></button> </div>
                                <div class="bg-white/85 p-2.5 rounded-lg shadow-md text-center"> <h4 class="text-sm font-semibold text-gray-700 mb-1" data-i18n="compatibilityTests.communication.title"></h4> <p class="text-xs text-gray-500 mb-1.5" data-i18n="compatibilityTests.communication.description"></p> <button class="action-button secondary-button !text-xs !py-0.5 compatibility-test-btn" data-test="communication" data-i18n="compatibilityTests.startTest"></button> </div>
                                <div class="bg-white/85 p-2.5 rounded-lg shadow-md text-center"> <h4 class="text-sm font-semibold text-gray-700 mb-1" data-i18n="compatibilityTests.proverbs.title"></h4> <p class="text-xs text-gray-500 mb-1.5" data-i18n="compatibilityTests.proverbs.description"></p> <button class="action-button secondary-button !text-xs !py-0.5 compatibility-test-btn" data-test="proverbs" data-i18n="compatibilityTests.startTest"></button> </div>
                            </div>
                        </div>
                        <div id="fun-quizzes" class="sub-content text-center"> <h3 class="text-md font-semibold text-gray-700 mb-1.5" data-i18n="funtools.quizzes.title"></h3> <p class="text-gray-600 text-sm" data-i18n="funtools.quizzes.placeholder"></p> </div>
                        <div id="lifesync-reports" class="sub-content text-center"> <h3 class="text-md font-semibold text-gray-700 mb-1.5" data-i18n="lifesync.reportGen"></h3> <div class="inline-flex items-center space-x-1.5"> <select id="lifesyncPeriodSelect" class="select-field w-auto !py-1 !text-xs"></select> <button class="action-button !py-1.5 !text-xs" data-i18n="lifesync.generateButton" id="generateReportBtn"></button> </div> <p class="mt-2 text-xs text-gray-600" data-i18n="lifesync.reportNote"></p> </div>
                    </div>
                </section>
            </main>
        </div>

        <footer class="bg-white/95 border-t border-gray-200/80 z-30 py-2 fixed bottom-0 left-0 w-full">
            <div class="container mx-auto px-6 text-center text-gray-500 text-xs">
                <p>© <span id="currentYear"></span> <span data-i18n="footer.text"></span></p>
            </div>
        </footer>
    </div>

    <div id="detailsModal" class="modal"> <div class="modal-content"> <span class="close-button" id="closeModalButton">×</span> <h3 id="modalTitle" class="text-xl font-semibold mb-4 text-rose-600"></h3> <div id="modalBody" class="text-gray-700"> <div class="relative"> <button id="modal-carousel-prev" class="carousel-nav-btn prev !left-[-15px] !w-8 !h-8"><i class="fas fa-chevron-left text-sm"></i></button> <div id="modalCarouselContainer" class="carousel-container messages-carousel max-h-[65vh] overflow-y-auto"></div> <button id="modal-carousel-next" class="carousel-nav-btn next !right-[-15px] !w-8 !h-8"><i class="fas fa-chevron-right text-sm"></i></button> </div> </div> </div> </div>
    <div id="customAlertModal" class="modal"> <div class="modal-content !max-w-sm text-center"> <span class="close-button" id="customAlertCloseButton">×</span> <h3 id="customAlertTitle" class="text-lg font-semibold mb-3 text-rose-600"></h3> <p id="customAlertMessage" class="text-gray-700 mb-4 text-sm"></p> <button id="customAlertOkButton" class="action-button mt-2 mx-auto !text-sm !px-4 !py-1.5">OK</button> </div> </div>
    <div id="playlistModal" class="modal"> <div class="modal-content"> <span class="close-button" id="closePlaylistModal">×</span> <h3 class="text-xl font-semibold mb-3 text-rose-600" data-i18n="playlist.title"></h3> <div class="aspect-w-16 aspect-h-9"> <iframe id="playlistFrame" width="100%" height="315" frameborder="0" allowfullscreen allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe> </div> <p class="mt-2 text-xs text-gray-500" data-i18n="playlist.note"></p> </div> </div>
    <button id="playlistButton" title="Our Playlist"> <i class="fas fa-music text-lg"></i> </button>

    <script src="xh_translations.js"></script>
    <script>
        // --- Global State & Config ---
        const APP_VERSION = "v7.0.0";
        let currentSection = 'overview';
        let currentSubTargets = {}; 
        let dashboardChart, trackingChart;
        let overviewImageCarouselIndex = 0;
        let overviewImageInterval;
        let currentModalCarouselIndex = 0; 
        let modalCarouselItems = [];

        // --- i18next Configuration ---
        const translations = {
            en: {
                translation: { 
                    websiteTitle: "Tee & Me - Our Story", headerTitle: "Tee & Me",
                    nav: { overview: "Overview", analysisHub: "Analysis Hub", mediaTravelHub: "Media & Travel", connectResolve: "Connect & Resolve", lifesyncFun: "LifeSync & Fun" },
                    overview: { title: "Our Journey Snapshot", dashboardTitle: "Dashboard", affectionLevel: "Affection", supportScore: "Support", foodContribution: "Food Prep", safetyFeeling: "Safety", ourSong: "Our Song", songName_shaggy: "\"Thank You Baby! (For Makin' Someday Come So Soon)\"", listenToSong: "Listen", quickTimeline: "Quick Timeline" },
                    analysisHub: { tracking: "Tracking", contributions: "Contributions", reinforcement: "Reinforcement" },
                    tracking: { selectAspect: "Track:", affectionLevel: "Affection", supportScore: "Support", communicationFrequency: "Communication", foodContribution: "Food Prep", safetyFeeling: "Safety Score", financialTeamwork: "Finances", feedbackResponseTime: "Feedback Response", noResponseData: "No response data" },
                    contributions: { filterWeek: "Week:", table: { parameter: "Parameter", salatiso: "Salatiso", tee: "Tee", details: "Details" }, params: { food: "Food", safety: "Safety", chores: "Chores", planning: "Planning", finances: "Finances", affection: "Affection", support: "Support", communication: "Communication" }, aggregationNote: "(Aggregated reports via LifeSync - Placeholder)", noDataForWeek: "No data for this week.", noneReported: "N/A" },
                    reinforcement: { table: { wordAction: "Word/Action", purpose: "Purpose", salatisoOccurrences: "Salatiso (Wks)", teeOccurrences: "Tee (Wks)", jointOccurrences: "Joint (Wks)"}, words: { safe: "'I'm safe'", loveYou: "'I love you'", helpRequest: "Help Request" }, purpose: { reassurance: "Reassurance", affection: "Affection", supportSeeking: "Support" }},
                    mediaGallery: { sharedSongs: "Shared Songs", photoMoments: "Photo Moments", photoNote: "(Photos from assets/photos/)", noSongs: "No songs logged.", noPhotos: "No photos in assets." },
                    travel: { visitedTitle: "Visited", desiredTitle: "Dream Trips", rolesTitle: "Roles:", highlightsTitle: "Highlights:", noVisited: "No past travels.", noDesired: "No dream trips yet." },
                    connectResolve: {}, 
                    relationshipActions: { titleShort: "Actions", logTitleShort: "Actions Log", title: "Connect & Resolve", salatiso: "Salatiso", tee: "Tee", apology: { title: "Make an Apology", from: "From:", messagePlaceholder: "Your heartfelt apology...", sendButton: "Send Apology", success: "Apology sent." }, dissatisfaction: { title: "Express Dissatisfaction", from: "From:", messagePlaceholder: "Describe your dissatisfaction...", sendButton: "Log Dissatisfaction", success: "Dissatisfaction logged." }, bookDate: { title: "Book a Date", booker: "Booked by:", activityPlaceholder: "E.g., Dinner at [Restaurant]", proposeButton: "Propose Date", success: "Date proposal logged." }, terminate: { title: "Initiate Termination", terminator: "Initiated by:", reason: "Reason:", reasons: { irreconcilable: "Irreconcilable Differences", communication: "Communication Breakdown", paths: "Different Life Paths", other: "Other" }, otherReasonPlaceholder: "Specify other reason...", initiateButton: "Initiate Termination", success: "Termination initiated.", confirmMessage: "Are you sure you want to initiate termination?", specifyOther: "Please specify 'Other' reason." }, logTitle: "Relationship Actions Log", actionBy: "Action by {actor}", actionType: "Type: {type}", actionDetails: "Details: {details}", noActionsYet: "No actions logged." },
                    lifesyncFun: { compatibility: "Compatibility Checks" },
                    funtools: { quizzes: { title: "Quizzes", placeholder:"Relationship quizzes coming soon!" }, astrology: { title: "Astrology", salatisoBday: "Salatiso's Bday:", teeBday: "Tee's Bday:", checkButton: "Check", invalidDate: "Invalid dates.", salatisoIsA: "Salatiso:", teeIsA: "Tee:", virgoTaurus: "Virgo & Taurus: Earthy & Stable!", general: "Explore your unique dynamic!" } },
                    compatibilityTests: { startTest: "Start Test", values: { title: "Values Alignment", description: "Align your core values." }, communication: { title: "Communication Styles", description: "Understand communication." }, proverbs: { title: "African Proverbs Wisdom", description: "Wisdom from proverbs." }, comingSoon: "Test coming soon!" },
                    lifesync: { title: "LifeSync", reportGen: "Generate Report", last3Months: "Last 3 Months", last6Months: "Last 6 Months", lastYear: "Last Year", allTime: "All Time", generateButton: "Generate", reportNote: "(Report generation is a placeholder.)" },
                    insights: { title: "Insights" }, 
                    feedback: { title: "Feedback", giveFeedback: "Give Feedback", sender: "Sender:", recipient: "Recipient:", tee: "Tee", salatiso: "Salatiso", message: "Message:", sendButton: "Send", receivedFeedback: "Received / Log", feedbackFrom: "From {sender}", respondedIn: "Responded: {duration}", pendingResponse: "Pending", markAsRead: "Acknowledge", messageEmpty: "Message empty.", success: "Feedback sent.", senderRecipientSame: "Sender/recipient same.", noFeedbackYet: "No feedback yet." },
                    footer: { text: "Tee & Me. A digital chronicle of our love." },
                    modal: { detailsTitle: "Details for Week {weekNumber}" },
                    alert: { defaultTitle: "Notification", actionLogged: "Action Logged", fillAllFields: "Please fill fields.", messageEmpty: "Message empty." },
                    playlist: { title: "Our Playlist", note: "If embed fails, opens in new tab." }
                }
            },
            xh: { translation: typeof xhosaTranslations !== 'undefined' ? xhosaTranslations : {} }
        };
        
        // --- Data (User to populate this extensively) ---
        const relationshipData = {
            playlistUrl: "https://music.youtube.com/playlist?list=PLXPU1hLJ2t0MZKrDGjGxk7vNlVeh9pX0C&si=ZPqinjcSRBsq8FZZ", 
            photoFileNames: ["placeholder1.jpg", "placeholder2.jpg", "placeholder3.jpg", "placeholder4.jpg", "placeholder5.jpg", "placeholder6.jpg", "placeholder7.jpg"], // User to populate assets/photos/
            weeks: [ 
                { weekNumber: 1, startDate: "2024-05-20", contributions: { affection: { salatiso: 7, tee: 8, notes: "Warm initial interactions."}, food: {salatisoActions:["Groceries (R300)"], teeActions:["Cooked Mon, Wed"], score:7, notes:"Good start"}, safety: {salatisoActions:["Locked up"], teeActions:["Checked stove"], score:9}, finances:{salatiso:300, tee:50, category:"Household"}}, summaryKey: "timeline.week1.summary", events: [{type:"music", songTitle:"Thank You Baby!", artist:"Shaggy", songUrl:"https://youtu.be/DOcCQ-kC4iE?si=DrJURhh0p86ce7yt", sharedBy:"Salatiso", textKey: "timeline.sharedThankYouBaby"}]},
                { weekNumber: 2, startDate: "2024-05-27", contributions: { affection: { salatiso: 8, tee: 7}, support:{salatiso:9, tee:8, notes:"Support during work stress"}}, summaryKey: "timeline.week2.summary", events: [{type:"event", textKey:"timeline.week2.event1"}]}
            ],
            reinforcementWords: [ { wordActionKey: "reinforcement.words.safe", purposeKey: "reinforcement.purpose.reassurance", occurrences: { salatiso: [1], tee: [1,2], joint: [] } } ], 
            insightsData: [ { weekNumber: 1, affectionDetailKey: "insights.week1.affection", intimacyDetailKey: "insights.week1.intimacy" } ], 
            feedbackLog: [ { id: 1, sender: "Salatiso", recipient: "Tee", message: "Appreciated you making coffee!", timestamp: new Date(2024, 5, 1, 10, 0, 0).toISOString(), response: null, responseTimestamp: null } ], 
            actionLog: [ { id: 1, type: "apology", actor: "Salatiso", target: "Tee", message: "Sorry for being late.", timestamp: new Date(2024, 5, 3, 10, 0, 0).toISOString(), details: {} } ], 
            travelLog: [ { id: 1, type: "visited", destinationKey: "travel.dest.durban", dates: "2024-07-10 to 2024-07-15", roles: { salatisoKey: "travel.roles.durban.salatiso", teeKey: "travel.roles.durban.tee" }, highlightsKey: "travel.durban.highlights", photos: ["placeholder1.jpg", "placeholder2.jpg"] } ]
        };
         // Add example i18n keys for data from relationshipData
        translations.en.translation.timeline.week1 = { summary: "Beginning of documented journey, group creation and early planning.", event1: "Salatiso created group 'Us'."};
        translations.en.translation.timeline.week2 = { summary: "Settling in, supporting each other through work.", event1: "Tee offered great support during a stressful work week for Salatiso."};
        translations.en.translation.timeline.sharedThankYouBaby = "Salatiso shared the special song 'Thank You Baby!'.";
        translations.en.translation.insights.week1 = { affection: "Affection shown through kind words and gestures.", intimacy: "Opened up about future hopes."};


        // --- App Initialization ---
        function initializeApp() {
            console.log(`App Initializing ${APP_VERSION}...`);
            i18next.use(i18nextBrowserLanguageDetector).init({
                debug: false, fallbackLng: 'en', resources: translations
            }, (err, t) => {
                if (err) { console.error("i18next initialization error:", err); return; }
                
                populateAllSelects();
                updateNavStickiness();
                setupEventListeners();
                navigateToSection('overview'); 
                updateContentAll(); 
                document.getElementById('currentYear').textContent = new Date().getFullYear();
                console.log("App Initialized & Ready.");
            });
        }

        function populateAllSelects() {
            const overviewMetrics = { affection: "overview.affectionLevel", support: "overview.supportScore", communication: "tracking.communicationFrequency", food: "overview.foodContribution", safety: "overview.safetyFeeling", finances: "overview.financialTeamwork" };
            const trackingMetrics = { ...overviewMetrics, feedback_response: "tracking.feedbackResponseTime" };
            const nameOptions = { Salatiso: "relationshipActions.salatiso", Tee: "relationshipActions.tee" };
            const lifesyncPeriods = { last3Months: "lifesync.last3Months", last6Months: "lifesync.last6Months", lastYear: "lifesync.lastYear", allTime: "lifesync.allTime" };

            populateSelectWithOptions('dashboardMetricSelect', overviewMetrics);
            populateSelectWithOptions('trackingMetricSelect', trackingMetrics);
            populateSelectWithOptions('apologyFrom', nameOptions);
            populateSelectWithOptions('dissatisfactionFrom', nameOptions);
            populateSelectWithOptions('dateBooker', nameOptions);
            populateSelectWithOptions('terminator', nameOptions);
            populateSelectWithOptions('feedbackSender', nameOptions);
            populateSelectWithOptions('feedbackRecipient', nameOptions);
            populateSelectWithOptions('lifesyncPeriodSelect', lifesyncPeriods);
        
            const termReasonSelect = document.getElementById('terminationReason');
            if(termReasonSelect && translations.en.translation.relationshipActions?.terminate?.reasons) {
                const terminationReasonsData = translations.en.translation.relationshipActions.terminate.reasons;
                Object.keys(terminationReasonsData).forEach(key => {
                    const option = document.createElement('option'); option.value = key;
                    option.dataset.i18n = `relationshipActions.terminate.reasons.${key}`; termReasonSelect.appendChild(option);
                });
            }
        }

        function populateSelectWithOptions(selectId, optionsObject) {
            const selectElement = document.getElementById(selectId);
            if (!selectElement) { console.warn("Select element not found for ID:", selectId); return; }
            selectElement.innerHTML = ''; 
            Object.entries(optionsObject).forEach(([value, i18nKey]) => {
                const option = document.createElement('option'); option.value = value; 
                option.dataset.i18n = i18nKey; selectElement.appendChild(option);
            });
        }
        
        function updateNavStickiness() {
            const header = document.getElementById('appHeader');
            const nav = document.getElementById('appNav');
            const contentWrapper = document.getElementById('contentAreaWrapper');
            if (header && nav && contentWrapper) {
                const headerHeight = header.offsetHeight;
                nav.style.top = `${headerHeight}px`;
                contentWrapper.style.paddingTop = `${headerHeight + nav.offsetHeight}px`;
            }
        }

        // --- Navigation & Content Switching ---
        function navigateToSection(sectionId) {
            console.log("Navigating to section:", sectionId);
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            const targetSection = document.getElementById(sectionId);
            if (targetSection) { targetSection.classList.add('active'); }
            else { console.error("Target section not found:", sectionId); return; }

            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.toggle('active-nav', btn.dataset.section === sectionId));
            currentSection = sectionId;

            const firstSubNav = targetSection.querySelector('.sub-nav-tab');
            if (firstSubNav) {
                navigateToSubSection(sectionId, firstSubNav.dataset.subtarget);
            } else { // If no sub-nav, directly render main section content
                renderActiveSectionContent();
            }
            updateContentAll(); 
        }

        function navigateToSubSection(mainSectionId, subTargetId) {
            console.log(`Navigating to sub-section: ${mainSectionId} -> ${subTargetId}`);
            const mainSectionEl = document.getElementById(mainSectionId);
            if(!mainSectionEl) return;

            mainSectionEl.querySelectorAll('.sub-content').forEach(sc => sc.classList.remove('active-sub-content'));
            const targetSubContent = document.getElementById(subTargetId);
            if (targetSubContent) { targetSubContent.classList.add('active-sub-content'); }
            else { console.error("Target sub-content not found:", subTargetId); return; }

            mainSectionEl.querySelectorAll('.sub-nav-tab').forEach(tab => tab.classList.toggle('active-sub-nav', tab.dataset.subtarget === subTargetId));
            currentSubTargets[mainSectionId] = subTargetId;
            
            renderActiveSectionContent(); // Render content based on new active sub-section
        }
        
        function renderActiveSectionContent() {
            // This function decides what to render based on currentSection and currentSubTargets
            console.log(`Rendering content for: ${currentSection}, sub-target: ${currentSubTargets[currentSection]}`);
            if (currentSection === 'overview') renderOverviewSection();
            else if (currentSection === 'analysisHub') {
                const activeSub = currentSubTargets[currentSection] || 'analysis-tracking';
                if (activeSub === 'analysis-tracking') updateTrackingChart(document.getElementById('trackingMetricSelect')?.value || 'affection');
                else if (activeSub === 'analysis-contributions') renderContributionsTable(document.getElementById('contributionFilterWeek')?.value || relationshipData.weeks[0]?.weekNumber.toString());
                else if (activeSub === 'analysis-reinforcement') renderReinforcementTable();
            }
            else if (currentSection === 'mediaTravelHub') {
                const activeSub = currentSubTargets[currentSection] || 'media-songs';
                if (activeSub === 'media-songs') renderMediaGallery(); // renderMediaGallery handles both songs and photos initially if desired, or split
                else if (activeSub === 'media-photos') renderMediaGallery(); // Or specific photo render
                else if (activeSub === 'travel-visited') renderTravelSection();
                else if (activeSub === 'travel-desired') renderTravelSection(); // renderTravelSection can handle both
            }
             else if (currentSection === 'connectResolve') {
                const activeSub = currentSubTargets[currentSection] || 'connect-feedback';
                if (activeSub === 'connect-feedback') renderFeedbackLog();
                else if (activeSub === 'connect-actions') { /* Forms are static, log might need render */ renderRelationshipActionLog(); }
                else if (activeSub === 'connect-logs') renderRelationshipActionLog();
            }
            else if (currentSection === 'lifesyncFun') {
                const activeSub = currentSubTargets[currentSection] || 'fun-compatibility';
                if (activeSub === 'fun-compatibility') { /* Astrology result is dynamic, others static for now */ }
                // Other sub-tabs in lifesyncFun are mostly static placeholders
            }
        }
        
        // --- Specific Render Functions (ensure these are robust and complete) ---
        function renderOverviewSection() { renderOverviewImageCarousel(); updateDashboardMetrics(); updateDashboardChart(document.getElementById('dashboardMetricSelect')?.value || 'affection'); renderOverviewTimelineCarousel(); }
        function renderOverviewTimelineCarousel() { /* ... (V5 version, ensure DOM elements are found) ... */ }
        function renderOverviewImageCarousel() { /* ... (V5 version, ensure DOM elements are found) ... */ }
        function showOverviewImage(index) { /* ... (V5 version) ... */ }
        function nextOverviewImage() { /* ... (V5 version) ... */ }
        function prevOverviewImage() { /* ... (V5 version) ... */ }
        function shuffleArray(array) { return array.sort(() => Math.random() - 0.5); }
        
        function addSeeDetailsListeners() { 
            document.querySelectorAll('.see-details-btn').forEach(button => {
                button.removeEventListener('click', handleSeeDetailsClick); 
                button.addEventListener('click', handleSeeDetailsClick); 
            });
        }
        function handleSeeDetailsClick() { /* ... (V5 version, ensure robustness) ... */ }
        function renderModalCarousel() { /* ... (V5 version, ensure robustness) ... */ }
        function renderReinforcementTable() { /* ... (V5 version, ensure robustness) ... */ }
        function renderContributionsTable(weekNumStr) { 
             const contributionsTableBodyEl = document.getElementById('contributionsTableBody');
             if(!contributionsTableBodyEl) return;
             contributionsTableBodyEl.innerHTML = '';
             const weekNumber = parseInt(weekNumStr);
             const weekData = relationshipData.weeks.find(w => w.weekNumber === weekNumber);

            if (!weekData || !weekData.contributions) {
                contributionsTableBodyEl.innerHTML = `<tr><td colspan="4" class="text-center py-3 text-xs">${i18next.t("contributions.noDataForWeek")}</td></tr>`;
                return;
            }
            const contrib = weekData.contributions;
            const parametersToDisplay = ['affection', 'support', 'communication', 'food', 'safety', 'finances', 'chores', 'planning'];

            parametersToDisplay.forEach(paramKey => {
                const paramData = contrib[paramKey];
                if (paramData) {
                    const row = contributionsTableBodyEl.insertRow();
                    let salatisoInput = '-', teeInput = '-', details = paramData.notes || paramData.feeling || '';
                    
                    if (typeof paramData.salatiso === 'number' && typeof paramData.tee === 'number') { 
                        salatisoInput = paramData.salatiso; teeInput = paramData.tee;
                        details += ` (Avg: ${((paramData.salatiso + paramData.tee)/2).toFixed(1)})`;
                    } else if (paramData.salatisoActions || paramData.teeActions) { 
                        salatisoInput = (paramData.salatisoActions || []).join(',<br>') || '-';
                        teeInput = (paramData.teeActions || []).join(',<br>') || '-';
                        if(paramData.score !== undefined) details += ` (Score: ${paramData.score})`;
                    } else if (paramKey === 'finances' && typeof paramData.salatiso === 'number' && typeof paramData.tee === 'number') {
                        salatisoInput = `R ${paramData.salatiso || 0}`; teeInput = `R ${paramData.tee || 0}`;
                        details = `${paramData.category || ''} ${details}`;
                    }

                    row.innerHTML = `
                        <td class="py-2 px-3">${i18next.t(`contributions.params.${paramKey}`, {defaultValue: paramKey.charAt(0).toUpperCase() + paramKey.slice(1)})}</td>
                        <td class="py-2 px-3">${salatisoInput}</td>
                        <td class="py-2 px-3">${teeInput}</td>
                        <td class="py-2 px-3">${details || '-'}</td>
                    `;
                }
            });
        }
        function renderMediaGallery() { /* ... (V5 version, ensure robustness) ... */ }
        function renderTravelSection() { /* ... (V5 version, ensure robustness) ... */ }
        function renderFeedbackLog() { /* ... (V5 version, ensure robustness) ... */ }
        function renderRelationshipActionLog() { /* ... (V5 version, ensure robustness) ... */ }
        
        function updateDashboardMetrics() { /* ... (V5 version, ensure robustness) ... */ }
        function updateDashboardChart(metricKey = 'affection') { const el = document.getElementById('dashboardChart'); if(!el) return; const ctx = el.getContext('2d'); /* ... rest of V5 logic ... */ }
        function updateTrackingChart(metricKey = 'affection') { const el = document.getElementById('trackingChart'); if(!el) return; const ctx = el.getContext('2d'); /* ... rest of V5 logic ... */ }
        
        function getZodiacSign(date) { /* ... (V5 version) ... */ }
        function logRelationshipAction(type, actor, target, message, details = {}) { /* ... (V5 version) ... */ }
        function showAlert(message, title) { const modal = document.getElementById('customAlertModal'); const titleEl = document.getElementById('customAlertTitle'); const msgEl = document.getElementById('customAlertMessage'); if(modal && titleEl && msgEl){ titleEl.textContent = title || i18next.t("alert.defaultTitle"); msgEl.textContent = message; modal.style.display = "block"; } else { console.warn("Custom alert elements not found, falling back to browser alert."); alert(`${title || 'Alert'}: ${message}`);} }

        function setupEventListeners() {
            console.log("Setting up event listeners V6...");
            document.querySelectorAll('.nav-button').forEach(button => { button.removeEventListener('click', handleNavClick); button.addEventListener('click', handleNavClick); });
            document.querySelectorAll('.sub-nav-tab').forEach(tab => { tab.removeEventListener('click', handleSubNavClick); tab.addEventListener('click', handleSubNavClick); });

            // Modals
            document.getElementById('closeModalButton')?.addEventListener('click', () => { document.getElementById('detailsModal').style.display = 'none'; });
            document.getElementById('customAlertCloseButton')?.addEventListener('click', () => { document.getElementById('customAlertModal').style.display = 'none'; });
            document.getElementById('customAlertOkButton')?.addEventListener('click', () => { document.getElementById('customAlertModal').style.display = 'none'; });
            document.getElementById('closePlaylistModal')?.addEventListener('click', () => { document.getElementById('playlistModal').style.display = 'none'; });
            window.addEventListener('click', (event) => { 
                if (event.target == document.getElementById('detailsModal')) document.getElementById('detailsModal').style.display = 'none';
                if (event.target == document.getElementById('customAlertModal')) document.getElementById('customAlertModal').style.display = 'none';
                if (event.target == document.getElementById('playlistModal')) document.getElementById('playlistModal').style.display = 'none';
            });

            // Carousels
            document.getElementById('overview-img-prev')?.addEventListener('click', prevOverviewImage);
            document.getElementById('overview-img-next')?.addEventListener('click', nextOverviewImage);
            document.getElementById('overview-timeline-prev')?.addEventListener('click', () => { const c = document.getElementById('overviewTimelineCarousel'); if(c) c.scrollLeft -= 280; });
            document.getElementById('overview-timeline-next')?.addEventListener('click', () => { const c = document.getElementById('overviewTimelineCarousel'); if(c) c.scrollLeft += 280; });
            document.getElementById('modal-carousel-prev')?.addEventListener('click', () => { currentModalCarouselIndex = (currentModalCarouselIndex - 1 + modalCarouselItems.length) % modalCarouselItems.length; renderModalCarousel(); });
            document.getElementById('modal-carousel-next')?.addEventListener('click', () => { currentModalCarouselIndex = (currentModalCarouselIndex + 1) % modalCarouselItems.length; renderModalCarousel(); });

            // Selects
            document.getElementById('dashboardMetricSelect')?.addEventListener('change', (e) => updateDashboardChart(e.target.value));
            document.getElementById('trackingMetricSelect')?.addEventListener('change', (e) => updateTrackingChart(e.target.value));
            document.getElementById('contributionFilterWeek')?.addEventListener('change', (e) => renderContributionsTable(e.target.value));
            
            // Playlist
            document.getElementById('playlistButton')?.addEventListener('click', () => {
                const modal = document.getElementById('playlistModal'); const frame = document.getElementById('playlistFrame');
                if(modal && frame) {
                    let playlistId = relationshipData.playlistUrl.includes("list=") ? relationshipData.playlistUrl.split("list=")[1].split("&")[0] : relationshipData.playlistUrl.split('/').pop();
                    frame.src = `https://music.youtube.com/watch?v=zS-T8U5aYkQ&si=SqGPPtkmf9niHo9d${playlistId}&autoplay=1&modestbranding=1`;
                    modal.style.display = "block";
                }
            });

            // Fun Tools
            document.getElementById('checkAstrologyBtn')?.addEventListener('click', () => { /* ... V5 logic ... */ });
            document.querySelectorAll('.compatibility-test-btn').forEach(btn => {
                btn.addEventListener('click', () => showAlert(i18next.t("compatibilityTests.comingSoon")));
            });

            // Actions & Feedback
            document.getElementById('sendFeedbackBtn')?.addEventListener('click', () => { /* ... V5 logic ... */ });
            document.getElementById('sendApologyBtn')?.addEventListener('click', () => { /* ... V5 logic ... */ });
            document.getElementById('sendDissatisfactionBtn')?.addEventListener('click', () => { /* ... V5 logic ... */ });
            document.getElementById('proposeDateBtn')?.addEventListener('click', () => { /* ... V5 logic ... */ });
            document.getElementById('initiateTerminationBtn')?.addEventListener('click', () => { /* ... V5 logic ... */ });
            document.getElementById('generateReportBtn')?.addEventListener('click', () => showAlert(i18next.t("lifesync.reportNote")));
            
            // Language
            document.getElementById('lang-en')?.addEventListener('click', () => { i18next.changeLanguage('en', updateContentAll); });
            document.getElementById('lang-xh')?.addEventListener('click', () => { i18next.changeLanguage('xh', updateContentAll); });

            window.addEventListener('resize', updateNavStickiness);
            console.log("Event listeners setup complete V6.");
        }

        function handleNavClick() { navigateToSection(this.dataset.section); }
        function handleSubNavClick() {
            const mainSection = this.closest('.content-section')?.id;
            if(mainSection) navigateToSubSection(mainSection, this.dataset.subtarget);
        }
        
        function updateContentAll() {
            console.log("Updating all content with language:", i18next.language);
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const optionsAttr = el.getAttribute('data-i18n-options');
                let options = {};
                if (optionsAttr) { try { options = JSON.parse(optionsAttr); } catch (e) { console.warn(`Error parsing i18n options for ${key}:`, e); } }
                const translation = i18next.t(key, options);
                if (el.hasAttribute('data-i18n-placeholder')) { el.placeholder = translation; }
                else { el.innerHTML = translation; } 
            });
            renderActiveSectionContent(); // Re-render data-driven parts of the active section
            updateNavStickiness();
            console.log("Content update complete V6.");
        }

        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>
</body>
</html>
