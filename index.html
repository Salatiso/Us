<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="siteTitle">Tee & Me - Our Story</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script> <script src="https://unpkg.com/i18next@23.11.5/dist/umd/i18next.min.js"></script>
    <script src="https://unpkg.com/i18next-browser-languagedetector@7.1.0/dist/umd/i18nextBrowserLanguageDetector.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --bg-dark-purple: #301934;
            --bg-content-purple: rgba(45, 25, 55, 0.97);
            --bg-content-purple-opaque: rgb(45, 25, 55);
            --bg-card-purple: rgba(60, 30, 70, 0.92);
            --text-primary-light: #FDE7F3;
            --text-secondary-lavender: #E9D5FF;
            --accent-pink-vibrant: #DB2777;
            --accent-purple-medium: #A855F7;
            --accent-teal-bright: #2DD4BF;
            --border-color-lavender: rgba(168, 85, 247, 0.35);
            --border-color-strong: rgba(168, 85, 247, 0.65);
            --font-main: 'Poppins', sans-serif;
            --font-heading: 'Ubuntu', sans-serif;
        }

        body, html {
            height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: var(--font-main);
            background-color: var(--bg-dark-purple);
            color: var(--text-primary-light);
        }
        #videoBackground {
            position: fixed; right: 0; bottom: 0;
            min-width: 100%; min-height: 100%;
            width: auto; height: auto;
            z-index: -100;
            object-fit: cover;
            filter: brightness(0.25) contrast(1.1) blur(4px);
        }
        /* Removed .content-overlay from Tee & Me as LifeSync applies background to sections directly */

        header.main-header { /* Renamed for clarity */
            position: fixed; top: 0; left: 0; width: 100%;
            padding: 10px 30px;
            z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            background-color: rgba(30, 10, 40, 0.85); /* From LifeSync nav */
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color-lavender);
        }
        header.main-header .header-title { /* New class for title */
            font-size: 1.5rem; font-weight: 700; color: var(--accent-teal-bright);
            font-family: var(--font-heading);
            text-shadow: 0 0 8px var(--accent-teal-bright);
        }
        header.main-header .header-title i { margin-right: 8px; }

        header.main-header .lang-switcher {
            background: none; border: 1px solid var(--border-color-lavender); padding: 5px 10px;
            margin-left: 6px; cursor: pointer; font-size: 0.8rem;
            transition: all 0.3s ease;
            color: var(--text-secondary-lavender);
            border-radius: 18px;
        }
        header.main-header .lang-switcher:hover, header.main-header .lang-switcher.active-lang {
            background-color: var(--accent-pink-vibrant);
            color: var(--bg-dark-purple);
            border-color: var(--accent-pink-vibrant);
            text-shadow: none;
        }


        nav.main-nav {
            position: fixed;
            left: 0;
            width: 100%;
            z-index: 999;
            background-color: rgba(45, 25, 55, 0.9); /* Slightly different from header for depth */
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color-lavender);
        }
        nav.main-nav .nav-link {
            padding: 8px 14px; /* Increased padding */
            font-size: 0.9rem;
            color: var(--text-secondary-lavender);
            transition: color 0.3s ease, text-shadow 0.3s ease, border-bottom-color 0.3s ease;
            border-bottom: 2px solid transparent;
            font-family: var(--font-main);
        }
        nav.main-nav .nav-link:hover {
            color: var(--text-primary-light);
            text-shadow: 0 0 10px var(--accent-pink-vibrant);
        }
        nav.main-nav .nav-link.active-navlink { /* Updated active style */
            color: var(--accent-teal-bright);
            font-weight: 600;
            text-shadow: 0 0 8px rgba(45, 212, 191, 0.7); /* teal shadow */
            border-bottom-color: var(--accent-teal-bright);
        }


        .content-area-wrapper {
            width: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .content-area {
            flex-grow: 1;
            overflow: hidden;
            display: flex;
        }
        .content-section {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            overflow: hidden;
            padding: 1.5rem 2rem; /* Increased padding like LifeSync sections */
            background-color: var(--bg-content-purple); /* Applied LifeSync content background */
            /* border: 1px solid var(--border-color-lavender); Optional, might be too much with dark bg */
            color: var(--text-primary-light);
        }
        .content-section.active {
            display: flex;
            animation: fadeInSection 0.6s forwards;
        }
        @keyframes fadeInSection {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .sub-nav-tabs {
            border-bottom: 1px solid var(--border-color-strong); /* Stronger border */
            margin-bottom: 1.5rem;
        }
        .sub-nav-tab {
            padding: 0.75rem 1.25rem; /* Adjusted padding */
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -1px; /* Align with parent border more cleanly */
            color: var(--text-secondary-lavender);
            font-family: var(--font-heading);
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        .sub-nav-tab.active, .sub-nav-tab:hover {
            border-color: var(--accent-teal-bright);
            color: var(--accent-teal-bright);
            font-weight: 600;
            text-shadow: 0 0 5px var(--accent-teal-bright);
        }
        .sub-content {
            display: none;
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem 0.5rem; /* Adjusted padding */
            -ms-overflow-style: none;
            scrollbar-width: thin; /* Thinner scrollbar for firefox */
            scrollbar-color: var(--accent-purple-medium) var(--bg-card-purple); /* Scrollbar colors for Firefox */
        }
        .sub-content::-webkit-scrollbar { width: 6px; }
        .sub-content::-webkit-scrollbar-track { background: var(--bg-card-purple); border-radius:3px;}
        .sub-content::-webkit-scrollbar-thumb { background-color: var(--accent-purple-medium); border-radius: 3px; }
        .sub-content.active { display: block; }

        /* Carousel Styles - adapted from Tee & Me, styled for new theme */
        .carousel { position: relative; overflow: hidden; background-color: var(--bg-card-purple); border-radius: 0.5rem; padding: 0.5rem;}
        .carousel-inner { display: flex; transition: transform 0.5s ease-in-out; }
        .carousel-item { min-width: 100%; box-sizing: border-box; }
        .carousel-control-prev, .carousel-control-next {
            position: absolute; top: 50%; transform: translateY(-50%);
            background-color: rgba(255, 255, 255, 0.15); border: 1px solid var(--border-color-lavender);
            color: var(--text-primary-light); padding: 0.5rem; cursor: pointer; z-index: 10; border-radius: 50%;
        }
        .carousel-control-prev:hover, .carousel-control-next:hover { background-color: rgba(255, 255, 255, 0.3); }
        .carousel-control-prev { left: 10px; }
        .carousel-control-next { right: 10px; }

        #quickTimelineCarousel .carousel-item { min-width: 300px; max-width: 300px; padding: 0 0.75rem; }
        #quickTimelineCarousel .carousel-item > div { background-color: var(--bg-content-purple-opaque); border: 1px solid var(--border-color-lavender); } /* Inner card styling */

        /* Overview Dashboard Tiles (New) */
        .dashboard-tile {
            background-color: var(--bg-card-purple);
            padding: 1rem; border-radius: 8px;
            border: 1px solid var(--border-color-strong);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            cursor: pointer; transition: all 0.3s ease; text-align: center;
        }
        .dashboard-tile:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(45, 212, 191, 0.4); /* Teal glow */ }
        .dashboard-tile .tile-title { color: var(--accent-teal-bright); font-size: 0.9rem; margin-bottom: 0.25rem; font-family: var(--font-main); text-transform: uppercase; letter-spacing: 0.5px;}
        .dashboard-tile .tile-value { color: var(--text-primary-light); font-size: 1.5rem; font-weight: 700; font-family: var(--font-heading);}
        .dashboard-tile .tile-icon { font-size: 1.75rem; margin-bottom: 0.5rem; color: var(--accent-pink-vibrant); }


        .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 0.75rem; } /* Smaller minmax */
        .photo-grid img { width: 100%; height: auto; aspect-ratio: 1 / 1; object-fit: cover; border-radius: 0.375rem; border: 1px solid var(--border-color-lavender); }

        .modal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
            align-items: center; justify-content: center; padding: 1rem;
        }
        .modal.active { display: flex; }
        .modal-content {
            background-color: var(--bg-content-purple-opaque); margin: auto;
            padding: 1.5rem 2rem; border: 1px solid var(--border-color-strong);
            width: 90%; max-width: 600px; border-radius: 10px;
            position: relative; box-shadow: 0 5px 25px rgba(0,0,0,0.4);
            color: var(--text-primary-light); max-height: 90vh; overflow-y: auto;
        }
        .modal-content h3, .modal-content h4 { font-family: var(--font-heading); color: var(--accent-pink-vibrant); }
        .modal-close {
            color: var(--text-secondary-lavender); position: absolute; top: 15px; right: 20px;
            font-size: 2rem; font-weight: bold; cursor: pointer; background: none; border: none;
        }
        .modal-close:hover { color: var(--accent-pink-vibrant); }

        /* Chart Container - LifeSync Theme */
        .chart-container {
            position: relative; width: 100%; max-width: 550px; /* Slightly smaller max for dark theme */
            margin-left: auto; margin-right: auto;
            height: 280px; max-height: 320px;
            background-color: var(--bg-card-purple); /* Match card backgrounds */
            padding: 1rem; border-radius: 8px; border: 1px solid var(--border-color-lavender);
        }
        @media (min-width: 768px) {
            .chart-container { height: 320px; max-height: 380px; }
        }
        /* Modal chart container */
        .modal .chart-container { height: 250px; max-height: 280px; max-width: 100%;}


        #playlistFab {
            position: fixed; bottom: 2rem; right: 2rem; z-index: 1050;
            background-color: var(--accent-teal-bright); color: var(--bg-dark-purple);
            padding: 0.9rem; border-radius: 50%; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: none; cursor: pointer; transition: all 0.3s ease;
        }
        #playlistFab:hover { background-color: var(--accent-pink-vibrant); transform: scale(1.1); }
        #playlistFab i { font-size: 1.25rem; display: block;}


        /* General Form & Button Styling - LifeSync Inspired */
        label { display: block; margin-bottom: 0.3rem; font-size: 0.9rem; color: var(--text-secondary-lavender); }
        input[type="text"], input[type="email"], input[type="date"], input[type="password"], select, textarea {
            background-color: rgba(30,10,40,0.5); border: 1px solid var(--border-color-lavender);
            color: var(--text-primary-light); padding: 0.6rem 0.8rem;
            border-radius: 6px; width: 100%; margin-bottom: 0.75rem; font-size: 0.9rem;
            box-sizing: border-box; /* Ensure padding doesn't expand width */
        }
        input::placeholder, textarea::placeholder { color: var(--text-secondary-lavender); opacity: 0.7; }
        input:focus, select:focus, textarea:focus {
            outline: none; border-color: var(--accent-teal-bright);
            box-shadow: 0 0 0 2px rgba(45, 212, 191, 0.3);
        }
        .btn {
            padding: 0.6rem 1.25rem; border-radius: 20px; text-decoration: none;
            font-weight: 600; transition: all 0.3s ease; cursor: pointer;
            display: inline-block; margin-top: 0.5rem; border: 1px solid transparent;
            text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.85rem;
            font-family: var(--font-main);
        }
        .btn-primary { background-color: var(--accent-teal-bright); color: var(--bg-dark-purple); border-color: var(--accent-teal-bright); }
        .btn-primary:hover { background-color: transparent; color: var(--accent-teal-bright); box-shadow: 0 0 10px var(--accent-teal-bright); }
        .btn-secondary { background-color: var(--accent-pink-vibrant); color: var(--text-primary-light); border-color: var(--accent-pink-vibrant); }
        .btn-secondary:hover { background-color: transparent; color: var(--accent-pink-vibrant); box-shadow: 0 0 10px var(--accent-pink-vibrant); }
        .btn-purple { background-color: var(--accent-purple-medium); color: var(--text-primary-light); border-color: var(--accent-purple-medium); }
        .btn-purple:hover { background-color: transparent; color: var(--accent-purple-medium); box-shadow: 0 0 10px var(--accent-purple-medium); }


        .table-scroll-container { max-height: calc(100% - 4rem); overflow-y: auto; background-color: var(--bg-card-purple); border-radius: 0.375rem; padding: 0.5rem;}
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border-color-lavender); font-size: 0.85rem; }
        thead th { background-color: var(--bg-content-purple-opaque); color: var(--accent-teal-bright); font-family: var(--font-heading); text-transform: uppercase; letter-spacing: 0.5px;}
        tbody tr:hover { background-color: rgba(255,255,255,0.05); }

        /* Footer Styling - LifeSync Inspired */
        footer.main-footer { /* Renamed for clarity */
            position: fixed; bottom: 0; left: 0; width: 100%;
            padding: 10px 30px;
            background-color: rgba(30, 10, 40, 0.9);
            border-top: 1px solid var(--border-color-lavender);
            text-align: center; font-size: 0.8rem;
            color: var(--text-secondary-lavender); z-index: 1000;
            backdrop-filter: blur(8px);
            font-family: var(--font-main);
        }
        footer.main-footer a { color: var(--accent-teal-bright); text-decoration: none; }
        footer.main-footer a:hover { color: var(--text-primary-light); }

    </style>
</head>
<body>
    <video autoplay muted loop id="videoBackground">
        <source src="assets/videos/background.mp4" type="video/mp4">
        Your browser does not support HTML5 video.
    </video>
    <header class="main-header">
        <div class="header-title"><i class="fas fa-heartbeat"></i> <span data-i18n="siteTitle">Tee & Me - Our Story</span></div>
        <div>
            <button id="lang-en" class="lang-switcher active-lang" data-lang="en">EN</button>
            <button id="lang-xh" class="lang-switcher" data-lang="xh">XH</button>
        </div>
    </header>

    <nav class="main-nav p-2 shadow-md">
        <div class="container mx-auto flex justify-around items-center">
            <button class="nav-link active-navlink" data-section="overview" data-i18n="nav.overview">Overview</button>
            <button class="nav-link" data-section="analysis" data-i18n="nav.analysisHub">Analysis Hub</button>
            <button class="nav-link" data-section="media" data-i18n="nav.mediaTravelHub">Media & Travel</button>
            <button class="nav-link" data-section="connect" data-i18n="nav.connectResolve">Connect & Resolve</button>
            <button class="nav-link" data-section="lifesync" data-i18n="nav.lifeSyncFun">LifeSync & Fun</button>
        </div>
    </nav>

    <div class="content-area-wrapper">
        <div class="content-area">
            <section id="overview" class="content-section active">
                <h2 class="text-2xl font-semibold mb-4 text-center" style="color: var(--accent-pink-vibrant);" data-i18n="overview.title">Our Journey Snapshot</h2>
                <div class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-6 overflow-hidden">
                    <div class="flex flex-col gap-6 overflow-y-auto p-1 pr-3 sub-content">
                        <div>
                            <h3 class="text-xl font-medium mb-3" style="color:var(--accent-teal-bright);" data-i18n="overview.dashboard">Relationship Dashboard</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div class="dashboard-tile" data-metric="affection">
                                    <div class="tile-icon"><i class="fas fa-heart"></i></div>
                                    <h4 class="tile-title" data-i18n="overview.affectionLevel">Affection</h4>
                                    <p id="metricAffection" class="tile-value">8.5/10</p>
                                </div>
                                <div class="dashboard-tile" data-metric="support">
                                    <div class="tile-icon"><i class="fas fa-hands-helping"></i></div>
                                    <h4 class="tile-title" data-i18n="overview.supportScore">Support</h4>
                                    <p id="metricSupport" class="tile-value">9.2/10</p>
                                </div>
                                <div class="dashboard-tile" data-metric="food">
                                    <div class="tile-icon"><i class="fas fa-utensils"></i></div>
                                    <h4 class="tile-title" data-i18n="overview.foodPrep">Food Prep</h4>
                                    <p id="metricFood" class="tile-value">Balanced</p>
                                </div>
                                <div class="dashboard-tile" data-metric="safety">
                                    <div class="tile-icon"><i class="fas fa-shield-alt"></i></div>
                                    <h4 class="tile-title" data-i18n="overview.safetySecurity">Safety</h4>
                                    <p id="metricSafety" class="tile-value">Strong</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 rounded-lg" style="background-color: var(--bg-card-purple);">
                            <h3 class="text-lg font-medium" style="color:var(--accent-teal-bright);" data-i18n="overview.specialSong">Our Special Song</h3>
                            <p class="mt-1 text-sm" style="color:var(--text-secondary-lavender);">"Thank You Baby! (For Makin' Someday Come So Soon)"</p>
                            <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank" class="text-sm hover:underline" style="color:var(--accent-pink-vibrant);" data-i18n="overview.listen">Listen <i class="fas fa-play-circle ml-1"></i></a>
                        </div>
                        <div>
                            <h3 class="text-lg font-medium" style="color:var(--accent-teal-bright);" data-i18n="overview.quickTimeline">Quick Timeline</h3>
                            <div id="quickTimelineCarousel" class="carousel mt-2">
                                <div class="carousel-inner"></div>
                                <button class="carousel-control-prev"><i class="fas fa-chevron-left"></i></button>
                                <button class="carousel-control-next"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col gap-6 overflow-y-auto p-1 pl-3 sub-content">
                        <div>
                            <h3 class="text-lg font-medium" style="color:var(--accent-teal-bright);" data-i18n="overview.imageCarousel">Shared Moments</h3>
                            <div id="overviewImageCarousel" class="carousel mt-2 h-72 md:h-96 rounded-lg shadow-lg">
                                <div class="carousel-inner h-full"></div>
                                <button class="carousel-control-prev"><i class="fas fa-chevron-left"></i></button>
                                <button class="carousel-control-next"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-medium" style="color:var(--accent-teal-bright);" data-i18n="overview.dashboardChartTitle">Initial Weeks Metric Trend</h3>
                            <div class="chart-container mt-2">
                                <canvas id="dashboardChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="analysis" class="content-section">
                <h2 class="text-2xl font-semibold text-center" style="color:var(--accent-pink-vibrant);" data-i18n="analysisHub.title">Analysis Hub</h2>
                <div class="sub-nav-tabs flex">
                    <button class="sub-nav-tab active" data-subtarget="tracking" data-i18n="analysisHub.tracking.title">Tracking</button>
                    <button class="sub-nav-tab" data-subtarget="contributions" data-i18n="analysisHub.contributions.title">Contributions</button>
                    <button class="sub-nav-tab" data-subtarget="reinforcement" data-i18n="analysisHub.reinforcement.title">Reinforcement</button>
                </div>
                <div id="tracking" class="sub-content active">
                    <label for="trackingMetricSelect" class="block text-sm font-medium" data-i18n="analysisHub.tracking.selectMetric">Select Metric:</label>
                    <select id="trackingMetricSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base focus:outline-none sm:text-sm rounded-md"></select>
                    <div class="chart-container mt-4 h-[calc(100%-7rem)] max-h-[calc(100%-7rem)]">
                         <canvas id="trackingChart"></canvas>
                    </div>
                </div>
                <div id="contributions" class="sub-content">
                    <label for="contributionFilterWeek" class="block text-sm font-medium" data-i18n="analysisHub.contributions.filterByWeek">Filter by Week:</label>
                    <select id="contributionFilterWeek" class="mt-1 block w-full pl-3 pr-10 py-2 text-base focus:outline-none sm:text-sm rounded-md"></select>
                    <div class="mt-4 table-scroll-container">
                        <table>
                            <thead>
                                <tr>
                                    <th data-i18n="analysisHub.contributions.parameter">Parameter</th>
                                    <th data-i18n="analysisHub.contributions.salatiso">Salatiso</th>
                                    <th data-i18n="analysisHub.contributions.tee">Tee</th>
                                    <th data-i18n="analysisHub.contributions.notes">Notes</th>
                                </tr>
                            </thead>
                            <tbody id="contributionsTableBody"></tbody>
                        </table>
                    </div>
                </div>
                <div id="reinforcement" class="sub-content">
                     <div class="mt-4 table-scroll-container">
                        <table>
                            <thead>
                                <tr>
                                    <th data-i18n="analysisHub.reinforcement.wordAction">Word/Action</th>
                                    <th data-i18n="analysisHub.reinforcement.purpose">Purpose</th>
                                    <th data-i18n="analysisHub.reinforcement.occurrencesSalatiso">Salatiso (Wks)</th>
                                    <th data-i18n="analysisHub.reinforcement.occurrencesTee">Tee (Wks)</th>
                                    <th data-i18n="analysisHub.reinforcement.occurrencesJoint">Joint (Wks)</th>
                                </tr>
                            </thead>
                            <tbody id="reinforcementTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="media" class="content-section">
                <h2 class="text-2xl font-semibold text-center" style="color:var(--accent-pink-vibrant);" data-i18n="mediaTravelHub.title">Media & Travel Hub</h2>
                <div class="sub-nav-tabs flex">
                    <button class="sub-nav-tab active" data-subtarget="songs" data-i18n="mediaTravelHub.sharedSongs.title">Shared Songs</button>
                    <button class="sub-nav-tab" data-subtarget="photos" data-i18n="mediaTravelHub.photoMoments.title">Photo Moments</button>
                    <button class="sub-nav-tab" data-subtarget="visited" data-i18n="mediaTravelHub.visited.title">Visited</button>
                    <button class="sub-nav-tab" data-subtarget="dream" data-i18n="mediaTravelHub.dreamTrips.title">Dream Trips</button>
                </div>
                <div id="songs" class="sub-content active">
                    <ul id="sharedSongsList" class="space-y-3"></ul>
                </div>
                <div id="photos" class="sub-content">
                    <div id="photoMomentsGrid" class="photo-grid"></div>
                </div>
                <div id="visited" class="sub-content">
                    <div id="visitedTripsList" class="space-y-4"></div>
                </div>
                <div id="dream" class="sub-content">
                    <div id="dreamTripsList" class="space-y-4"></div>
                </div>
            </section>

            <section id="connect" class="content-section">
                <h2 class="text-2xl font-semibold text-center" style="color:var(--accent-pink-vibrant);" data-i18n="connectResolve.title">Connect & Resolve</h2>
                <div class="sub-nav-tabs flex">
                    <button class="sub-nav-tab active" data-subtarget="feedback" data-i18n="connectResolve.feedback.title">Feedback</button>
                    <button class="sub-nav-tab" data-subtarget="actions" data-i18n="connectResolve.actions.title">Actions</button>
                    <button class="sub-nav-tab" data-subtarget="logs" data-i18n="connectResolve.logs.title">Logs</button>
                </div>
                <div id="feedback" class="sub-content active grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 rounded-lg" style="background-color: var(--bg-card-purple);">
                        <h3 class="text-lg font-medium mb-2" style="color:var(--accent-teal-bright);" data-i18n="connectResolve.feedback.give">Give Feedback</h3>
                        <form id="feedbackForm" class="space-y-4">
                            <div>
                                <label for="feedbackSender" data-i18n="connectResolve.feedback.sender">Sender</label>
                                <select id="feedbackSender"><option value="Salatiso">Salatiso</option><option value="Tee">Tee</option></select>
                            </div>
                            <div>
                                <label for="feedbackRecipient" data-i18n="connectResolve.feedback.recipient">Recipient</label>
                                <select id="feedbackRecipient"><option value="Tee">Tee</option><option value="Salatiso">Salatiso</option></select>
                            </div>
                            <div>
                                <label for="feedbackMessage" data-i18n="connectResolve.feedback.message">Message</label>
                                <textarea id="feedbackMessage" rows="3" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary" data-i18n="connectResolve.feedback.send">Send Feedback</button>
                        </form>
                    </div>
                    <div class="p-4 rounded-lg" style="background-color: var(--bg-card-purple);">
                        <h3 class="text-lg font-medium mb-2" style="color:var(--accent-teal-bright);" data-i18n="connectResolve.feedback.logTitle">Feedback Log</h3>
                        <div id="feedbackLogContainer" class="space-y-3 max-h-[calc(100%-3rem)] overflow-y-auto"></div>
                    </div>
                </div>
                <div id="actions" class="sub-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <form id="apologyForm" class="space-y-3 p-4 rounded-lg" style="background-color: var(--bg-card-purple);">
                            <h4 class="font-semibold" style="color:var(--accent-teal-bright);" data-i18n="connectResolve.actions.apology.title">Make an Apology</h4>
                            <select id="apologyActor"><option value="Salatiso">Salatiso</option><option value="Tee">Tee</option></select>
                            <textarea id="apologyMessage" placeholder="Apology message..." rows="2" required></textarea>
                            <button type="submit" class="btn btn-primary" data-i18n="connectResolve.actions.apology.submit">Submit Apology</button>
                        </form>
                        <form id="dissatisfactionForm" class="space-y-3 p-4 rounded-lg" style="background-color: var(--bg-card-purple);">
                            <h4 class="font-semibold" style="color:var(--accent-teal-bright);" data-i18n="connectResolve.actions.dissatisfaction.title">Express Dissatisfaction</h4>
                            <select id="dissatisfactionActor"><option value="Salatiso">Salatiso</option><option value="Tee">Tee</option></select>
                            <textarea id="dissatisfactionMessage" placeholder="Details of dissatisfaction..." rows="2" required></textarea>
                            <button type="submit" class="btn btn-primary" data-i18n="connectResolve.actions.dissatisfaction.submit">Submit Concern</button>
                        </form>
                        <form id="bookDateForm" class="space-y-3 p-4 rounded-lg" style="background-color: var(--bg-card-purple);">
                            <h4 class="font-semibold" style="color:var(--accent-teal-bright);" data-i18n="connectResolve.actions.bookDate.title">Book a Date</h4>
                            <select id="bookDateActor"><option value="Salatiso">Salatiso</option><option value="Tee">Tee</option></select>
                            <input type="text" id="bookDateActivity" placeholder="Activity description" required>
                            <input type="date" id="bookDateDate" required>
                            <button type="submit" class="btn btn-primary" data-i18n="connectResolve.actions.bookDate.submit">Propose Date</button>
                        </form>
                        <form id="terminationForm" class="space-y-3 p-4 rounded-lg" style="background-color: var(--bg-card-purple); border: 1px solid var(--accent-pink-vibrant);">
                            <h4 class="font-semibold" style="color:var(--accent-pink-vibrant);" data-i18n="connectResolve.actions.termination.title">Initiate Relationship Termination</h4>
                            <select id="terminationActor"><option value="Salatiso">Salatiso</option><option value="Tee">Tee</option></select>
                            <select id="terminationReason">
                                <option value="irreconcilable_differences" data-i18n="connectResolve.actions.termination.reasonIrreconcilable">Irreconcilable Differences</option>
                                <option value="growing_apart" data-i18n="connectResolve.actions.termination.reasonGrowingApart">Growing Apart</option>
                                <option value="other" data-i18n="connectResolve.actions.termination.reasonOther">Other (Specify)</option>
                            </select>
                            <textarea id="terminationNotes" placeholder="Additional notes (if any)..." rows="2"></textarea>
                            <button type="submit" class="btn btn-secondary" data-i18n="connectResolve.actions.termination.submit">Initiate</button>
                        </form>
                    </div>
                </div>
                <div id="logs" class="sub-content">
                    <h3 class="text-lg font-medium" style="color:var(--accent-teal-bright);" data-i18n="connectResolve.logs.actionLogTitle">Action Log</h3>
                    <div id="actionLogContainer" class="mt-2 space-y-3 max-h-[calc(100%-3rem)] overflow-y-auto"></div>
                </div>
            </section>

            <section id="lifesync" class="content-section">
                <h2 class="text-2xl font-semibold text-center" style="color:var(--accent-pink-vibrant);" data-i18n="lifeSyncFun.title">LifeSync & Fun</h2>
                <div class="sub-nav-tabs flex">
                    <button class="sub-nav-tab active" data-subtarget="compatibility" data-i18n="lifeSyncFun.compatibility.title">Compatibility</button>
                    <button class="sub-nav-tab" data-subtarget="quizzes" data-i18n="lifeSyncFun.quizzes.title">Quizzes</button>
                    <button class="sub-nav-tab" data-subtarget="reports" data-i18n="lifeSyncFun.reports.title">LifeSync Reports</button>
                </div>
                <div id="compatibility" class="sub-content active grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 rounded-lg" style="background-color: var(--bg-card-purple);">
                        <h3 class="text-md font-semibold mb-2" style="color:var(--accent-teal-bright);" data-i18n="lifeSyncFun.compatibility.astrology.title">Astrology Compatibility</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label for="salatisoBirthday" class="text-sm" data-i18n="lifeSyncFun.compatibility.astrology.salatisoBday">Salatiso's Bday:</label>
                                <input type="date" id="salatisoBirthday" class="text-sm p-1">
                            </div>
                            <div>
                                <label for="teeBirthday" class="text-sm" data-i18n="lifeSyncFun.compatibility.astrology.teeBday">Tee's Bday:</label>
                                <input type="date" id="teeBirthday" class="text-sm p-1">
                            </div>
                        </div>
                        <button id="checkAstrology" class="btn btn-primary !text-xs !py-1.5 !px-3 mt-3" data-i18n="lifeSyncFun.compatibility.astrology.check">Check</button>
                        <div id="astrologyResult" class="mt-2 text-sm" style="color:var(--text-secondary-lavender);"></div>
                    </div>
                    <div class="p-4 rounded-lg" style="background-color: var(--bg-card-purple);">
                        <h3 class="text-md font-semibold" style="color:var(--accent-teal-bright);" data-i18n="lifeSyncFun.compatibility.values.title">Values Alignment</h3>
                        <p class="text-xs mt-1" style="color:var(--text-secondary-lavender);" data-i18n="lifeSyncFun.compatibility.values.desc">Discover how your core values align.</p>
                        <button class="placeholder-test-btn btn btn-purple !text-xs !py-1.5 !px-3 mt-2" data-i18n="lifeSyncFun.compatibility.startTest">Start Test</button>
                    </div>
                     <div class="p-4 rounded-lg" style="background-color: var(--bg-card-purple);">
                        <h3 class="text-md font-semibold" style="color:var(--accent-teal-bright);" data-i18n="lifeSyncFun.compatibility.communication.title">Communication Styles</h3>
                        <p class="text-xs mt-1" style="color:var(--text-secondary-lavender);" data-i18n="lifeSyncFun.compatibility.communication.desc">Understand your communication patterns.</p>
                        <button class="placeholder-test-btn btn btn-purple !text-xs !py-1.5 !px-3 mt-2" data-i18n="lifeSyncFun.compatibility.startTest">Start Test</button>
                    </div>
                    <div class="p-4 rounded-lg" style="background-color: var(--bg-card-purple);">
                        <h3 class="text-md font-semibold" style="color:var(--accent-teal-bright);" data-i18n="lifeSyncFun.compatibility.proverbs.title">African Proverbs Wisdom Match</h3>
                        <p class="text-xs mt-1" style="color:var(--text-secondary-lavender);" data-i18n="lifeSyncFun.compatibility.proverbs.desc">Find wisdom in shared cultural understanding.</p>
                        <button class="placeholder-test-btn btn btn-purple !text-xs !py-1.5 !px-3 mt-2" data-i18n="lifeSyncFun.compatibility.startTest">Start Test</button>
                    </div>
                </div>
                <div id="quizzes" class="sub-content text-center pt-10">
                    <p data-i18n="lifeSyncFun.quizzes.comingSoon" class="text-lg">Relationship quizzes coming soon!</p>
                    <i class="fas fa-puzzle-piece fa-3x mt-4" style="color: var(--accent-purple-medium);"></i>
                </div>
                <div id="reports" class="sub-content">
                    <label for="reportPeriod" class="block text-sm font-medium" data-i18n="lifeSyncFun.reports.selectPeriod">Select Period:</label>
                    <select id="reportPeriod" class="mt-1 block w-full">
                        <option value="last_3_months" data-i18n="lifeSyncFun.reports.periodLast3Months">Last 3 Months</option>
                        <option value="all_time" data-i18n="lifeSyncFun.reports.periodAllTime">All Time</option>
                    </select>
                    <button id="generateReportBtn" class="btn btn-primary mt-3" data-i18n="lifeSyncFun.reports.generate">Generate Report</button>
                </div>
            </section>
        </div>
    </div>

    <footer class="main-footer">
        <p data-i18n="footer.copyright">Â© 2025 Tee & Me. All Rights Reserved. Prototype V7.2</p>
    </footer>

    <div id="detailsModal" class="modal">
        <div class="modal-content w-full md:w-2/3 lg:w-1/2">
            <button class="modal-close" data-modal-id="detailsModal">&times;</button>
            <h3 id="modalTitle" class="text-xl font-semibold mb-3">Week Details</h3>
            <div id="modalTimelineCarousel" class="carousel">
                <div class="carousel-inner"></div>
                <button class="carousel-control-prev"><i class="fas fa-chevron-left"></i></button>
                <button class="carousel-control-next"><i class="fas fa-chevron-right"></i></button>
            </div>
            <p id="modalSummary" class="mt-3 text-sm"></p>
        </div>
    </div>

    <div id="alertModal" class="modal">
        <div class="modal-content w-auto max-w-md">
            <button class="modal-close" data-modal-id="alertModal">&times;</button>
            <h4 id="alertModalTitle" class="text-lg font-semibold mb-2">Notification</h4>
            <p id="alertModalMessage" class="text-sm mb-4"></p>
            <button id="alertModalOk" class="btn btn-primary w-full" data-i18n="modal.ok">OK</button>
        </div>
    </div>
    
    <div id="playlistModal" class="modal">
        <div class="modal-content w-full md:w-3/4 lg:w-2/3 p-1 aspect-video" style="background-color: black;">
             <button class="modal-close text-white bg-black/50 rounded-full w-8 h-8 flex items-center justify-center -top-3 -right-3 z-10" data-modal-id="playlistModal">&times;</button>
            <iframe id="playlistFrame" class="w-full h-full" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        </div>
    </div>

    <div id="metricDetailModal" class="modal">
        <div class="modal-content w-full md:w-2/3 lg:w-1/2">
            <button class="modal-close" data-modal-id="metricDetailModal">&times;</button>
            <h3 id="metricModalTitle" class="text-xl font-semibold mb-3">Metric Details</h3>
            <div class="chart-container h-64 max-h-64">
                <canvas id="metricModalChart"></canvas>
            </div>
            <div id="metricModalSummary" class="mt-3 text-sm"></div>
        </div>
    </div>


    <button id="playlistFab" title="Open Playlist">
        <i class="fas fa-music"></i>
    </button>

    <script>
        // Attempt to load translations from an external file
        const translationsScript = document.createElement('script');
        translationsScript.src = 'xh_translations.js';
        translationsScript.onerror = function() {
            console.warn('xh_translations.js not found or failed to load. Using embedded fallback Xhosa translations.');
            if (typeof window.xhosaTranslations === 'undefined') {
                window.xhosaTranslations = {
                    siteTitle: "Tee & Mna - Ibali Lethu (Fallback)",
                    nav: { overview: "Isishwankathelo (FB)"},
                    // Add other critical fallbacks if needed
                };
            }
            // Ensure i18next is initialized or re-initialized if it depends on this script.
            // For simplicity, main initialization in initializeApp will handle it.
        };
        document.head.appendChild(translationsScript);

        // --- Start of Embedded JavaScript ---
        const relationshipData = {
            playlistUrl: "https://www.youtube.com/embed/playlist?list=PL4o29bINVT4EG_y-k5jGoOu3-Am8Nmmd2",
            photoFileNames: Array.from({length: 12}, (_, i) => `photo${i + 1}.jpg`),
            weeks: [
                {
                    weekNumber: 1, startDate: "2024-01-01", summaryKey: "weekSummaries.week1Summary",
                    contributions: {
                        salatiso: { affection: 8, support: 7, communication: 9, food: 5, safety: 8, finances: 600, chores: 4, planning: 7, notesKey: "weekNotes.week1SalatisoNotes" },
                        tee: { affection: 9, support: 8, communication: 8, food: 7, safety: 9, finances: 500, chores: 6, planning: 6, notesKey: "weekNotes.week1TeeNotes" }
                    },
                    events: [
                        { type: "event", textKey: "eventTexts.eventWeek1FirstDate", originalMessageKey: "originalMessages.originalMsgW1FD" },
                        { type: "music", songTitle: "Perfect", artist: "Ed Sheeran", songUrl: "https://www.youtube.com/watch?v=2Vv-BfVoq4g", sharedBy: "Salatiso", textKey: "eventTexts.musicWeek1Salatiso" }
                    ]
                },
                {
                    weekNumber: 2, startDate: "2024-01-08", summaryKey: "weekSummaries.week2Summary",
                    contributions: {
                        salatiso: { affection: 7, support: 8, communication: 7, food: 6, safety: 7, finances: 550, chores: 5, planning: 6, notesKey: "weekNotes.week2SalatisoNotes" },
                        tee: { affection: 8, support: 9, communication: 9, food: 8, safety: 8, finances: 650, chores: 7, planning: 8, notesKey: "weekNotes.week2TeeNotes" }
                    },
                    events: [
                        { type: "event", textKey: "eventTexts.eventWeek2MovieNight", originalMessageKey: "originalMessages.originalMsgW2MN" },
                        { type: "link", textKey: "eventTexts.linkWeek2Article", url: "https://www.example.com/article", sharedBy: "Tee" }
                    ]
                },
                 {
                    weekNumber: 3, startDate: "2024-01-15", summaryKey: "weekSummaries.week3Summary",
                    contributions: {
                        salatiso: { affection: 9, support: 9, communication: 8, food: 7, safety: 9, finances: 700, chores: 6, planning: 8, notesKey: "weekNotes.week3SalatisoNotes" },
                        tee: { affection: 9, support: 8, communication: 9, food: 7, safety: 9, finances: 750, chores: 7, planning: 7, notesKey: "weekNotes.week3TeeNotes" }
                    },
                    events: [
                        { type: "event", textKey: "eventTexts.eventWeek3WeekendTrip", originalMessageKey: "originalMessages.originalMsgW3WT" },
                        { type: "music", songTitle: "A Thousand Years", artist: "Christina Perri", songUrl: "https://www.youtube.com/watch?v=rtOvBOTyX00", sharedBy: "Joint", textKey: "eventTexts.musicWeek3Joint" }
                    ]
                },
                {
                    weekNumber: 4, startDate: "2024-01-22", summaryKey: "weekSummaries.week4Summary",
                     contributions: {
                        salatiso: { affection: 8, support: 7, communication: 7, food: 5, safety: 8, finances: 620, chores: 5, planning: 6, notesKey: "weekNotes.week4SalatisoNotes" },
                        tee: { affection: 7, support: 8, communication: 8, food: 6, safety: 7, finances: 580, chores: 6, planning: 7, notesKey: "weekNotes.week4TeeNotes" }
                    },
                    events: [ { type: "event", textKey: "eventTexts.eventWeek4QuietDinner", originalMessageKey: "originalMessages.originalMsgW4QD" } ]
                }
            ],
            reinforcementWords: [
                { wordKey: "reinforcement.reinforceThankYou", purposeKey: "reinforcement.purposeExpressGratitude", occurrences: { salatiso: [1, 3], tee: [1, 2, 4], joint: [] } },
                { wordKey: "reinforcement.reinforceAppreciate", purposeKey: "reinforcement.purposeAcknowledgeEffort", occurrences: { salatiso: [2], tee: [3, 4], joint: [1] } },
                { wordKey: "reinforcement.reinforceLoveYou", purposeKey: "reinforcement.purposeExpressAffection", occurrences: { salatiso: [1,2,3,4], tee: [1,2,3,4], joint: [] } },
            ],
            feedbackLog: [
                { id: "fb1", sender: "Salatiso", recipient: "Tee", messageKey: "feedbackMessages.feedback1Initial", timestamp: "2024-01-10T10:00:00Z", status: "responded", responseTime: 3600000 },
                { id: "fb2", sender: "Tee", recipient: "Salatiso", messageKey: "feedbackMessages.feedback2Initial", timestamp: "2024-01-12T14:30:00Z", status: "pending", responseTime: null },
            ],
            actionLog: [
                { id: "act1", actor: "Tee", actionTypeKey: "actionTypes.actionApology", detailsKey: "actionDetails.actionDetail1Initial", timestamp: "2024-01-15T14:00:00Z" },
                { id: "act2", actor: "Salatiso", actionTypeKey: "actionTypes.actionBookDate", detailsKey: "actionDetails.actionDetail2Initial", date: "2024-01-20", timestamp: "2024-01-16T10:00:00Z" },
            ],
            travelLog: {
                visited: [ { id: "tv1", destinationKey: "travel.destDrakensberg", dates: "2023-07-10 - 2023-07-15", roles: { salatisoKey: "travel.rolePlanner", teeKey: "travel.roleNavigator" }, highlightsKey: "travel.drakensbergHighlights", photos: ["photo3.jpg", "photo4.jpg"] } ],
                dream: [ { id: "td1", destinationKey: "travel.destParis", notesKey: "travel.parisDreamNotes" }, { id: "td2", destinationKey: "travel.destKyoto", notesKey: "travel.kyotoDreamNotes" } ]
            },
            metricsMeta: {
                affection: { labelKey: "metrics.affection", unit: "/10", icon: "fas fa-heart" },
                support: { labelKey: "metrics.support", unit: "/10", icon: "fas fa-hands-helping" },
                communication: { labelKey: "metrics.communication", unit: "/10", icon: "fas fa-comments" },
                food: { labelKey: "metrics.food", unit: "/10", icon: "fas fa-utensils" }, // For dashboard tile
                safety: { labelKey: "metrics.safety", unit: "/10", icon: "fas fa-shield-alt" }, // For dashboard tile
                finances: { labelKey: "metrics.finances", unit: " ZAR", icon: "fas fa-coins" },
                chores: { labelKey: "metrics.chores", unit: "/10", icon: "fas fa-broom" },
                planning: { labelKey: "metrics.planning", unit: "/10", icon: "fas fa-calendar-alt" },
                feedbackResponseTime: { labelKey: "metrics.feedbackResponse", unit: " hours", icon: "fas fa-reply"}
            },
            dashboardMetrics: ["affection", "support", "food", "safety"] // Metrics for the Overview dashboard tiles
        };

        const defaultEnglishTranslations = { /* Default English translations from previous Tee & Me version, structured */
            siteTitle: "Tee & Me - Our Story",
            nav: { overview: "Overview", analysisHub: "Analysis Hub", mediaTravelHub: "Media & Travel", connectResolve: "Connect & Resolve", lifeSyncFun: "LifeSync & Fun" },
            overview: {
                title: "Our Journey Snapshot", dashboard: "Relationship Dashboard", affectionLevel: "Affection", supportScore: "Support",
                foodPrep: "Food Prep", safetySecurity: "Safety", specialSong: "Our Special Song", listen: "Listen",
                quickTimeline: "Quick Timeline", seeDetails: "See Details", imageCarousel: "Shared Moments", dashboardChartTitle: "Initial Weeks Metric Trend",
                viewMetricDetails: "View Details"
            },
            analysisHub: {
                title: "Analysis Hub",
                tracking: { title: "Tracking", selectMetric: "Select Metric:" },
                contributions: { title: "Contributions", filterByWeek: "Filter by Week:", parameter: "Parameter", salatiso: "Salatiso", tee: "Tee", notes: "Notes" },
                reinforcement: { title: "Reinforcement", wordAction: "Word/Action", purpose: "Purpose", occurrencesSalatiso: "Salatiso (Wks)", occurrencesTee: "Tee (Wks)", occurrencesJoint: "Joint (Wks)" }
            },
            mediaTravelHub: { /* Similar structure */
                title: "Media & Travel Hub",
                sharedSongs: { title: "Shared Songs", sharedBy: "Shared by {{user}} in Week {{week}}", listen: "Listen" },
                photoMoments: { title: "Photo Moments" },
                visited: { title: "Visited Places", roles: "Roles:", highlights: "Highlights:", photos: "Photos:" },
                dreamTrips: { title: "Dream Trips", notes: "Notes:" }
            },
            connectResolve: {
                title: "Connect & Resolve",
                feedback: { title: "Feedback", give: "Give Feedback", sender: "Sender", recipient: "Recipient", message: "Message", send: "Send Feedback", logTitle: "Feedback Log", acknowledged: "Acknowledged", acknowledge: "Acknowledge", respondedIn: "Responded in {{duration}}", pending: "Pending" },
                actions: {
                    title: "Actions",
                    apology: { title: "Make an Apology", submit: "Submit Apology" },
                    dissatisfaction: { title: "Express Dissatisfaction", submit: "Submit Concern" },
                    bookDate: { title: "Book a Date", submit: "Propose Date", activity: "Activity", date: "Date" },
                    termination: { title: "Initiate Relationship Termination", reason: "Reason", notes: "Notes", submit: "Initiate", reasonIrreconcilable: "Irreconcilable Differences", reasonGrowingApart: "Growing Apart", reasonOther: "Other (Specify)", confirm: "Are you sure you want to log this action? This is a serious step."}
                },
                logs: { title: "Logs", actionLogTitle: "Action Log" }
            },
            lifeSyncFun: { /* Similar structure */
                title: "LifeSync & Fun",
                compatibility: {
                    title: "Compatibility",
                    astrology: { title: "Astrology Compatibility", salatisoBday: "Salatiso's Bday:", teeBday: "Tee's Bday:", check: "Check", result: "{{name1}} ({{zodiac1}}) & {{name2}} ({{zodiac2}}): {{compatibilityText}}" },
                    values: { title: "Values Alignment", desc: "Discover how your core values align." },
                    communication: { title: "Communication Styles", desc: "Understand your communication patterns." },
                    proverbs: { title: "African Proverbs Wisdom Match", desc: "Find wisdom in shared cultural understanding." },
                    startTest: "Start Test", comingSoon: "Coming Soon!"
                },
                quizzes: { title: "Quizzes", comingSoon: "Relationship quizzes coming soon!" },
                reports: { title: "LifeSync Reports", selectPeriod: "Select Period:", generate: "Generate Report", periodLast3Months: "Last 3 Months", periodAllTime: "All Time", featureComingSoon: "Full report generation is a future feature!" }
            },
            weekSummaries: { // Corresponds to summaryKey in relationshipData.weeks
                week1Summary: "Our exciting first week!", week2Summary: "Getting to know each other more.", week3Summary: "First little adventure.", week4Summary: "Settling into a rhythm."
            },
            weekNotes: {
                week1SalatisoNotes: "Felt a real spark.", week1TeeNotes: "Very hopeful and happy.",
                week2SalatisoNotes: "Good conversations.", week2TeeNotes: "Enjoying the company.",
                week3SalatisoNotes: "The trip was amazing!", week3TeeNotes: "Made some great memories.",
                week4SalatisoNotes: "Comfortable and content.", week4TeeNotes: "Feeling secure."
            },
            eventTexts: { // Corresponds to textKey in relationshipData.events
                eventWeek1FirstDate: "Our memorable first date.", musicWeek1Salatiso: "Salatiso shared 'Perfect'.",
                eventWeek2MovieNight: "Cozy movie night in.", linkWeek2Article: "Tee shared an interesting article.",
                eventWeek3WeekendTrip: "Spontaneous weekend trip!", musicWeek3Joint: "We both loved 'A Thousand Years'.",
                eventWeek4QuietDinner: "A lovely quiet dinner at home.", noEvents: "No specific events logged for this week."
            },
            originalMessages: { /* Corresponds to originalMessageKey */
                originalMsgW1FD: "Salatiso: 'Tonight was amazing, Tee. Can't wait to see you again.' Tee: 'You too, Salatiso! I had a wonderful time.'",
                originalMsgW2MN: "Tee: 'Movie night at my place? I'll get snacks!' Salatiso: 'Sounds perfect!'",
                originalMsgW3WT: "Salatiso: 'Pack your bags, we're going on an adventure this weekend!' Tee: 'OMG, where?! So excited!'",
                originalMsgW4QD: "Tee: 'Just a simple, lovely dinner tonight. Thanks for cooking, Salatiso.' Salatiso: 'My pleasure, Tee.'"
            },
            reinforcement: { /* Corresponds to wordKey/purposeKey */
                reinforceThankYou: "Saying 'Thank You'", purposeExpressGratitude: "To express gratitude and appreciation.",
                reinforceAppreciate: "Using 'I appreciate...'", purposeAcknowledgeEffort: "To acknowledge specific efforts or qualities.",
                reinforceLoveYou: "Saying 'I love you'", purposeExpressAffection: "To affirm love and affection."
            },
            feedbackMessages: { /* Corresponds to messageKey */
                feedback1Initial: "I felt a bit unheard yesterday during our discussion about weekend plans.",
                feedback2Initial: "Thank you for taking out the trash without me asking! I really appreciate it."
            },
            actionDetails: { /* Corresponds to detailsKey */
                actionDetail1Initial: "For being late to our coffee meeting. Work ran over, but I should have managed my time better.",
                actionDetail2Initial: "Proposed a picnic at the botanical gardens for Saturday."
            },
            actionTypes: {
                actionApology: "Apology", actionExpressDissatisfaction: "Expressed Dissatisfaction", actionBookDate: "Booked a Date", actionTerminate: "Initiated Termination"
            },
            travel: { /* Corresponds to destinationKey, roleKey, highlightsKey, notesKey */
                destDrakensberg: "Drakensberg Mountains", destParis: "Paris, France", destKyoto: "Kyoto, Japan",
                rolePlanner: "Planner", roleNavigator: "Navigator", rolePhotographer: "Photographer",
                drakensbergHighlights: "Amazing hikes, breathtaking views, cozy evenings by the fire.",
                parisDreamNotes: "Romantic walks, Eiffel Tower, Louvre, delicious pastries.",
                kyotoDreamNotes: "Temples, gardens, traditional culture, cherry blossoms."
            },
            metrics: relationshipData.metricsMeta, // Reused for consistency in translations
            modal: { ok: "OK", detailsTitle: "Week {{weekNumber}} Details", metricDetailsTitle: "{{metricName}} Details" },
            footer: { copyright: "Â© 2025 Tee & Me. All Rights Reserved. Prototype V7.2" },
            general: {
                week: "Week", from: "From", to: "To",
                salatiso: "Salatiso", tee: "Tee", joint: "Joint/Unspecified",
                error: "Error", success: "Success", notification: "Notification",
                actionLogged: "Action logged successfully.",
                feedbackSent: "Feedback sent successfully.",
                feedbackAcknowledged: "Feedback acknowledged.",
                noDataAvailable: "No data available for this metric."
            }
        };
        
        // Minimal Xhosa fallback, actual content should be in xh_translations.js
        const fallbackXhosaTranslations = {
            siteTitle: "Tee & Mna - Ibali Lethu",
            nav: { overview: "Isishwankathelo", analysisHub: "Iziko LoHlalutyo", mediaTravelHub: "Ezosasazo NoHambo", connectResolve: "Qhagamshela & Sombulula", lifeSyncFun: "LifeSync & Ukonwaba" },
            overview: { title: "Imbonakalo Yohambo Lwethu", dashboard: "Ideshibhodi", affectionLevel: "Uthando", supportScore: "Inkxaso", foodPrep: "Ukulung. Ukutya", safetySecurity: "Ukhuseleko", specialSong: "Ingoma Yethu Ekhethekileyo", listen: "Mamela", quickTimeline: "Umda Wexesha Olukhawulezayo", seeDetails: "Jonga Iinkcukacha", imageCarousel: "Amaxesha Esabelwene Ngawo", dashboardChartTitle: "Umkhwa Weemetriki Zeeveki Zokuqala", viewMetricDetails: "Jonga Iinkcukacha"},
            weekSummaries: { week1Summary: "Iveki yethu yokuqala eyonwabisayo!", week2Summary: "Sisazana ngakumbi.", week3Summary: "Uhambo lwethu lokuqala oluncinci.", week4Summary: "Siqhela isingqi esitsha." },
            modal: { ok: "Kulungile", detailsTitle: "Iinkcukacha Zeveki {{weekNumber}}", metricDetailsTitle: "Iinkcukacha ze {{metricName}}" },
            footer: { copyright: "Â© 2025 Tee & Mna. Onke Amalungelo Agciniwe. Umzekelo V7.2" },
            general: { week: "Iveki", from: "Ukusuka", to: "Ukuya", salatiso: "uSalatiso", tee: "uTee", notification: "Isaziso" }
        };

        let i18nInstance;
        let currentLanguage = 'en';
        let dashboardChartInstance, trackingChartInstance, metricModalChartInstance;

        document.addEventListener('DOMContentLoaded', initializeApp);

        function initializeApp() {
            console.log("App Initializing (Tee & Me - LifeSync Theme)...");
            setupI18Next(); // Will call updateContentAll and other renders once ready
            // Initial layout adjustment is now deferred until after i18next is ready, to ensure correct element dimensions if text length changes
            // Other setups will also be called in i18next callback or by render functions.
        }

        function postI18nInitSetup() {
            console.log("Post i18next Initialization Setup...");
            adjustLayout();
            window.addEventListener('resize', adjustLayout);
            
            setupNavigation();
            setupSubNavigation();
            setupModals();
            setupCarousels(); // Basic setup, population happens in render functions
            populateAllSelects();

            // Initial render calls
            renderOverviewSection();
            renderAnalysisHub();
            renderMediaTravelHub();
            renderConnectResolveHub();
            renderLifeSyncFunHub();
            
            setupActionForms();
            setupCompatibilityTools();
            setupPlaylistFab();

            document.querySelectorAll('.placeholder-test-btn').forEach(btn => {
                btn.addEventListener('click', () => showCustomAlert(i18nInstance.t('lifeSyncFun.compatibility.comingSoon')));
            });
            document.getElementById('generateReportBtn')?.addEventListener('click', () => {
                showCustomAlert(i18nInstance.t('lifeSyncFun.reports.featureComingSoon'));
            });
            console.log("App Initialized Successfully (Tee & Me - LifeSync Theme).");
        }


        function setupI18Next() {
            const resources = {
                en: { translation: defaultEnglishTranslations },
                xh: { translation: window.xhosaTranslations || fallbackXhosaTranslations }
            };

            i18nInstance = i18next
                .use(i18nextBrowserLanguageDetector)
                .init({
                    debug: false, // Set to true for more logs
                    fallbackLng: 'en',
                    resources: resources,
                    interpolation: {
                        escapeValue: false // React already safes from xss
                    }
                }, (err, t) => {
                    if (err) return console.error('i18next initialization failed', err);
                    console.log('i18next initialized with language:', i18nInstance.language);
                    currentLanguage = i18nInstance.language.startsWith('xh') ? 'xh' : 'en';
                    updateContentAll(); // First translation pass
                    updateLanguageSwitcher();
                    postI18nInitSetup(); // Call remaining setup functions
                });

            document.querySelectorAll('.lang-switcher').forEach(button => {
                button.addEventListener('click', (e) => {
                    const lang = e.target.dataset.lang;
                    i18nInstance.changeLanguage(lang, (err, t) => {
                        if (err) return console.error('something went wrong loading', err);
                        currentLanguage = lang;
                        updateContentAll();
                        updateLanguageSwitcher();
                        // Refresh dynamic content that relies on translated keys
                        populateAllSelects(); 
                        renderAllDynamicContent();
                    });
                });
            });
        }
        
        function renderAllDynamicContent() {
            renderOverviewSection();
            renderAnalysisHub(true); // Force chart rerender with new lang
            renderMediaTravelHub();
            renderConnectResolveHub();
            // LifeSyncFunHub might not need full re-render if static text is handled by updateContentAll
        }

        function updateLanguageSwitcher() {
            document.querySelectorAll('.lang-switcher').forEach(btn => {
                const isActive = btn.dataset.lang === currentLanguage;
                btn.classList.toggle('active-lang', isActive); // Uses new active-lang style
                // btn.classList.toggle('font-bold', isActive); No longer needed with active-lang
            });
        }

        function updateContentAll() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const optionsAttr = el.getAttribute('data-i18n-options');
                let options = {};
                if (optionsAttr) {
                    try {
                        options = JSON.parse(optionsAttr);
                    } catch (e) {
                        console.warn(`Could not parse i18n-options for key ${key}: ${optionsAttr}`, e);
                    }
                }
                el.innerHTML = i18nInstance.t(key, options);
            });
            document.title = i18nInstance.t('siteTitle'); // Update page title

            // Update chart titles if they exist and depend on i18n
            if (dashboardChartInstance) {
                dashboardChartInstance.options.plugins.title.text = i18nInstance.t('overview.dashboardChartTitle');
                dashboardChartInstance.update('none'); // 'none' for no animation on lang change
            }
            if (trackingChartInstance) {
                const selectedMetricKey = document.getElementById('trackingMetricSelect').value;
                if (selectedMetricKey && relationshipData.metricsMeta[selectedMetricKey]) {
                     trackingChartInstance.options.plugins.title.text = i18nInstance.t(relationshipData.metricsMeta[selectedMetricKey].labelKey);
                     // Update dataset labels too for tracking chart
                     trackingChartInstance.data.datasets[0].label = `${i18nInstance.t('general.salatiso')} (${i18nInstance.t(relationshipData.metricsMeta[selectedMetricKey].labelKey)})`;
                     trackingChartInstance.data.datasets[1].label = `${i18nInstance.t('general.tee')} (${i18nInstance.t(relationshipData.metricsMeta[selectedMetricKey].labelKey)})`;
                     trackingChartInstance.update('none');
                }
            }
        }

        function adjustLayout() {
            const header = document.querySelector('header.main-header');
            const nav = document.querySelector('nav.main-nav');
            const footer = document.querySelector('footer.main-footer');
            const contentAreaWrapper = document.querySelector('.content-area-wrapper');

            if (!header || !nav || !footer || !contentAreaWrapper) {
                console.error("Layout elements not found for adjustment.");
                return;
            }

            const headerHeight = header.offsetHeight;
            const navHeight = nav.offsetHeight;
            const footerHeight = footer.offsetHeight;

            nav.style.top = `${headerHeight}px`;
            contentAreaWrapper.style.paddingTop = `${headerHeight + navHeight}px`;
            contentAreaWrapper.style.paddingBottom = `${footerHeight}px`;
            contentAreaWrapper.style.height = `100vh`; // Ensures it fills viewport
        }

        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.content-section');
            
            const initialActiveLink = document.querySelector('.nav-link[data-section="overview"]');
            if (initialActiveLink) initialActiveLink.classList.add('active-navlink');

            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const targetSectionId = link.dataset.section;
                    navLinks.forEach(l => l.classList.remove('active-navlink'));
                    link.classList.add('active-navlink');
                    sections.forEach(section => section.classList.toggle('active', section.id === targetSectionId));
                    
                    const targetSectionEl = document.getElementById(targetSectionId);
                    if (targetSectionEl) {
                        const firstSubNavTab = targetSectionEl.querySelector('.sub-nav-tab');
                        if (firstSubNavTab && !firstSubNavTab.classList.contains('active')) { // Only reset if not already on first tab
                            targetSectionEl.querySelectorAll('.sub-nav-tab').forEach(t => t.classList.remove('active'));
                            targetSectionEl.querySelectorAll('.sub-content').forEach(sc => sc.classList.remove('active'));
                            firstSubNavTab.classList.add('active');
                            const firstSubContentId = firstSubNavTab.dataset.subtarget;
                            const firstSubContentEl = targetSectionEl.querySelector(`.sub-content#${firstSubContentId}`);
                            if (firstSubContentEl) firstSubContentEl.classList.add('active');
                        }
                    }
                });
            });
        }

        function setupSubNavigation() {
            document.querySelectorAll('.content-section').forEach(section => {
                const subNavTabs = section.querySelectorAll('.sub-nav-tab');
                const subContents = section.querySelectorAll('.sub-content');
                subNavTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const subTargetId = tab.dataset.subtarget;
                        subNavTabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        subContents.forEach(content => content.classList.toggle('active', content.id === subTargetId));
                    });
                });
            });
        }

        function setupModals() {
            document.querySelectorAll('.modal-close').forEach(el => {
                el.addEventListener('click', (e) => {
                    const modalId = el.dataset.modalId || el.closest('.modal').id;
                    closeModalById(modalId);
                });
            });
            // Click on backdrop to close
            document.querySelectorAll('.modal').forEach(modalEl => {
                modalEl.addEventListener('click', (e) => {
                    if (e.target === modalEl) { // Only if backdrop itself is clicked
                        closeModalById(modalEl.id);
                    }
                });
            });
            document.getElementById('alertModalOk')?.addEventListener('click', () => {
                closeModalById('alertModal');
            });
        }
        function openModalById(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.add('active'); // Using 'active' class from LifeSync
        }
        function closeModalById(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.remove('active');
            if (modalId === 'playlistModal') {
                const iframe = document.getElementById('playlistFrame');
                if (iframe) iframe.src = iframe.src; // Resets to stop video
            }
        }
        function showCustomAlert(message, titleKey = 'general.notification') {
            document.getElementById('alertModalTitle').innerHTML = i18nInstance.t(titleKey);
            document.getElementById('alertModalMessage').innerHTML = message; // Message can be already translated string or raw text
            openModalById('alertModal');
        }

        function setupCarousels() { /* Kept similar to original Tee & Me, adapted for new theme */
             document.querySelectorAll('.carousel').forEach(carousel => {
                const inner = carousel.querySelector('.carousel-inner');
                const prevButton = carousel.querySelector('.carousel-control-prev');
                const nextButton = carousel.querySelector('.carousel-control-next');
                let currentIndex = 0;
                let items;

                function updateCarouselUI() {
                    items = Array.from(inner.children).filter(child => child.classList.contains('carousel-item'));
                    if (!items || items.length === 0) return;

                    let itemWidthOrPercentage;
                    let maxIndex;

                    if (carousel.id === 'quickTimelineCarousel' || carousel.id === 'modalTimelineCarousel') {
                        const firstItem = items[0];
                        const itemStyle = window.getComputedStyle(firstItem);
                        itemWidthOrPercentage = firstItem.offsetWidth + parseFloat(itemStyle.marginLeft) + parseFloat(itemStyle.marginRight);
                        const visibleItems = Math.floor(carousel.offsetWidth / itemWidthOrPercentage);
                        maxIndex = Math.max(0, items.length - visibleItems);
                        inner.style.transform = `translateX(-${currentIndex * itemWidthOrPercentage}px)`;
                    } else { // Single full-width item carousels (e.g., overviewImageCarousel)
                        itemWidthOrPercentage = 100; // As percentage
                        maxIndex = items.length - 1;
                        inner.style.transform = `translateX(-${currentIndex * itemWidthOrPercentage}%)`;
                    }
                    
                    currentIndex = Math.max(0, Math.min(currentIndex, maxIndex)); // Ensure currentIndex is valid

                    if (prevButton) prevButton.disabled = currentIndex === 0;
                    if (nextButton) nextButton.disabled = currentIndex >= maxIndex;
                }
                
                carousel.updateCarouselItems = updateCarouselUI;

                if (prevButton) {
                    prevButton.addEventListener('click', () => {
                        if (currentIndex > 0) {
                            currentIndex--;
                            updateCarouselUI();
                        }
                    });
                }
                if (nextButton) {
                    nextButton.addEventListener('click', () => {
                         // Re-calculate maxIndex based on current items before incrementing
                        items = Array.from(inner.children).filter(child => child.classList.contains('carousel-item'));
                        if (!items || items.length === 0) return;
                        let maxIndex;
                        if (carousel.id === 'quickTimelineCarousel' || carousel.id === 'modalTimelineCarousel') {
                            const firstItem = items[0];
                            const itemStyle = window.getComputedStyle(firstItem);
                            const itemWidth = firstItem.offsetWidth + parseFloat(itemStyle.marginLeft) + parseFloat(itemStyle.marginRight);
                            const visibleItems = Math.floor(carousel.offsetWidth / itemWidth);
                            maxIndex = Math.max(0, items.length - visibleItems);
                        } else {
                            maxIndex = items.length - 1;
                        }

                        if (currentIndex < maxIndex) {
                            currentIndex++;
                            updateCarouselUI();
                        }
                    });
                }
                // Initial call deferred to when items are populated.
            });
        }
        
        function populateAllSelects() {
            const trackingMetricSelect = document.getElementById('trackingMetricSelect');
            if (trackingMetricSelect) {
                trackingMetricSelect.innerHTML = '';
                Object.keys(relationshipData.metricsMeta).forEach(key => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = i18nInstance.t(relationshipData.metricsMeta[key].labelKey);
                    trackingMetricSelect.appendChild(option);
                });
                trackingMetricSelect.addEventListener('change', () => updateTrackingChart());
            }

            const contributionFilterWeek = document.getElementById('contributionFilterWeek');
            if (contributionFilterWeek) {
                contributionFilterWeek.innerHTML = '';
                relationshipData.weeks.forEach(week => {
                    const option = document.createElement('option');
                    option.value = week.weekNumber;
                    option.textContent = `${i18nInstance.t('general.week')} ${week.weekNumber} (${week.startDate})`;
                    contributionFilterWeek.appendChild(option);
                });
                contributionFilterWeek.addEventListener('change', () => renderContributionsTable());
            }
        }

        function renderOverviewSection() {
            renderDashboardTiles(); // New function for tiles
            renderOverviewTimelineCarousel();
            renderOverviewImageCarousel();
            updateDashboardChart();
        }

        function renderDashboardTiles() {
            relationshipData.dashboardMetrics.forEach(metricKey => {
                const tile = document.querySelector(`.dashboard-tile[data-metric="${metricKey}"]`);
                if (tile) {
                    const metricMeta = relationshipData.metricsMeta[metricKey];
                    const tileIconEl = tile.querySelector('.tile-icon i');
                    const tileTitleEl = tile.querySelector('.tile-title');
                    const tileValueEl = tile.querySelector('.tile-value');

                    if (tileIconEl) tileIconEl.className = metricMeta.icon; // Update icon
                    if (tileTitleEl) tileTitleEl.innerHTML = i18nInstance.t(metricMeta.labelKey); // Update title

                    // Calculate a representative value (e.g., average or latest for Tee)
                    let displayValue = "N/A";
                    if (relationshipData.weeks.length > 0) {
                        if (metricKey === 'food' || metricKey === 'safety') { // Example qualitative
                             const lastWeekTeeFood = relationshipData.weeks[relationshipData.weeks.length-1].contributions.tee.food;
                             const lastWeekTeeSafety = relationshipData.weeks[relationshipData.weeks.length-1].contributions.tee.safety;
                             if (metricKey === 'food') displayValue = lastWeekTeeFood > 6 ? "High" : (lastWeekTeeFood > 3 ? "Medium" : "Low");
                             if (metricKey === 'safety') displayValue = lastWeekTeeSafety > 7 ? "Strong" : (lastWeekTeeSafety > 4 ? "Okay" : "Needs Focus");

                        } else if (metricMeta.unit === "/10") { // Quantitative score
                            const avgScore = relationshipData.weeks.reduce((sum, week) => sum + (week.contributions.tee[metricKey] || 0), 0) / relationshipData.weeks.length;
                            displayValue = `${avgScore.toFixed(1)}${metricMeta.unit}`;
                        }
                    }
                    if (tileValueEl) tileValueEl.textContent = displayValue;
                    
                    // Add event listener to show metric detail modal
                    tile.onclick = () => showMetricDetailModal(metricKey);
                }
            });
        }
        function showMetricDetailModal(metricKey) {
            const metricMeta = relationshipData.metricsMeta[metricKey];
            document.getElementById('metricModalTitle').innerHTML = i18nInstance.t('modal.metricDetailsTitle', { metricName: i18nInstance.t(metricMeta.labelKey) });

            const ctx = document.getElementById('metricModalChart').getContext('2d');
            const labels = relationshipData.weeks.map(w => `${i18nInstance.t('general.week')} ${w.weekNumber}`);
            const dataS = relationshipData.weeks.map(w => w.contributions.salatiso[metricKey] || 0);
            const dataT = relationshipData.weeks.map(w => w.contributions.tee[metricKey] || 0);
            
            const summaryP = document.getElementById('metricModalSummary');
            if (summaryP) {
                // Simple summary: Average scores
                const avgS = dataS.reduce((s,a)=>s+a,0) / (dataS.filter(d=>d>0).length || 1);
                const avgT = dataT.reduce((s,a)=>s+a,0) / (dataT.filter(d=>d>0).length || 1);
                summaryP.innerHTML = `${i18nInstance.t('general.salatiso')} Avg: ${avgS.toFixed(1)}${metricMeta.unit || ''}<br>${i18nInstance.t('general.tee')} Avg: ${avgT.toFixed(1)}${metricMeta.unit || ''}`;
            }


            if (metricModalChartInstance) metricModalChartInstance.destroy();
            metricModalChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: i18nInstance.t('general.salatiso'), data: dataS, borderColor: 'var(--accent-teal-bright)', tension: 0.1 },
                        { label: i18nInstance.t('general.tee'), data: dataT, borderColor: 'var(--accent-pink-vibrant)', tension: 0.1 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: 'var(--text-primary-light)'}}},
                    scales: { 
                        y: { beginAtZero: true, suggestedMax: (metricMeta.unit === "/10" ? 10 : undefined), ticks: {color: 'var(--text-secondary-lavender)'}, grid: {color: 'var(--border-color-lavender)'} },
                        x: { ticks: {color: 'var(--text-secondary-lavender)'}, grid: {color: 'var(--border-color-lavender)'}}
                    }
                }
            });
            openModalById('metricDetailModal');
        }


        function renderOverviewTimelineCarousel() {
            const carouselInner = document.querySelector('#quickTimelineCarousel .carousel-inner');
            if (!carouselInner) return;
            carouselInner.innerHTML = '';
            relationshipData.weeks.slice(0, 8).forEach(week => {
                const item = document.createElement('div');
                item.className = 'carousel-item'; // Outer item for structure
                item.innerHTML = `
                    <div class="bg-opacity-75 p-3 rounded-lg shadow text-sm h-full flex flex-col justify-between">
                        <div>
                            <h4 class="font-semibold text-base mb-1" style="color: var(--accent-teal-bright);">${i18nInstance.t('general.week')} ${week.weekNumber} (${week.startDate})</h4>
                            <p class="text-xs mb-2 truncate" style="color: var(--text-secondary-lavender);">${i18nInstance.t(week.summaryKey)}</p>
                        </div>
                        <button class="details-btn btn btn-secondary !text-xs !py-1 !px-2 self-start" data-week="${week.weekNumber}" data-i18n="overview.seeDetails">See Details</button>
                    </div>
                `;
                carouselInner.appendChild(item);
            });
            const carousel = document.getElementById('quickTimelineCarousel');
            if (carousel && carousel.updateCarouselItems) setTimeout(() => carousel.updateCarouselItems(), 0);
            document.querySelectorAll('#quickTimelineCarousel .details-btn').forEach(btn => {
                btn.addEventListener('click', (e) => showDetailsModal(parseInt(e.target.dataset.week)));
            });
        }

        function renderOverviewImageCarousel() {
            const carouselInner = document.querySelector('#overviewImageCarousel .carousel-inner');
            if (!carouselInner) return;
            carouselInner.innerHTML = '';
            const shuffledPhotos = [...relationshipData.photoFileNames].sort(() => 0.5 - Math.random()).slice(0, 5);
            shuffledPhotos.forEach(fileName => {
                const item = document.createElement('div');
                item.className = 'carousel-item h-full';
                item.innerHTML = `<img src="assets/photos/${fileName}" alt="Shared Moment" class="w-full h-full object-cover rounded-lg">`;
                carouselInner.appendChild(item);
            });
            const carousel = document.getElementById('overviewImageCarousel');
            if (carousel && carousel.updateCarouselItems) setTimeout(() => carousel.updateCarouselItems(), 0);
            
            let autoPlayIndex = 0;
            const innerForAutoplay = carousel.querySelector('.carousel-inner'); // ensure correct scope
            setInterval(() => {
                const items = innerForAutoplay.querySelectorAll('.carousel-item');
                if (items.length > 0) {
                    autoPlayIndex = (autoPlayIndex + 1) % items.length;
                    innerForAutoplay.style.transform = `translateX(-${autoPlayIndex * 100}%)`;
                }
            }, 5000);
        }
        
        function updateDashboardChart() {
            const ctx = document.getElementById('dashboardChart')?.getContext('2d');
            if (!ctx) return;
            const initialWeeksData = relationshipData.weeks.slice(0, 4);
            const labels = initialWeeksData.map(w => `${i18nInstance.t('general.week')} ${w.weekNumber}`);
            const affectionDataS = initialWeeksData.map(w => w.contributions.salatiso.affection);
            const affectionDataT = initialWeeksData.map(w => w.contributions.tee.affection);

            if (dashboardChartInstance) dashboardChartInstance.destroy();
            dashboardChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: `${i18nInstance.t('general.salatiso')} ${i18nInstance.t(relationshipData.metricsMeta.affection.labelKey)}`,
                            data: affectionDataS,
                            borderColor: 'var(--accent-teal-bright)', tension: 0.1,
                            pointBackgroundColor: 'var(--accent-teal-bright)', pointBorderColor: 'var(--text-primary-light)'
                        },
                        {
                            label: `${i18nInstance.t('general.tee')} ${i18nInstance.t(relationshipData.metricsMeta.affection.labelKey)}`,
                            data: affectionDataT,
                            borderColor: 'var(--accent-pink-vibrant)', tension: 0.1,
                            pointBackgroundColor: 'var(--accent-pink-vibrant)', pointBorderColor: 'var(--text-primary-light)'
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: i18nInstance.t('overview.dashboardChartTitle'), color: 'var(--text-primary-light)', font: { family: 'var(--font-heading)'} },
                        legend: { position: 'bottom', labels: { color: 'var(--text-secondary-lavender)', boxWidth: 12, font: {size: 10, family: 'var(--font-main)'} } }
                    },
                    scales: { 
                        y: { beginAtZero: true, max: 10, ticks: {color: 'var(--text-secondary-lavender)'}, grid: {color: 'var(--border-color-lavender)'} },
                        x: { ticks: {color: 'var(--text-secondary-lavender)'}, grid: {color: 'var(--border-color-lavender)'}}
                    }
                }
            });
        }
        // ... (Keep other render functions: renderAnalysisHub, updateTrackingChart, renderContributionsTable, etc. - ensure they use new theme variables for colors in charts and text)
        // Important: Update Chart.js options for ALL charts to use the new theme colors for text, grids, ticks, legends.

        function updateTrackingChart() {
            const ctx = document.getElementById('trackingChart')?.getContext('2d');
            const selectedMetric = document.getElementById('trackingMetricSelect').value;
            if (!ctx || !selectedMetric) return;

            const metricMeta = relationshipData.metricsMeta[selectedMetric];
            let labels = relationshipData.weeks.map(w => `${i18nInstance.t('general.week')} ${w.weekNumber}`);
            let dataS, dataT;

            if (selectedMetric === 'feedbackResponseTime') {
                dataS = relationshipData.weeks.map(() => Math.random() * 5 + 1); 
                dataT = relationshipData.weeks.map(() => Math.random() * 5 + 1);
            } else {
                dataS = relationshipData.weeks.map(w => w.contributions.salatiso[selectedMetric] || 0);
                dataT = relationshipData.weeks.map(w => w.contributions.tee[selectedMetric] || 0);
            }
            const chartType = (selectedMetric === 'finances') ? 'bar' : 'line';

            if (trackingChartInstance) trackingChartInstance.destroy();
            trackingChartInstance = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: `${i18nInstance.t('general.salatiso')} (${i18nInstance.t(metricMeta.labelKey)})`,
                            data: dataS,
                            borderColor: 'var(--accent-teal-bright)', backgroundColor: 'rgba(45, 212, 191, 0.5)', tension: 0.1,
                            pointBackgroundColor: 'var(--accent-teal-bright)', pointBorderColor: 'var(--text-primary-light)'
                        },
                        {
                            label: `${i18nInstance.t('general.tee')} (${i18nInstance.t(metricMeta.labelKey)})`,
                            data: dataT,
                            borderColor: 'var(--accent-pink-vibrant)', backgroundColor: 'rgba(219, 39, 119, 0.5)', tension: 0.1,
                            pointBackgroundColor: 'var(--accent-pink-vibrant)', pointBorderColor: 'var(--text-primary-light)'
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: i18nInstance.t(metricMeta.labelKey), color: 'var(--text-primary-light)', font: { family: 'var(--font-heading)'}},
                        legend: { position: 'bottom', labels: { color: 'var(--text-secondary-lavender)', boxWidth: 12, font: {size: 10, family: 'var(--font-main)'} } }
                    },
                    scales: { 
                        y: { beginAtZero: true, ticks: {color: 'var(--text-secondary-lavender)'}, grid: {color: 'var(--border-color-lavender)'} },
                        x: { ticks: {color: 'var(--text-secondary-lavender)'}, grid: {color: 'var(--border-color-lavender)'}}
                    }
                }
            });
        }
         function renderContributionsTable() {
            const tbody = document.getElementById('contributionsTableBody');
            const selectedWeekNum = parseInt(document.getElementById('contributionFilterWeek')?.value);
            if (!tbody || !selectedWeekNum) return;

            const weekData = relationshipData.weeks.find(w => w.weekNumber === selectedWeekNum);
            if (!weekData) return;

            tbody.innerHTML = '';
            const parameters = Object.keys(relationshipData.metricsMeta).filter(k => k !== 'feedbackResponseTime'); 

            parameters.forEach(param => {
                const row = tbody.insertRow();
                row.insertCell().textContent = i18nInstance.t(relationshipData.metricsMeta[param].labelKey);
                row.insertCell().textContent = `${weekData.contributions.salatiso[param] || 'N/A'} ${i18nInstance.t(relationshipData.metricsMeta[param].unit) || ''}`;
                row.insertCell().textContent = `${weekData.contributions.tee[param] || 'N/A'} ${i18nInstance.t(relationshipData.metricsMeta[param].unit) || ''}`;
                const notesS = weekData.contributions.salatiso.notesKey ? i18nInstance.t(weekData.contributions.salatiso.notesKey) : '';
                const notesT = weekData.contributions.tee.notesKey ? i18nInstance.t(weekData.contributions.tee.notesKey) : '';
                row.insertCell().textContent = `S: ${notesS || '-'} T: ${notesT || '-'}`;
            });
        }

        function renderReinforcementTable() {
            const tbody = document.getElementById('reinforcementTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';
            relationshipData.reinforcementWords.forEach(word => {
                const row = tbody.insertRow();
                row.insertCell().textContent = i18nInstance.t(word.wordKey);
                row.insertCell().textContent = i18nInstance.t(word.purposeKey);
                row.insertCell().textContent = word.occurrences.salatiso.join(', ') || '-';
                row.insertCell().textContent = word.occurrences.tee.join(', ') || '-';
                row.insertCell().textContent = word.occurrences.joint.join(', ') || '-';
            });
        }
        
        function renderMediaTravelHub() {
            renderSharedSongs();
            renderPhotoMoments();
            renderTravelLog();
        }

        function renderSharedSongs() {
            const list = document.getElementById('sharedSongsList');
            if (!list) return;
            list.innerHTML = '';
            relationshipData.weeks.forEach(week => {
                week.events.filter(e => e.type === 'music').forEach(song => {
                    const li = document.createElement('li');
                    li.className = 'p-3 rounded-md shadow-sm text-sm';
                    li.style.backgroundColor = 'var(--bg-card-purple)';
                    li.style.border = '1px solid var(--border-color-lavender)';
                    li.innerHTML = `
                        <span class="font-semibold" style="color: var(--accent-teal-bright);">${song.songTitle}</span> ${song.artist ? 'by ' + song.artist : ''}
                        <br>
                        <span class="text-xs" style="color: var(--text-secondary-lavender);">${i18nInstance.t('mediaTravelHub.sharedSongs.sharedBy', { user: i18nInstance.t(`general.${song.sharedBy.toLowerCase()}`) || song.sharedBy, week: week.weekNumber })}</span>
                        <a href="${song.songUrl}" target="_blank" class="ml-2 text-xs hover:underline" style="color: var(--accent-pink-vibrant);">${i18nInstance.t('mediaTravelHub.sharedSongs.listen')} <i class="fas fa-play-circle"></i></a>
                    `;
                    list.appendChild(li);
                });
            });
        }

        function renderPhotoMoments() {
            const grid = document.getElementById('photoMomentsGrid');
            if (!grid) return;
            grid.innerHTML = '';
            relationshipData.photoFileNames.forEach(fileName => {
                const imgContainer = document.createElement('div'); // Container for potential overlay/actions
                imgContainer.className = "relative group";
                const img = document.createElement('img');
                img.src = `assets/photos/${fileName}`;
                img.alt = "Photo moment";
                img.className = "w-full h-auto object-cover rounded-md shadow aspect-square border border-[var(--border-color-lavender)]";
                imgContainer.appendChild(img);
                grid.appendChild(imgContainer);
            });
        }

        function renderTravelLog() {
            const visitedList = document.getElementById('visitedTripsList');
            const dreamList = document.getElementById('dreamTripsList');
            if (!visitedList || !dreamList) return;

            visitedList.innerHTML = '';
            relationshipData.travelLog.visited.forEach(trip => {
                const item = document.createElement('div');
                item.className = 'p-4 rounded-lg shadow text-sm';
                item.style.backgroundColor = 'var(--bg-card-purple)';
                item.style.border = '1px solid var(--border-color-strong)';
                item.innerHTML = `
                    <h4 class="font-semibold text-lg mb-1" style="color: var(--accent-teal-bright);">${i18nInstance.t(trip.destinationKey)} <span class="text-xs font-normal" style="color:var(--text-secondary-lavender);">(${trip.dates})</span></h4>
                    <p><strong>${i18nInstance.t('mediaTravelHub.visited.roles')}</strong> S: ${i18nInstance.t(trip.roles.salatisoKey)}, T: ${i18nInstance.t(trip.roles.teeKey)}</p>
                    <p class="mt-1"><strong>${i18nInstance.t('mediaTravelHub.visited.highlights')}</strong> ${i18nInstance.t(trip.highlightsKey)}</p>
                    ${trip.photos && trip.photos.length > 0 ? `<p class="mt-2"><strong>${i18nInstance.t('mediaTravelHub.visited.photos')}</strong></p><div class="flex gap-2 mt-1 flex-wrap">${trip.photos.map(p => `<img src="assets/photos/${p}" class="w-20 h-20 object-cover rounded border border-[var(--border-color-lavender)]">`).join('')}</div>` : ''}
                `;
                visitedList.appendChild(item);
            });

            dreamList.innerHTML = '';
            relationshipData.travelLog.dream.forEach(trip => {
                const item = document.createElement('div');
                item.className = 'p-4 rounded-lg shadow text-sm';
                item.style.backgroundColor = 'var(--bg-card-purple)';
                item.style.border = '1px solid var(--border-color-strong)';
                item.innerHTML = `
                    <h4 class="font-semibold text-lg mb-1" style="color: var(--accent-teal-bright);">${i18nInstance.t(trip.destinationKey)}</h4>
                    <p><strong>${i18nInstance.t('mediaTravelHub.dreamTrips.notes')}</strong> ${i18nInstance.t(trip.notesKey)}</p>
                `;
                dreamList.appendChild(item);
            });
        }
        
        function renderConnectResolveHub() {
            renderFeedbackLog();
            renderActionLog();
        }

        document.getElementById('feedbackForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            const sender = document.getElementById('feedbackSender').value;
            const recipient = document.getElementById('feedbackRecipient').value;
            const messageText = document.getElementById('feedbackMessage').value;
            
            if (!messageText.trim()) {
                showCustomAlert("Message cannot be empty."); // This should be i18n'd
                return;
            }
            const newFeedbackId = `fb${Date.now()}`;
            const newFeedbackMsgKey = `feedbackMessages.custom.${newFeedbackId}`;

            relationshipData.feedbackLog.push({
                id: newFeedbackId, sender, recipient,
                messageKey: newFeedbackMsgKey, // Store key for dynamic text
                messageText: messageText,      // Store actual text
                timestamp: new Date().toISOString(), status: 'pending', responseTime: null
            });
            // Add new custom message to translation resources for current session
            // This is a simplified way to handle custom text with i18next without backend
            i18nInstance.addResource('en', 'translation', newFeedbackMsgKey, messageText);
            if (window.xhosaTranslations) { // If xhosa is loaded/available
                 i18nInstance.addResource('xh', 'translation', newFeedbackMsgKey, messageText + " (Igq.") ; // Indicate it needs proper translation
            }


            renderFeedbackLog();
            this.reset();
            showCustomAlert(i18nInstance.t('general.feedbackSent'));
        });

        function renderFeedbackLog() {
            const container = document.getElementById('feedbackLogContainer');
            if (!container) return;
            container.innerHTML = '';
            [...relationshipData.feedbackLog].reverse().forEach(fb => {
                const item = document.createElement('div');
                item.className = 'p-3 border rounded-md text-xs';
                item.style.borderColor = 'var(--border-color-lavender)';
                item.style.backgroundColor = 'rgba(255,255,255,0.03)';

                const message = fb.messageText || i18nInstance.t(fb.messageKey);
                let responseInfo = '';
                if (fb.status === 'responded' && fb.responseTime) {
                    const hours = Math.floor(fb.responseTime / 3600000);
                    const minutes = Math.floor((fb.responseTime % 3600000) / 60000);
                    responseInfo = `<span style="color:var(--accent-teal-bright);">${i18nInstance.t('connectResolve.feedback.respondedIn', { duration: `${hours}h ${minutes}m` })}</span>`;
                } else if (fb.status === 'pending') {
                    responseInfo = `<button class="acknowledge-feedback-btn text-xs hover:underline" data-id="${fb.id}" style="color:var(--accent-pink-vibrant); background:none; border:none; padding:0; cursor:pointer;">${i18nInstance.t('connectResolve.feedback.acknowledge')}</button>`;
                }

                item.innerHTML = `
                    <p><strong>${i18nInstance.t('general.from')}:</strong> ${i18nInstance.t(`general.${fb.sender.toLowerCase()}`)} <strong>${i18nInstance.t('general.to')}:</strong> ${i18nInstance.t(`general.${fb.recipient.toLowerCase()}`)}</p>
                    <p class="my-1 py-1 px-2 rounded" style="background-color: var(--bg-dark-purple); border-left: 2px solid var(--accent-purple-medium);">${message}</p>
                    <p style="color:var(--text-secondary-lavender);">${new Date(fb.timestamp).toLocaleString()} - ${responseInfo}</p>
                `;
                container.appendChild(item);
            });
            
            document.querySelectorAll('.acknowledge-feedback-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const feedbackId = e.target.dataset.id;
                    const feedbackItem = relationshipData.feedbackLog.find(item => item.id === feedbackId);
                    if (feedbackItem) {
                        feedbackItem.status = 'responded';
                        feedbackItem.responseTime = Date.now() - new Date(feedbackItem.timestamp).getTime();
                        renderFeedbackLog();
                        showCustomAlert(i18nInstance.t('general.feedbackAcknowledged'));
                    }
                });
            });
        }
        
        function setupActionForms() {
             const formsInfo = [
                { id: 'apologyForm', typeKey: 'actionTypes.actionApology', fieldsMap: {'actor': 'apologyActor', 'message': 'apologyMessage'} },
                { id: 'dissatisfactionForm', typeKey: 'actionTypes.actionExpressDissatisfaction', fieldsMap: {'actor': 'dissatisfactionActor', 'message': 'dissatisfactionMessage'} },
                { id: 'bookDateForm', typeKey: 'actionTypes.actionBookDate', fieldsMap: {'actor': 'bookDateActor', 'activity': 'bookDateActivity', 'date': 'bookDateDate'} },
                { id: 'terminationForm', typeKey: 'actionTypes.actionTerminate', fieldsMap: {'actor': 'terminationActor', 'reason': 'terminationReason', 'notes': 'terminationNotes'} }
            ];

            formsInfo.forEach(formInfo => {
                const formElement = document.getElementById(formInfo.id);
                if (formElement) {
                    formElement.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const actionId = `act${Date.now()}`;
                        const action = {
                            id: actionId,
                            timestamp: new Date().toISOString(),
                            actionTypeKey: formInfo.typeKey
                        };
                        
                        let detailsParts = [];
                        for (const fieldKey in formInfo.fieldsMap) {
                            const fieldElement = document.getElementById(formInfo.fieldsMap[fieldKey]);
                            if (fieldElement) {
                                action[fieldKey] = fieldElement.value; // Store raw value
                                if (fieldElement.tagName === 'SELECT') {
                                     const selectedOption = fieldElement.options[fieldElement.selectedIndex];
                                     detailsParts.push(`${fieldKey}: ${selectedOption.dataset.i18n ? i18nInstance.t(selectedOption.dataset.i18n) : selectedOption.textContent}`);
                                } else {
                                     detailsParts.push(`${fieldKey}: ${fieldElement.value}`);
                                }
                            }
                        }
                        action.detailsText = detailsParts.join('; '); // Store combined details text
                        const detailsKey = `actionDetails.custom.${actionId}`;
                        action.detailsKey = detailsKey; // Assign key for i18n (even if we store full text)

                        i18nInstance.addResource('en', 'translation', detailsKey, action.detailsText);
                        if (window.xhosaTranslations) {
                             i18nInstance.addResource('xh', 'translation', detailsKey, action.detailsText + " (Igq.)");
                        }


                        if (formInfo.id === 'terminationForm') {
                            if (!confirm(i18nInstance.t('connectResolve.actions.termination.confirm'))) return;
                        }
                        
                        relationshipData.actionLog.push(action);
                        renderActionLog();
                        formElement.reset();
                        showCustomAlert(i18nInstance.t('general.actionLogged'));
                    });
                }
            });
        }

        function renderActionLog() {
            const container = document.getElementById('actionLogContainer');
            if (!container) return;
            container.innerHTML = '';
            [...relationshipData.actionLog].reverse().forEach(log => {
                const item = document.createElement('div');
                item.className = 'p-3 border rounded-md text-xs';
                item.style.borderColor = 'var(--border-color-lavender)';
                item.style.backgroundColor = 'rgba(255,255,255,0.03)';
                const actorName = log.actor ? i18nInstance.t(`general.${log.actor.toLowerCase()}`) : 'N/A';
                const details = log.detailsText || i18nInstance.t(log.detailsKey); // Prefer stored text
                item.innerHTML = `
                    <p><strong>${i18nInstance.t(log.actionTypeKey)}</strong> by ${actorName}</p>
                    <p class="my-1 py-1 px-2 rounded text-sm" style="background-color: var(--bg-dark-purple); border-left: 2px solid var(--accent-purple-medium);">${details}</p>
                    <p style="color:var(--text-secondary-lavender);">${new Date(log.timestamp).toLocaleString()}</p>
                `;
                container.appendChild(item);
            });
        }

        function renderLifeSyncFunHub() { /* Astrology is main interactive part here */ }
        
        function setupCompatibilityTools() {
            const checkAstrologyBtn = document.getElementById('checkAstrology');
            if (checkAstrologyBtn) {
                checkAstrologyBtn.addEventListener('click', () => {
                    const bdayS = document.getElementById('salatisoBirthday').value;
                    const bdayT = document.getElementById('teeBirthday').value;
                    const resultDiv = document.getElementById('astrologyResult');
                    if (!bdayS || !bdayT || !resultDiv) {
                        resultDiv.textContent = "Please enter both birthdays."; return; // Should be i18n
                    }
                    const zodiacS = getZodiacSign(new Date(bdayS));
                    const zodiacT = getZodiacSign(new Date(bdayT));
                    const compatibilityText = `(${zodiacS}) and (${zodiacT}) - a cosmic dance of possibilities! Each brings unique strengths.`; // Generic, not i18n for simplicity here
                    resultDiv.textContent = i18nInstance.t('lifeSyncFun.compatibility.astrology.result', {
                        name1: i18nInstance.t('general.salatiso'), zodiac1: zodiacS,
                        name2: i18nInstance.t('general.tee'), zodiac2: zodiacT,
                        compatibilityText: compatibilityText
                    });
                });
            }
        }

        function getZodiacSign(date) { /* Same as before */
            const day = date.getDate(); const month = date.getMonth() + 1;
            if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) return "Aquarius";
            if ((month == 2 && day >= 19) || (month == 3 && day <= 20)) return "Pisces";
            if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) return "Aries";
            if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) return "Taurus";
            if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) return "Gemini";
            if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) return "Cancer";
            if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) return "Leo";
            if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) return "Virgo";
            if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) return "Libra";
            if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) return "Scorpio";
            if ((month == 11 && day >= 22) || (month == 12 && day <= 21)) return "Sagittarius";
            if ((month == 12 && day >= 22) || (month == 1 && day <= 19)) return "Capricorn";
            return "Unknown";
        }

        function showDetailsModal(weekNumber) {
            const week = relationshipData.weeks.find(w => w.weekNumber === weekNumber);
            if (!week) return;
            document.getElementById('modalTitle').innerHTML = i18nInstance.t('modal.detailsTitle', { weekNumber: week.weekNumber });
            document.getElementById('modalSummary').innerHTML = i18nInstance.t(week.summaryKey);
            const modalCarouselInner = document.querySelector('#modalTimelineCarousel .carousel-inner');
            modalCarouselInner.innerHTML = '';
            if (week.events && week.events.length > 0) {
                week.events.forEach(event => {
                    const item = document.createElement('div');
                    item.className = 'carousel-item p-3 text-sm';
                    item.style.backgroundColor = 'var(--bg-dark-purple)'; 
                    item.style.border = '1px solid var(--border-color-lavender)';
                    item.style.borderRadius = '0.375rem';

                    let eventHtml = `<h5 class="font-semibold mb-1" style="color:var(--accent-teal-bright);">${i18nInstance.t(event.textKey)}</h5>`;
                    if (event.originalMessageKey) eventHtml += `<p class="text-xs mt-1 whitespace-pre-wrap italic" style="color:var(--text-secondary-lavender);"><em>${i18nInstance.t(event.originalMessageKey)}</em></p>`;
                    if (event.type === 'music') eventHtml += `<p class="text-xs mt-1">${event.songTitle} ${event.artist ? 'by ' + event.artist : ''} (<a href="${event.songUrl}" target="_blank" style="color:var(--accent-pink-vibrant);">Listen</a>)</p>`;
                    if (event.type === 'link') eventHtml += `<p class="text-xs mt-1"><a href="${event.url}" target="_blank" style="color:var(--accent-pink-vibrant);">View Link</a></p>`;
                    item.innerHTML = eventHtml;
                    modalCarouselInner.appendChild(item);
                });
            } else {
                modalCarouselInner.innerHTML = `<div class="carousel-item p-3 text-sm">${i18nInstance.t('eventTexts.noEvents')}</div>`;
            }
            const modalCarousel = document.getElementById('modalTimelineCarousel');
            if (modalCarousel && modalCarousel.updateCarouselItems) setTimeout(() => modalCarousel.updateCarouselItems(), 0);
            openModalById('detailsModal');
        }
        
        function setupPlaylistFab() {
            const fab = document.getElementById('playlistFab');
            const iframe = document.getElementById('playlistFrame');
            if (fab && iframe) {
                fab.addEventListener('click', () => {
                    iframe.src = relationshipData.playlistUrl; // Ensure URL is iframe-embeddable format
                    openModalById('playlistModal');
                });
            }
        }
        // --- End of Embedded JavaScript ---
    </script>
</body>
</html>
